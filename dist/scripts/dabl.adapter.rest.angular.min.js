!function(a,b){angular.module("dabl",[]).factory("dabl",["$http","$q",function(a,b){dabl.Deferred=function(){var a=b.defer(),c=a.promise;return a.promise=function(){return c},a};var c=dabl.RESTAdapter.extend({$http:null,init:function(a){this._super(a)},_getErrorCallback:function(a){return function(b){var c="Request failed.",d=b.data;d&&(d.error?c=d.error:d.errors&&(c=d.errors.join("\n"))),a.reject(c,d,b.config)}},_save:function(c,d){var e,f,g=c.constructor,h=this._getRoute(g._url),i={},j=g.getKey(),k=this,l=b.defer(),m=this._getErrorCallback(l);for(e in g._fields){var n=g._fields[e];f=c[e],g.isTemporalType(n.type)&&(f=this.formatDate(f,n.type)),i[e]=f}var o=function(a){var b=a.data;if(!k._isValidResponseObject(b,g))return void m.apply(this,arguments);c.fromJSON(b).resetModified().setNew(!1),j&&void 0!==c[j]&&k.cache(g._table,c[j],c),l.resolve(c)};return a({url:h.url(i),method:"POST",data:i,headers:{"X-HTTP-Method-Override":d}}).then(o,m),l.promise},update:function(a){if(!a.isModified()){var c=b.defer();return c.resolve(a),c.promise}return this._save(a,"PUT")},remove:function(c){var d=c.constructor,e=this._getRoute(d._url),f=d.getKey(),g=this,h=b.defer(),i=this._getErrorCallback(h),j=function(a){var b=a.data;if(b&&(b.error||b.errors&&b.errors.length))return void i.apply(this,arguments);f&&c[f]&&g.cache(d._table,c[f],null),h.resolve(c)};return a({url:e.url(c.toJSON()),method:"POST",data:{},headers:{"X-HTTP-Method-Override":"DELETE"}}).then(j,i),h.promise},find:function(c,d){var e,f=this._getRoute(c._url),g={},h=null,i=b.defer(),j=this._getErrorCallback(i),k=this,l=c.getKey();if(!l||2!==arguments.length||"number"!=typeof d&&"string"!=typeof d)e=this.findQuery.apply(this,arguments),e.limit(1),g=e.getSimpleJSON();else{if(h=this.cache(c._table,d))return i.resolve(h),i.promise;g={},g[l]=d}var m=function(a){var b=a.data;if(!k._isValidResponseObject(b,c))return void j.apply(this,arguments);b instanceof Array&&(b=b.shift()),i.resolve(c.inflate(b))};return a.get(f.urlGet(g)).then(m,j),i.promise},findAll:function(c){var d=this.findQuery.apply(this,arguments),e=this._getRoute(c._url),f=d.getSimpleJSON(),g=b.defer(),h=this._getErrorCallback(g),i=function(a){var b=a.data;if("object"!=typeof b||b.error||b.errors&&b.errors.length)return void h.apply(this,arguments);b instanceof Array||(b=[b]),g.resolve(c.inflateArray(b))};return a.get(e.urlGet(f)).then(i,h),g.promise},countAll:function(c){var d=this.findQuery.apply(this,arguments).setAction(dabl.Query.ACTION_COUNT),e=this._getRoute(c._url),f=d.getSimpleJSON(),g=b.defer(),h=this._getErrorCallback(g),i=function(a){var b=a.data,c=parseInt(b.total,10);if(isNaN(c)||"object"!=typeof b||b.error||b.errors&&b.errors.length)return void h.apply(this,arguments);g.resolve(c)};return a.get(e.urlGet(f)).then(i,h),g.promise}});return dabl.AngularRESTAdapter=c,dabl}]),b.true=a}({},function(){return this}());