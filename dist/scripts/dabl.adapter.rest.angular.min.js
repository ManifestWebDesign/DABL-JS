!function(a,b){b["true"]=a,angular.module("dabl",[]).factory("dabl",["$http","$q",function(a,b){dabl.Deferred=function(){var a=b.defer(),c=a.promise;return a.promise=function(){return c},a};var c=dabl.RESTAdapter.extend({$http:null,init:function(a){this._super(a)},_getErrorCallback:function(a){return function(b,c,d,e){var f="Request failed.";b&&(b.error?f=b.error:b.errors&&(f=b.errors.join("\n"))),a.reject(f,b,e)}},_save:function(c,d){var e,f,g=c.constructor,h=this._getRoute(g._url),i={},j=g.getKey(),k=this,l=b.defer(),m=this._getErrorCallback(l);for(e in g._fields){var n=g._fields[e];f=c[e],g.isTemporalType(n.type)&&(f=this.formatDate(f,n.type)),i[e]=f}return a({url:h.url(i),method:"POST",data:i,headers:{"X-HTTP-Method-Override":d}}).success(function(a){return k._isValidResponseObject(a,g)?(c.fromJSON(a).resetModified().setNew(!1),j&&"undefined"!=typeof c[j]&&k.cache(g._table,c[j],c),void l.resolve(c)):void m.apply(this,arguments)}).error(m),l.promise},update:function(a){if(!a.isModified()){var b=dabl.Deferred();return b.resolve(a),b.promise}return this._save(a,"PUT")},remove:function(c){var d=c.constructor,e=this._getRoute(d._url),f=d.getKey(),g=this,h=b.defer(),i=this._getErrorCallback(h);return a({url:e.url(c.toJSON()),method:"POST",data:{},headers:{"X-HTTP-Method-Override":"DELETE"}}).success(function(a){return a&&(a.error||a.errors&&a.errors.length)?void i.apply(this,arguments):(f&&c[f]&&g.cache(d._table,c[f],null),void h.resolve(c))}).error(i),h.promise},find:function(c,d){var e,f=this._getRoute(c._url),g={},h=null,i=b.defer(),j=this._getErrorCallback(i),k=this,l=c.getKey();if(!l||2!==arguments.length||"number"!=typeof d&&"string"!=typeof d)e=this.findQuery.apply(this,arguments),e.limit(1),g=e.getSimpleJSON();else{if(h=this.cache(c._table,d))return i.resolve(h),i.promise;g={},g[l]=d}return a.get(f.urlGet(g)).success(function(a){return k._isValidResponseObject(a,c)?(a instanceof Array&&(a=a.shift()),void i.resolve(c.inflate(a))):void j.apply(this,arguments)}).error(j),i.promise},findAll:function(c){var d=this.findQuery.apply(this,arguments),e=this._getRoute(c._url),f=d.getSimpleJSON(),g=b.defer(),h=this._getErrorCallback(g);return a.get(e.urlGet(f)).success(function(a){return"object"!=typeof a||a.error||a.errors&&a.errors.length?void h.apply(this,arguments):(a instanceof Array||(a=[a]),void g.resolve(c.inflateArray(a)))}).error(h),g.promise},countAll:function(c){var d=this.findQuery.apply(this,arguments).setAction(dabl.Query.ACTION_COUNT),e=this._getRoute(c._url),f=d.getSimpleJSON(),g=b.defer(),h=this._getErrorCallback(g);return a.get(e.urlGet(f)).success(function(a){var b=parseInt(a.total,10);return isNaN(b)||"object"!=typeof a||a.error||a.errors&&a.errors.length?void h.apply(this,arguments):void g.resolve(b)}).error(h),g.promise}});return dabl.AngularRESTAdapter=c,dabl}])}({},function(){return this}());