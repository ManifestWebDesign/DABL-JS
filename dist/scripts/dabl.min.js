!function(a,b){function c(a){return"[object Array]"===Object.prototype.toString.call(a)}function d(a,b){if(c(a))for(var d=0;d<a.length;d++)b(a[d]);else b(a)}function e(a){var b="pending",f=[],g=[],h=[],i=null,j={done:function(){for(var a=0;a<arguments.length;a++)if(arguments[a])if(c(arguments[a]))for(var d=arguments[a],e=0;e<d.length;e++)"resolved"===b&&d[e].apply(this,i),f.push(d[e]);else"resolved"===b&&arguments[a].apply(this,i),f.push(arguments[a]);return this},fail:function(){for(var a=0;a<arguments.length;a++)if(arguments[a])if(c(arguments[a]))for(var d=arguments[a],e=0;e<d.length;e++)"rejected"===b&&d[e].apply(this,i),g.push(d[e]);else"rejected"===b&&arguments[a].apply(this,i),g.push(arguments[a]);return this},always:function(){return this.done.apply(this,arguments).fail.apply(this,arguments)},progress:function(){for(var a=0;a<arguments.length;a++)if(arguments[a])if(c(arguments[a]))for(var d=arguments[a],e=0;e<d.length;e++)"pending"===b&&h.push(d[e]);else"pending"===b&&h.push(arguments[a]);return this},then:function(){return arguments.length>1&&arguments[1]&&this.fail(arguments[1]),arguments.length>0&&arguments[0]&&this.done(arguments[0]),arguments.length>2&&arguments[2]&&this.progress(arguments[2]),this},promise:function(a){if(null==a)return j;for(var b in j)a[b]=j[b];return a},state:function(){return b},debug:function(){console.log("[debug]",f,g,b)},isRejected:function(){return"rejected"===b},isResolved:function(){return"resolved"===b},pipe:function(a,b,c){return e(function(c){d(a,function(a){"function"==typeof a?k.done(function(){var b=a.apply(this,arguments);b&&"function"==typeof b?b.promise().then(c.resolve,c.reject,c.notify):c.resolve(b)}):k.done(c.resolve)}),d(b,function(a){"function"==typeof a?k.fail(function(){var b=a.apply(this,arguments);b&&"function"==typeof b?b.promise().then(c.resolve,c.reject,c.notify):c.reject(b)}):k.fail(c.reject)})}).promise()}},k={resolveWith:function(a){if("pending"===b){b="resolved";for(var c=i=arguments.length>1?arguments[1]:[],d=0;d<f.length;d++)f[d].apply(a,c)}return this},rejectWith:function(a){if("pending"===b){b="rejected";for(var c=i=arguments.length>1?arguments[1]:[],d=0;d<g.length;d++)g[d].apply(a,c)}return this},notifyWith:function(a){if("pending"===b)for(var c=i=arguments.length>1?arguments[1]:[],d=0;d<h.length;d++)h[d].apply(a,c);return this},resolve:function(){return this.resolveWith(this,arguments)},reject:function(){return this.rejectWith(this,arguments)},notify:function(){return this.notifyWith(this,arguments)}},l=j.promise(k);return a&&a.apply(l,[l]),l}function f(a,b,c){var d;for(d in a)b[d]="function"==typeof a[d]&&"function"==typeof c[d]&&i.test(a[d])?function(a,b){return function(){var d,e=this._super;return this._super=c[a],d=b.apply(this,arguments),this._super=e,d}}(d,a[d]):a[d]}function g(a){try{return Object.defineProperty(a,"sentinel",{value:"foo"}),"sentinel"in a}catch(b){return!1}}b["true"]=a,dabl="undefined"==typeof dabl?{}:dabl,dabl.sPad=function(a){return a+="",2===a.length?a:"0"+a},dabl.copy=function(a){if(null===a)return null;if(a instanceof k)return a.constructor(a);if(a instanceof Array)return a.slice(0);if(a instanceof Date)return new Date(a.getTime());switch(typeof a){case"string":case"boolean":case"number":case"undefined":case"function":return a}var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},dabl.equals=function(a,b,c){if(c&&c===k.FIELD_TYPE_DATE?(a=dabl.formatDate(a),b=dabl.formatDate(b)):c&&c===k.FIELD_TYPE_TIMESTAMP&&(a=dabl.constructDate(a),b=dabl.constructDate(b)),a instanceof Date&&b instanceof Date)return a.getTime()===b.getTime();if(c&&c===JSON)"string"!=typeof a&&(a=JSON.stringify(a)),"string"!=typeof b&&(b=JSON.stringify(b));else if("object"==typeof a)return JSON.stringify(a)===JSON.stringify(b);return a===b},dabl.formatDate=function(a){return a instanceof Date||(a=dabl.constructDate(a)),a?a.getUTCFullYear()+"-"+dabl.sPad(a.getUTCMonth()+1)+"-"+dabl.sPad(a.getUTCDate()):null},dabl.constructDate=function(a){if(a===!1||""===a||"undefined"==typeof a)return null;if(a instanceof Date)return a;var b=new Date(a);if(isNaN(b.getTime()))throw new Error(a+" is not a valid date");return b},"undefined"!=typeof jQuery&&jQuery.Deferred?dabl.Deferred=jQuery.Deferred:(e.when=function(){if(arguments.length<2){var a=arguments.length?arguments[0]:void 0;return a&&"function"==typeof a.isResolved&&"function"==typeof a.isRejected?a.promise():e().resolve(a).promise()}return function(a){for(var b=e(),c=a.length,d=0,f=new Array(c),g=0;g<a.length;g++)!function(e){a[e].done(function(){f[e]=arguments.length<2?arguments[0]:arguments,++d===c&&b.resolve.apply(b,f)}).fail(function(){b.reject(arguments)})}(g);return b.promise()}(arguments)},dabl.Deferred=e);var h=!1,i=/xyz/.test(function(){})?/\b_super\b/:/.*/,j=function(){};j.canDefineProperties=g({}),j.extend=function(a,b){function c(){!h&&this.init&&this.init.apply(this,arguments)}"undefined"==typeof a&&(a={}),"undefined"==typeof b&&(b={});var d,e;h=!0,d=new this,h=!1;for(e in this)e in b||!this.hasOwnProperty(e)||(c[e]=this[e]);return f(a,d,this.prototype),f(b,c,this),c.prototype=d,c.prototype.constructor=c,c},j.callAsync=j.prototype.callAsync=function(a,b,c){var d=dabl.Deferred(),e=d.promise();try{var f=a.call(this);f&&"function"==typeof f.then?e=f:d.resolve(f)}catch(g){d.reject(g)}return("function"==typeof b||"function"==typeof c)&&e.then(b,c),e},dabl.Class=j;var k=dabl.Class.extend({_oldValues:null,_isNew:!0,_validationErrors:null,init:function(a){this._validationErrors=[];var b={},c=this.constructor;for(var d in c._fields){var e=c._fields[d];"undefined"!=typeof e.value?b[d]=dabl.copy(e.value):e.type===Array?b[d]=[]:b[d]=null}this.fromJSON(b),this.resetModified(),a&&this.fromJSON(a)},toString:function(){return this.constructor._table+":"+JSON.stringify(this.toJSON())},copy:function(){var a=this.constructor,b=new a(this),c=a.getKey();return c&&(b[c]=null),b},isModified:function(a){if(a){var b=this.constructor.getFieldType(a);return!dabl.equals(this[a],this._oldValues[a],b)}for(var a in this.constructor._fields)if(this.isModified(a))return!0;return!1},getModified:function(){var a={};for(var b in this.constructor._fields)this.isModified(b)&&(a[b]=!0);return a},resetModified:function(){return this._oldValues=JSON.parse(JSON.stringify(this)),this},revert:function(){return this.fromJSON(this._oldValues),this.resetModified(),this},fromJSON:function(a){var b=this.constructor;for(var c in b._fields)c in a&&(this[c]=a[c]);return b.coerceValues(this),this},toJSON:function(){var a,b,c,d={},e=this.constructor,f=e._fields;if(this._inToJSON)return null;this._inToJSON=!0,e.coerceValues(this);for(a in f){if(b=this[a],c=f[a].type,b instanceof Array){for(var g=[],h=0,i=b.length;i>h;++h)null!==b[h]&&"function"==typeof b[h].toJSON?g[h]=b[h].toJSON():g[h]=dabl.copy(b[h]);b=g}else b=c===JSON?JSON.stringify(b):c===k.FIELD_TYPE_DATE?dabl.formatDate(b):null!==b&&"function"==typeof b.toJSON?b.toJSON():dabl.copy(b);d[a]=b}return delete this._inToJSON,d},hasKeyValues:function(){var a=this.constructor,b=a._keys;if(0===b.length)return!1;a.coerceValues(this);for(var c=0,d=b.length;d>c;++c){var e=b[c];if(null===this[e])return!1}return!0},getKeyValues:function(){var a={},b=this.constructor,c=b._keys;b.coerceValues(this);for(var d=0,e=c.length;e>d;++d){var f=c[d];a[f]=this[f]}return a},isNew:function(){return this._isNew},setNew:function(a){return this._isNew=a===!0,this},validate:function(){this._validationErrors=[];var a=this.constructor;a.coerceValues(this);for(var b in a._fields){var c=a._fields[b];if(c.required){var d=this[b];(!d||d instanceof Array&&0===d.length)&&this._validationErrors.push(b+" is required.")}}return 0===this._validationErrors.length},getValidationErrors:function(){return this._validationErrors},save:function(a,b){return this.isNew()?this.insert(a,b):this.update(a,b)},insert:function(a,b){return this.callAsync(function(){var a=this.constructor;if(!this.validate())throw new Error("Cannot save "+a._table+" with validation errors:\n"+this.getValidationErrors().join("\n"));return this.isNew()&&a.hasField("created")&&!this.isModified("created")&&(this.created=new Date),(this.isNew()||this.isModified())&&a.hasField("updated")&&!this.isModified("updated")&&(this.updated=new Date),this.constructor._adapter.insert(this)},a,b)},update:function(a,b,c){return"function"==typeof a&&(b=a,c=b),this.callAsync(function(){var b=this.constructor;if(!this.validate())throw new Error("Cannot save "+b._table+" with validation errors:\n"+this.getValidationErrors().join("\n"));if(0===b._keys.length)throw new Error("Cannot update without primary keys");return this.isNew()&&b.hasField("created")&&!this.isModified("created")&&(this.created=new Date),(this.isNew()||this.isModified())&&b.hasField("updated")&&!this.isModified("updated")&&(this.updated=new Date),"object"==typeof a&&this.fromJSON(a),b._adapter.update(this)},b,c)},remove:function(a,b){return this.callAsync(function(){return this.constructor._adapter.remove(this)},a,b)}});k.models={},k._fields=k._keys=k._table=null,k._autoIncrement=!1,k.FIELD_TYPE_TEXT="TEXT",k.FIELD_TYPE_NUMERIC="NUMERIC",k.FIELD_TYPE_INTEGER="INTEGER",k.FIELD_TYPE_DATE="DATE",k.FIELD_TYPE_TIME="TIME",k.FIELD_TYPE_TIMESTAMP="TIMESTAMP",k.FIELD_TYPES={TEXT:k.FIELD_TYPE_TEXT,NUMERIC:k.FIELD_TYPE_NUMERIC,INTEGER:k.FIELD_TYPE_INTEGER,DATE:k.FIELD_TYPE_DATE,TIME:k.FIELD_TYPE_TIME,TIMESTAMP:k.FIELD_TYPE_TIMESTAMP},k.TEXT_TYPES={TEXT:k.FIELD_TYPE_TEXT,DATE:k.FIELD_TYPE_DATE,TIME:k.FIELD_TYPE_TIME,TIMESTAMP:k.FIELD_TYPE_TIMESTAMP},k.INTEGER_TYPES={INTEGER:k.FIELD_TYPE_INTEGER},k.TEMPORAL_TYPES={DATE:k.FIELD_TYPE_DATE,TIME:k.FIELD_TYPE_TIME,TIMESTAMP:k.FIELD_TYPE_TIMESTAMP},k.NUMERIC_TYPES={INTEGER:k.FIELD_TYPE_INTEGER,NUMERIC:k.FIELD_TYPE_NUMERIC},k.isFieldType=function(a){return a in k.FIELD_TYPES||this.isObjectType(a)},k.isTemporalType=function(a){return a in this.TEMPORAL_TYPES},k.isTextType=function(a){return a in this.TEXT_TYPES},k.isNumericType=function(a){return a in this.NUMERIC_TYPES},k.isIntegerType=function(a){return a in this.INTEGER_TYPES},k.isObjectType=function(a){return a===JSON||"function"==typeof a},k.coerceValue=function(a,b){var c=b.type;if("undefined"==typeof a||null===a){if(c!==Array)return null;a=[]}var d=this.isTemporalType(c),e=this.isNumericType(c);if((e||d)&&""===a)return null;if(e){if(this.isIntegerType(c)){if(a=parseInt(a,10),isNaN(a))throw new Error(a+" is not a valid integer")}else if(a=parseFloat(a,10),isNaN(a))throw new Error(a+" is not a valid float")}else if(d)a instanceof Date||(a=dabl.constructDate(a));else if(c===Array){if(b.elementType){this.convertArray(a,b.elementType);for(var f=0,g=a.length;g>f;++f)a[f]=this.coerceValue(a[f],{type:b.elementType})}}else c===JSON?"string"==typeof a&&(a=JSON.parse(a)):c===this.FIELD_TYPE_TEXT?"string"!=typeof a&&(a+=""):this.isObjectType(c)&&c.isModel&&a.constructor!==c&&(a=c.inflate(a));return a},k.coerceValues=function(a){if(null===a||"undefined"==typeof a)return this;for(var b in this._fields)b in a&&(a[b]=this.coerceValue(a[b],this._fields[b]));return this},k.convertArray=function(a,b){if(!a.modelCollection){a.modelCollection=!0;var c=this;a.push=function(){return Array.prototype.push.apply(this,c.coerceValue(arguments,{type:Array,elementType:b}))},a.unshift=function(){return Array.prototype.unshift.apply(this,c.coerceValue(arguments,{type:Array,elementType:b}))},a.pop=function(){return c.coerceValue(Array.prototype.pop.apply(this,arguments),{type:b})},a.shift=function(){return c.coerceValue(Array.prototype.shift.apply(this,arguments),{type:b})},a.slice=function(){return c.coerceValue(Array.prototype.slice.apply(this,arguments),{type:Array,elementType:b})},a.concat=function(){return c.coerceValue(Array.prototype.concat.apply(this,arguments),{type:Array,elementType:b})},a.splice=function(){for(var a=2,d=arguments.length;d>a;++a)arguments[a]=c.coerceValue(arguments[a],{type:b});return c.coerceValue(Array.prototype.splice.apply(this,arguments),{type:Array,elementType:b})};for(var d=["forEach","every","some","filter","map"],e=0,f=d.length;f>e;++e){var g=d[e];a[g]=function(a){return function(d,e){return Array.prototype[a].call(this,function(){return arguments[0]=c.coerceValue(arguments[0],{type:b}),d.apply(this,arguments)},e)}}(g)}}},k.getAdapter=function(){return this._adapter},k.setAdapter=function(a){return this._adapter=a,this},k.inflate=function(a){var b,c=this.getKey(),d=this._adapter;if(c&&a[c]&&(b=d.cache(this._table,a[c]))){if(b.isModified())return b;b.fromJSON(a)}return b||(b=new this(a)),b.resetModified().setNew(!1),c&&b[c]&&d.cache(this._table,b[c],b),b},k.inflateArray=function(a){var b,c,d;if(a.constructor!==Array){if("undefined"==typeof d.length)throw new Error("Unknown array type for collection.");d=[]}else d=a;for(b=0,c=a.length;c>b;++b)d[b]=this.inflate(a[b]);return this.convertArray(d,this),d},k.getTableName=function(){return this._table},k.getFields=function(){return dabl.copy(this._fields)},k.getField=function(a){return dabl.copy(this._fields[a])},k.getFieldType=function(a){return this._fields[a].type},k.hasField=function(a){return a in this._fields},k.getKeys=function(){return this._keys.slice(0)},k.getKey=function(){return 1===this._keys.length?this._keys[0]:null},k.isAutoIncrement=function(){return this._autoIncrement},k.addField=function(a,b){switch(b.type||(b={type:b}),"string"==typeof b.type&&(b.type=b.type.toUpperCase()),b.type){case"STRING":case String:b.type=this.FIELD_TYPE_TEXT;break;case Number:b.type=this.FIELD_TYPE_NUMERIC;break;case Date:b.type=this.FIELD_TYPE_TIMESTAMP;break;case"INT":b.type=this.FIELD_TYPE_INTEGER}if(b.key&&this._keys.push(a),b.computed&&(this._autoIncrement=!0),!this.isFieldType(b.type))throw new Error(b.type+" is not a valide field type");b.type.isModel&&this._relations.push(a),this._fields[a]=b},k.extend=function(a,b){var c,d,e;if(b=b||{},"undefined"==typeof a)throw new Error("Must provide a table when exending Model");if(c=j.extend.call(this,b.prototype),delete b.prototype,this._table||this._fields)c._keys=dabl.copy(this._keys),c._fields=dabl.copy(this._fields),c._relations=dabl.copy(this._relations);else{if(!b.fields)throw new Error("Must provide fields when exending Model");c._keys=[],c._fields={},c._relations=[]}c._table=a;for(e in b)switch(e){case"url":case"adapter":c["_"+e]=b[e];break;default:c[e]=b[e]}for(d in b.fields)c.addField(d,b.fields[d]);return k.models[a]=c,c},k.isModel=!0,k.toString=function(){return this._table};for(var l=["countAll","findAll","find","removeAll","updateAll"],m=0,n=l.length;n>m;++m){var o=l[m];k[o]=function(a){return function(){for(var b=Array.prototype.slice.call(arguments),c=this.getAdapter(),d=null,e=null,f=b.length-1;f>-1&&!(b[f]instanceof k)&&"function"==typeof b[f];){if(d){e=d,d=b.pop();break}d=b.pop(),--f}return b.unshift(this),this.callAsync(function(){return c[a].apply(c,b)},d,e)}}(o)}for(var p=["findBy","retrieveByField","retrieveByPK","retrieveByPKs","findByPKs"],q=0,r=p.length;r>q;++q)k[p[q]]=k.find;dabl.Model=k;var s=dabl.Class.extend({_conds:null,init:function(a,b,c,d){this._conds=[],0!==arguments.length&&this.and.apply(this,arguments)},_preprocessCondition:function(a,b,c,d){switch(arguments.length){case 0:return null;case 1:return a instanceof t.Statement||a instanceof s&&0!==a._conds.length?[a]:null;case 2:c=b,b=s.EQUAL;case 3:d=s.QUOTE_RIGHT}var e=c instanceof t,f=c instanceof Array;if(f||e){if(!1===e||1!==c.getLimit())switch(b){case s.BETWEEN:break;case s.IN:case s.EQUAL:case"eq":b=s.IN;break;case"ne":case s.NOT_IN:case s.NOT_EQUAL:case s.ALT_NOT_EQUAL:b=s.NOT_IN;break;default:throw new Error(b+" unknown for comparing an array.")}if(f&&0===c.length&&b===s.NOT_IN)return null;if(e){if(!c.getTable())throw new Error("right does not have a table, so it cannot be nested.");d!==s.QUOTE_LEFT&&(d=s.QUOTE_NONE)}}else null===c&&(b===s.NOT_EQUAL||b===s.ALT_NOT_EQUAL||"ne"===b?b=s.IS_NOT_NULL:(b===s.EQUAL||"eq"===b)&&(b=s.IS_NULL)),(b===s.IS_NULL||b===s.IS_NOT_NULL)&&(c=null,d!==s.QUOTE_LEFT&&(d=s.QUOTE_NONE));return[a,b,c,d]},_processCondition:function(a,b,c,d){if(1===arguments.length){if(a instanceof t.Statement)return a;if(a instanceof s)return e=a.getQueryStatement(),e.setString("("+e._qString+")"),e}var e,f,g,h=new t.Statement,i=c instanceof t,j=c instanceof Array;if(!(b in s.SQL.operators))throw new Error('Unsupported SQL operator: "'+b+'"');if("substringof"===b){var k=a;a=c,c=k}if(b=s.SQL.operators[b],(d===s.QUOTE_LEFT||d===s.QUOTE_BOTH)&&(h.addParam(a),a="?"),b===s.CONTAINS?(b=s.LIKE,c="%"+c+"%"):b===s.BEGINS_WITH?(b=s.LIKE,c+="%"):b===s.ENDS_WITH&&(b=s.LIKE,c="%"+c),j||i){if(i)e=c.getQuery(),c="("+e._qString+")",h.addParams(e._params);else if(j){if(g=c.length,2===g&&b===s.BETWEEN)return h.setString(a+" "+b+" ? AND ?"),h.addParams(c),h;if(0===g){if(b===s.IN)return h.setString("(0 = 1)"),h}else if(d===s.QUOTE_RIGHT||d===s.QUOTE_BOTH){h.addParams(c);var l="(";for(f=0;g>f;++f)f>0&&(l+=","),l+="?";c=l+")"}}}else b===s.IS_NULL||b===s.IS_NOT_NULL||d!==s.QUOTE_RIGHT&&d!==s.QUOTE_BOTH||(h.addParam(c),c="?");return h.setString(a+" "+b+(null===c?"":" "+c)),h},prepareInput:function(a){if(a instanceof Array){a=a.slice(0);for(var b=0,c=a.length;c>b;++b)a[b]=this.prepareInput(a[b]);return a}return a===!0||a===!1?a?1:0:null===a||"undefined"==typeof a?"null":parseInt(a,10)===a?a:this.quote(a)},quote:function(a){return"'"+a.replace("'","''")+"'"},_processODataCondition:function(a,b,c,d){if(1===arguments.length){if(a instanceof t.Statement)throw new Error("Unable to use Query.Statement within a Condition to build an OData query");if(a instanceof s)return"("+a.getODataFilter()+")"}if(c instanceof t)throw new Error("Unable to use Query within a Condition to build an OData query");var e,f,g=c instanceof Array;switch((d===s.QUOTE_LEFT||d===s.QUOTE_BOTH)&&(a=this.prepareInput(a)),b){case"startswith":case"endswith":case"substringof":case s.LIKE:case s.CONTAINS:case s.BEGINS_WITH:case s.ENDS_WITH:if(-1!==c.indexOf("%"))throw new Error("Cannot use % in OData queries")}if(b===s.IS_NULL?(b=s.EQUAL,c="null"):b===s.IS_NOT_NULL?(b=s.NOT_EQUAL,c="null"):(d===s.QUOTE_RIGHT||d===s.QUOTE_BOTH)&&(c=this.prepareInput(c)),g){if(f=c.length,2===f&&b===s.BETWEEN)return"("+a+" ge "+c[0]+" and "+a+" le "+c[1]+")";if(0===f&&b===s.IN)return"(0 eq 1)";var h;b===s.IN?(b=" eq ",h=" or "):(b=" ne ",h=" and ");var i="(";for(e=0;f>e;++e)i+=(0!==e?h:"")+a+b+c[e];return i+")"}if(b in s.OData.operators)return b=s.OData.operators[b],a+" "+b+" "+c;if(b in s.OData.functions){var j=s.OData.functions[b],k=j.indexOf("@"),l=j.indexOf("?");return k>l?(j=j.substring(0,k)+c+j.substr(k+1),j=j.substring(0,l)+a+j.substr(l+1)):(j=j.substring(0,l)+a+j.substr(l+1),j=j.substring(0,k)+c+j.substr(k+1)),j}throw new Error("Unexpected arguments: "+arguments.join(", "))},and:function(a,b,c,d){var e;if(a.constructor===Object){for(e in a)this.and(e,a[e]);return this}var f=this._preprocessCondition.apply(this,arguments);return null===f?this:(f.type="AND",this._conds.push(f),this)},addAnd:function(a,b,c,d){return this.and.apply(this,arguments)},add:function(a,b,c,d){return this.and.apply(this,arguments)},filter:function(a,b,c,d){return this.and.apply(this,arguments)},where:function(a,b,c,d){return this.and.apply(this,arguments)},or:function(a,b,c,d){var e;if(a.constructor===Object){for(e in a)this.or(e,a[e]);return this}var f=this._preprocessCondition.apply(this,arguments);return null===f?this:(f.type="OR",this._conds.push(f),this)},addOr:function(a,b,c,d){return this.or.apply(this,arguments)},orWhere:function(a,b,c,d){return this.or.apply(this,arguments)},andNot:function(a,b){return this.and(a,s.NOT_EQUAL,b)},andLike:function(a,b){return this.and(a,s.LIKE,b)},andNotLike:function(a,b){return this.and(a,s.NOT_LIKE,b)},andGreater:function(a,b){return this.and(a,s.GREATER_THAN,b)},andGreaterEqual:function(a,b){return this.and(a,s.GREATER_EQUAL,b)},andLess:function(a,b){return this.and(a,s.LESS_THAN,b)},andLessEqual:function(a,b){return this.and(a,s.LESS_EQUAL,b)},andNull:function(a){return this.and(a,null)},andNotNull:function(a){return this.and(a,s.NOT_EQUAL,null)},andBetween:function(a,b,c){return this.and(a,s.BETWEEN,[b,c])},andBeginsWith:function(a,b){return this.and(a,s.BEGINS_WITH,b)},andEndsWith:function(a,b){return this.and(a,s.ENDS_WITH,b)},andContains:function(a,b){return this.and(a,s.CONTAINS,b)},orNot:function(a,b){return this.or(a,s.NOT_EQUAL,b)},orLike:function(a,b){return this.or(a,s.LIKE,b)},orNotLike:function(a,b){return this.or(a,s.NOT_LIKE,b)},orGreater:function(a,b){return this.or(a,s.GREATER_THAN,b)},orGreaterEqual:function(a,b){return this.or(a,s.GREATER_EQUAL,b)},orLess:function(a,b){return this.or(a,s.LESS_THAN,b)},orLessEqual:function(a,b){return this.or(a,s.LESS_EQUAL,b)},orNull:function(a){return this.or(a,null)},orNotNull:function(a){return this.or(a,s.NOT_EQUAL,null)},orBetween:function(a,b,c){return this.or(a,s.BETWEEN,[b,c])},orBeginsWith:function(a,b){return this.or(a,s.BEGINS_WITH,b)},orEndsWith:function(a,b){return this.or(a,s.ENDS_WITH,b)},orContains:function(a,b){return this.or(a,s.CONTAINS,b)},getQueryStatement:function(a){if(0===this._conds.length)return null;var b,c,d=new t.Statement(a),e="",f=this._conds,g=f.length;for(b=0;g>b;++b)c=this._processCondition.apply(this,f[b]),null!==c&&(e+="\n	",0!==b&&(e+=(1===b&&"OR"===f[0].type?"OR":f[b].type)+" "),e+=c._qString,d.addParams(c._params));return d.setString(e),d},getODataFilter:function(){if(0===this._conds.length)return null;var a,b,c="",d=this._conds,e=d.length;for(a=0;e>a;++a)b=this._processODataCondition.apply(this,d[a]),null!==b&&(0!==a&&(c+=" "+(1===a&&"or"===d[0].type?"or":"OR"===d[a].type?"or":"and")+" "),c+=b);return c},toString:function(){return this.getQueryStatement().toString()},getSimpleJSON:function(){var a={};if(0===this._conds.length)return{};var b,c,d=this._conds,e=d.length;for(b=0;e>b;++b){var c=d[b];if("AND"!==c.type)throw new Error("OR conditions not supported.");if(2===c.length)a[c[0]]=c[1];else{if(c[1]!==s.EQUAL)throw new Error('Cannot export complex condition: "'+this._processCondition.apply(this,c)+'"');a[c[0]]=c[2]}}return a}});s.EQUAL="=",s.NOT_EQUAL="<>",s.ALT_NOT_EQUAL="!=",s.GREATER_THAN=">",s.LESS_THAN="<",s.GREATER_EQUAL=">=",s.LESS_EQUAL="<=",s.LIKE="LIKE",s.BEGINS_WITH="BEGINS_WITH",s.ENDS_WITH="ENDS_WITH",s.CONTAINS="CONTAINS",s.NOT_LIKE="NOT LIKE",s.IN="IN",s.NOT_IN="NOT IN",s.IS_NULL="IS NULL",s.IS_NOT_NULL="IS NOT NULL",s.BETWEEN="BETWEEN",s.BINARY_AND="&",s.BINARY_OR="|",s.SQL={operators:{eq:"=",ne:"<>",gt:">",lt:"<",ge:">=",le:"<=","=":"=","<>":"<>","!=":"<>",">":">","<":"<",">=":">=","<=":"<=","&":"&","|":"|",startswith:"BEGINS_WITH",BEGINS_WITH:"BEGINS_WITH",endswith:"ENDS_WITH",ENDS_WITH:"BEGINS_WITH",substringof:"CONTAINS",CONTAINS:"CONTAINS",LIKE:"LIKE","NOT LIKE":"NOT LIKE",IN:"IN","NOT IN":"NOT IN","IS NULL":"IS NULL","IS NOT NULL":"IS NOT NULL",BETWEEN:"BETWEEN"}},s.OData={operators:{eq:"eq",ne:"ne",gt:"gt",lt:"lt",ge:"ge",le:"le","=":"eq","<>":"ne","!=":"ne",">":"gt","<":"lt",">=":"ge","<=":"le","&":"&","|":"|"},functions:{startswith:"startswith(?, @)",endswith:"endswith(?, @)",substringof:"substringof(@, ?)",BEGINS_WITH:"startswith(?, @)",ENDS_WITH:"endswith(?, @)",CONTAINS:"substringof(@, ?)",LIKE:"tolower(@) eq tolower(?)","NOT LIKE":"tolower(@) ne tolower(?)"}},s.QUOTE_LEFT=1,s.QUOTE_RIGHT=2,s.QUOTE_BOTH=3,s.QUOTE_NONE=4,dabl.Condition=s;var t=s.extend({_action:"SELECT",_columns:null,_table:null,_tableAlias:null,_extraTables:null,_joins:null,_orders:null,_groups:null,_having:null,_limit:null,_offset:0,_distinct:!1,init:function(a,b){this._super(),this._columns=[],this._joins=[],this._orders=[],this._groups=[],a&&(a.constructor===Object?this.and(a):a&&this.setTable(a,b))},setDistinct:function(a){"undefined"==typeof a&&(a=!0),this._distinct=a===!0},setAction:function(a){switch(a){case"SELECT":case"DELETE":case"COUNT":break;default:throw new Error('"'+a+'" is not an allowed Query action.')}return this._action=a,this},getAction:function(){return this._action},addColumn:function(a){return this._columns.push(a),this},setColumns:function(a){return this._columns=a.slice(0),this},select:function(a){return this.setColumns.apply(this,arguments)},getColumns:function(){return this._columns},setGroups:function(a){return this._groups=a,this},getGroups:function(){return this._groups},setTable:function(a,b){if(a instanceof t&&!b)throw new Error("The nested query must have an alias.");return b&&this.setAlias(b),this._table=a,this},from:function(a,b){return this.setTable.apply(this,arguments)},getTable:function(){return this._table},setAlias:function(a){return this._tableAlias=a,this},getAlias:function(){return this._tableAlias},addTable:function(a,b){if(a instanceof t){if(!b)throw new Error("The nested query must have an alias.")}else"undefined"==typeof b&&(b=a);if(b===this._tableAlias||b===this._table)throw new Error('The alias "'+b+'" is is already in use');return null===this._extraTables&&(this._extraTables={}),this._extraTables[b]=a,this},addJoin:function(a,b,c){if(a instanceof t.Join)return this._joins.push(a),this;if(null===b){if(c===t.JOIN||c===t.INNER_JOIN)return this.addTable(a),this;b="1 = 1"}return this._joins.push(new t.Join(a,b,c)),this},join:function(a,b,c){return this.addJoin(a,b,c)},innerJoin:function(a,b){return this.addJoin(a,b,t.INNER_JOIN)},leftJoin:function(a,b){return this.addJoin(a,b,t.LEFT_JOIN)},rightJoin:function(a,b){return this.addJoin(a,b,t.RIGHT_JOIN)},outerJoin:function(a,b){return this.addJoin(a,b,t.OUTER_JOIN)},getJoins:function(){return this._joins},setJoins:function(a){return this._joins=a,this},groupBy:function(a){return this._groups.push(a),this},setHaving:function(a){if(null!==a&&!(a instanceof s))throw new Error("setHaving must be given an instance of Condition");return this._having=a,this},getHaving:function(){return this._having},orderBy:function(a,b){return this._orders.push(arguments),this},limit:function(a,b){if(a=parseInt(a),isNaN(a))throw new Error("Not a number");return this._limit=a,arguments.length>1&&this.setOffset(b),this},top:function(a,b){return this.limit.apply(this,arguments)},getLimit:function(){return this._limit},offset:function(a){if(a=parseInt(a),isNaN(a))throw new Error("Not a number.");return this._offset=a,this},skip:function(a){return this.offset.apply(this,arguments)},setPage:function(a){if(a=parseInt(a),isNaN(a))throw new Error("Not a number.");if(2>a)return this._offset=null,this;if(!this._limit)throw new Error("Cannot set page without first setting limit.");return this._offset=a*this._limit-this._limit,this},hasAggregates:function(){if(0!==this._groups.length)return!0;for(var a=0,b=this._columns.length;b>a;++a)if(-1!==this._columns[a].indexOf("("))return!0;return!1},needsComplexCount:function(){return this.hasAggregates()||null!==this._having||this._distinct},getQuery:function(a){"undefined"==typeof a&&(a=new SQLAdapter);var b,c,d,e,f,g,h,i,j,k=new t.Statement(a);switch(b="",this._action){default:case t.ACTION_COUNT:case t.ACTION_SELECT:c=this.getColumnsClause(a),k.addParams(c._params),b+="SELECT "+c._qString;break;case t.ACTION_DELETE:b+="DELETE"}if(d=this.getTablesClause(a),k.addParams(d._params),b+="\nFROM "+d._qString,0!==this._joins.length)for(e=0,f=this._joins.length;f>e;++e)g=this._joins[e],h=g.getQueryStatement(a),b+="\n	"+h._qString,k.addParams(h._params);if(i=this.getWhereClause(),null!==i&&(b+="\nWHERE "+i._qString,k.addParams(i._params)),0!==this._groups.length&&(b+="\nGROUP BY "+this._groups.join(", ")),null!==this.getHaving()&&(j=this.getHaving().getQueryStatement(),j&&(b+="\nHAVING "+j._qString,k.addParams(j._params))),this._action!==t.ACTION_COUNT&&0!==this._orders.length)for(b+="\nORDER BY ",e=0,f=this._orders.length;f>e;++e){var l=this._orders[e][0],m=this._orders[e][1];null!==m&&"undefined"!=typeof m&&(l=l+" "+m),0!==e&&(b+=", "),b+=l}return null!==this._limit&&(a?b=a.applyLimit(b,this._offset,this._limit):b+="\nLIMIT "+(this._offset?this._offset+", ":"")+this._limit),this._action===t.ACTION_COUNT&&this.needsComplexCount()&&(b="SELECT count(0)\nFROM ("+b+") a"),k.setString(b),k},getTablesClause:function(a){var b,c,d,e,f,g,h,i,j=this._table;if(!j)throw new Error("No table specified.");switch(b=new t.Statement(a),c=this._tableAlias,j instanceof t?(d=j.getQuery(a),f="("+d._qString+")"):(d=null,f=j),this._action){case t.ACTION_COUNT:case t.ACTION_SELECT:if(null!==d&&b.addParams(d._params),c&&(f=f+" AS "+c),null!==this._extraTables)for(e in this._extraTables)g=this._extraTables[e],g instanceof t?(h=g.getQuery(a),i="("+h._qString+") AS "+e,b.addParams(h._params)):(i=g,e!==g&&(i=i+" AS "+e)),f=f+", "+i;b.setString(f);break;case t.ACTION_DELETE:null!==d&&b.addParams(d._params),c&&(f=f+" AS "+c),b.setString(f)}return b},getColumnsClause:function(a){var b,c,d,e,f,g=this._table,h=new t.Statement(a),i=this._tableAlias,j=this._action;if(j===t.ACTION_DELETE)return h;if(!g)throw new Error("No table specified.");if(j===t.ACTION_COUNT){if(!this.needsComplexCount())return h.setString("count(0)"),h;if(0!==this._groups.length)return h.setString(this._groups.join(", ")),h;if(!this._distinct&&null===this.getHaving()&&0!==this._columns.length){for(e=[],c=0,d=this._columns.length;d>c;++c)b=this._columns[c],-1!==b.indexOf("(")&&e.push(b);if(0!==e.length)return h.setString(e.join(", ")),h}}return f=0!==this._columns.length?this._columns.join(", "):i?i+".*":g+".*",this._distinct&&(f="DISTINCT "+f),h.setString(f),h},getWhereClause:function(a){return this.getQueryStatement(a)},toString:function(){return this._table||this.setTable("{UNSPECIFIED-TABLE}"),this.getQuery().toString()},getCountQuery:function(a){if(!this._table)throw new Error("No table specified.");return this.setAction(t.ACTION_COUNT),this.getQuery(a)},getDeleteQuery:function(a){if(!this._table)throw new Error("No table specified.");return this.setAction(t.ACTION_DELETE),this.getQuery(a)},getSelectQuery:function(a){if(!this._table)throw new Error("No table specified.");return this.setAction(t.ACTION_SELECT),this.getQuery(a)},getODataQuery:function(){if(this._joins&&0!==this._joins.length)throw new Error("JOINS cannot be exported.");if(this._extraTables&&0!==this._extraTables.length)throw new Error("Extra tables cannot be exported.");if(this._having&&0!==this._having.length)throw new Error("Having cannot be exported.");if(this._groups&&0!==this._groups.length)throw new Error("Grouping cannot be exported.");var a={};0!==this._columns.length&&(a.$select=this._columns.join(","));var b=this.getODataFilter();return b&&(a.$filter=b),this._limit&&(a.$top=this._limit,this._offset&&(a.$skip=this._offset)),this._orders&&0!==this._orders.length&&(a.$orderby=this._orders[0][0],this._orders[0][1]===t.DESC&&(a.$orderby+=" desc")),a},getSimpleJSON:function(){if(this._joins&&0!==this._joins.length)throw new Error("JOINS cannot be exported.");if(this._extraTables&&0!==this._extraTables.length)throw new Error("Extra tables cannot be exported.");if(this._having&&0!==this._having.length)throw new Error("Having cannot be exported.");if(this._groups&&0!==this._groups.length)throw new Error("Grouping cannot be exported.");var a=this._super();return this._limit&&(a.limit=this._limit,this._offset&&(a.offset=this._offset,a.page=Math.floor(this._offset/this._limit)+1)),this._orders&&0!==this._orders.length&&(a.order_by=this._orders[0][0],this._orders[0][1]===t.DESC&&(a.dir=t.DESC)),this._action===t.ACTION_COUNT&&(a.count_only=1),a}});t.ACTION_COUNT="COUNT",t.ACTION_DELETE="DELETE",t.ACTION_SELECT="SELECT",t.JOIN="JOIN",t.LEFT_JOIN="LEFT JOIN",t.RIGHT_JOIN="RIGHT JOIN",t.INNER_JOIN="INNER JOIN",t.OUTER_JOIN="OUTER JOIN",t.ASC="ASC",t.DESC="DESC",dabl.Query=t;var u=/^\w+\.\w+$/,v=function(a,b,c){return arguments.length<3&&(c=t.JOIN),a instanceof t||b instanceof s||!u.test(b)||!u.test(a)?void this.setTable(a).setOnClause(b).setJoinType(c):(this._isLikePropel=!0,this._leftColumn=a,this._rightColumn=b,this._table=b.substring(0,b.indexOf(".")),void(this._joinType=c))};v.prototype={_table:null,_alias:null,_onClause:null,_isLikePropel:!1,_leftColumn:null,_rightColumn:null,_joinType:t.JOIN,
toString:function(){return this.getTable()||this.setTable("{UNSPECIFIED-TABLE}"),this.getQueryStatement().toString()},setTable:function(a){var b=a.lastIndexOf(" "),c=-1===b?-1:a.toUpperCase().lastIndexOf(" AS ");return c!==b-3&&(c=-1),-1!==b&&(this.setAlias(a.substr(b+1)),a=a.substring(0,-1===c?b:c)),this._table=a,this},setAlias:function(a){return this._alias=a,this},setOnClause:function(a){return this._isLikePropel=!1,this._onClause=a,this},setJoinType:function(a){return this._joinType=a,this},getQueryStatement:function(a){var b,c,d=this._table,e=this._onClause,f=this._joinType,g=this._alias;return d instanceof t?(b=d.getQuery(a),d="("+b._qString+")",b.setString("")):b=new t.Statement(a),g&&(d+=" AS "+g),this._isLikePropel?e=this._leftColumn+" = "+this._rightColumn:null===e?e="1 = 1":e instanceof s&&(c=e.getQueryStatement(),e=c._qString,b.addParams(c.getParams())),""!==e&&(e="ON ("+e+")"),b.setString(f+" "+d+" "+e),b},getTable:function(){return this._table},getAlias:function(){return this._alias},getOnClause:function(){return this._isLikePropel?this._leftColumn+" = "+this._rightColumn:this._onClause},getJoinType:function(){return this._joinType}},dabl.Query.Join=v;var w=function(a){this._params=[],a&&(this._conn=a)};w.embedParams=function(a,b,c){c&&(b=c.prepareInput(b));var d="?";if(a.split(d).length-1!==b.length)throw new Error("The number of occurances of "+d+" do not match the number of _params.");if(0===b.length)return a;var e,f,g=a.length,h=d.length;for(e=b.length-1;e>=0;--e){if(f=b[e],g=a.lastIndexOf(d,g),-1===g)throw new Error("The number of occurances of "+d+" do not match the number of _params.");a=a.substring(0,g)+f+a.substr(g+h)}return a},w.prototype={_qString:"",_params:null,_conn:null,setConnection:function(a){this._conn=a},getConnection:function(){return this._conn},setString:function(a){this._qString=a},getString:function(){return this._qString},addParams:function(a){this._params=this._params.concat(a)},setParams:function(a){this._params=a.slice(0)},addParam:function(a){this._params.push(a)},getParams:function(){return this._params.slice(0)},toString:function(){return t.Statement.embedParams(this._qString,this._params.slice(0),this._conn)}},dabl.Query.Statement=w;var x=dabl.Class.extend({_cache:null,init:function(){this._cache={}},cache:function(a,b,c){return this._cache[a]||(this._cache[a]={}),arguments.length<3?this._cache[a][b]?this._cache[a][b]:null:(this._cache[a][b]=c,this)},emptyCache:function(a){delete this._cache[a]},formatDate:function(a,b){return a?b&&b===dabl.Model.FIELD_TYPE_TIMESTAMP?this.formatDateTime(a):(a instanceof Date||(a=dabl.constructDate(a)),a.getUTCFullYear()+"-"+dabl.sPad(a.getUTCMonth()+1)+"-"+dabl.sPad(a.getUTCDate())):null},formatDateTime:function(a){return a?(a instanceof Date||(a=dabl.constructDate(a)),a.getFullYear()+"-"+dabl.sPad(a.getMonth()+1)+"-"+dabl.sPad(a.getDate())+" "+dabl.sPad(a.getHours())+":"+dabl.sPad(a.getMinutes())+":"+dabl.sPad(a.getSeconds())):null},findQuery:function(a){var b=Array.prototype.slice.call(arguments),c=(new t).setTable(a.getTableName()),d=a.getKey();b.shift();var e=b.length;if(0===e)return c;if(1===e){if("object"==typeof b[0]){if(b[0]instanceof t)return b[0].getTable()||b[0].setTable(a.getTableName()),b[0];c.and(b[0])}else if(d){var f=parseInt(b[0],10);isNaN(f)?c.and(d,b[0]):c.and(d,f)}}else{if(2!==e&&3!==e&&4!==e||"string"!=typeof b[0])throw new Error("Unknown arguments for find: ("+b.join(", ")+")");c.and.apply(c,b)}return c},find:function(a){throw new Error("find not implemented for this adapter")},findAll:function(a){throw new Error("findAll not implemented for this adapter")},countAll:function(a,b){throw new Error("countAll not implemented for this adapter")},removeAll:function(a,b){throw new Error("removeAll not implemented for this adapter")},insert:function(a){throw new Error("insert not implemented for this adapter")},update:function(a){throw new Error("update not implemented for this adapter")},remove:function(a){throw new Error("remove not implemented for this adapter")}});dabl.Adapter=x}({},function(){return this}());