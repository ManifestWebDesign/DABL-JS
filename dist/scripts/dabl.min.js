!function(a,b){function c(a){return a+="",2===a.length?a:"0"+a}function d(a){if(null===a)return null;if(a instanceof p)return a.constructor(a);if(a instanceof Array)return a.slice(0);if(a instanceof Date)return new Date(a.getTime());switch(typeof a){case"string":case"boolean":case"number":case"undefined":case"function":return a}var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function e(a,b,c){if(c&&c===p.FIELD_TYPE_DATE?(a=f(a),b=f(b)):c&&c===p.FIELD_TYPE_TIMESTAMP&&(a=g(a),b=g(b)),a instanceof Date&&b instanceof Date)return a.getTime()===b.getTime();if(c&&c===JSON)"string"!=typeof a&&(a=JSON.stringify(a)),"string"!=typeof b&&(b=JSON.stringify(b));else if("object"==typeof a)return JSON.stringify(a)===JSON.stringify(b);return a===b}function f(a){return a instanceof Date||(a=g(a)),a?a.getUTCFullYear()+"-"+c(a.getUTCMonth()+1)+"-"+c(a.getUTCDate()):null}function g(a){if(a===!1||""===a||"undefined"==typeof a)return null;if(a instanceof Date)return a;var b=new Date(a);if(isNaN(b.getTime()))throw new Error(a+" is not a valid date");return b}function h(a){return"[object Array]"===Object.prototype.toString.call(a)}function i(a,b){if(h(a))for(var c=0;c<a.length;c++)b(a[c]);else b(a)}function j(a){var b="pending",c=[],d=[],e=[],f=null,g={done:function(){for(var a=0;a<arguments.length;a++)if(arguments[a])if(h(arguments[a]))for(var d=arguments[a],e=0;e<d.length;e++)"resolved"===b&&d[e].apply(this,f),c.push(d[e]);else"resolved"===b&&arguments[a].apply(this,f),c.push(arguments[a]);return this},fail:function(){for(var a=0;a<arguments.length;a++)if(arguments[a])if(h(arguments[a]))for(var c=arguments[a],e=0;e<c.length;e++)"rejected"===b&&c[e].apply(this,f),d.push(c[e]);else"rejected"===b&&arguments[a].apply(this,f),d.push(arguments[a]);return this},always:function(){return this.done.apply(this,arguments).fail.apply(this,arguments)},progress:function(){for(var a=0;a<arguments.length;a++)if(arguments[a])if(h(arguments[a]))for(var c=arguments[a],d=0;d<c.length;d++)"pending"===b&&e.push(c[d]);else"pending"===b&&e.push(arguments[a]);return this},then:function(){return arguments.length>1&&arguments[1]&&this.fail(arguments[1]),arguments.length>0&&arguments[0]&&this.done(arguments[0]),arguments.length>2&&arguments[2]&&this.progress(arguments[2]),this},promise:function(a){if(null==a)return g;for(var b in g)a[b]=g[b];return a},state:function(){return b},debug:function(){console.log("[debug]",c,d,b)},isRejected:function(){return"rejected"===b},isResolved:function(){return"resolved"===b},pipe:function(a,b){return j(function(c){i(a,function(a){"function"==typeof a?k.done(function(){var b=a.apply(this,arguments);b&&"function"==typeof b?b.promise().then(c.resolve,c.reject,c.notify):c.resolve(b)}):k.done(c.resolve)}),i(b,function(a){"function"==typeof a?k.fail(function(){var b=a.apply(this,arguments);b&&"function"==typeof b?b.promise().then(c.resolve,c.reject,c.notify):c.reject(b)}):k.fail(c.reject)})}).promise()}},k={resolveWith:function(a){if("pending"===b){b="resolved";for(var d=f=arguments.length>1?arguments[1]:[],e=0;e<c.length;e++)c[e].apply(a,d)}return this},rejectWith:function(a){if("pending"===b){b="rejected";for(var c=f=arguments.length>1?arguments[1]:[],e=0;e<d.length;e++)d[e].apply(a,c)}return this},notifyWith:function(a){if("pending"===b)for(var c=f=arguments.length>1?arguments[1]:[],d=0;d<e.length;d++)e[d].apply(a,c);return this},resolve:function(){return this.resolveWith(this,arguments)},reject:function(){return this.rejectWith(this,arguments)},notify:function(){return this.notifyWith(this,arguments)}},l=g.promise(k);return a&&a.apply(l,[l]),l}function k(a,b,c){var d;for(d in a)b[d]="function"==typeof a[d]&&"function"==typeof c[d]&&n.test(a[d])?function(a,b){return function(){var d,e=this._super;return this._super=c[a],d=b.apply(this,arguments),this._super=e,d}}(d,a[d]):a[d]}function l(a){try{return Object.defineProperty(a,"sentinel",{value:"foo"}),"sentinel"in a}catch(b){return!1}}b["true"]=a,dabl="undefined"==typeof dabl?{}:dabl,"undefined"!=typeof jQuery&&jQuery.Deferred?dabl.Deferred=jQuery.Deferred:(j.when=function(){if(arguments.length<2){var a=arguments.length?arguments[0]:void 0;return a&&"function"==typeof a.isResolved&&"function"==typeof a.isRejected?a.promise():j().resolve(a).promise()}return function(a){for(var b=j(),c=a.length,d=0,e=new Array(c),f=0;f<a.length;f++)!function(f){a[f].done(function(){e[f]=arguments.length<2?arguments[0]:arguments,++d===c&&b.resolve.apply(b,e)}).fail(function(){b.reject(arguments)})}(f);return b.promise()}(arguments)},dabl.Deferred=j);var m=!1,n=/xyz/.test(function(){})?/\b_super\b/:/.*/,o=function(){};o.canDefineProperties=l({}),o.extend=function(a,b){function c(){!m&&this.init&&this.init.apply(this,arguments)}"undefined"==typeof a&&(a={}),"undefined"==typeof b&&(b={});var d,e;m=!0,d=new this,m=!1;for(e in this)e in b||!this.hasOwnProperty(e)||(c[e]=this[e]);return k(a,d,this.prototype),k(b,c,this),c.prototype=d,c.prototype.constructor=c,c},o.callAsync=o.prototype.callAsync=function(a,b,c){var d=dabl.Deferred(),e=d.promise();try{var f=a.call(this);f&&"function"==typeof f.then?e=f:d.resolve(f)}catch(g){d.reject(g)}return("function"==typeof b||"function"==typeof c)&&e.then(b,c),e},dabl.Class=o;var p=dabl.Class.extend({_oldValues:null,_isNew:!0,_validationErrors:null,init:function(a){this._validationErrors=[];var b={},c=this.constructor;for(var e in c._fields){var f=c._fields[e];b[e]="undefined"!=typeof f.value?d(f.value):f.type===Array?[]:null}this.fromJSON(b),this.resetModified(),a&&this.fromJSON(a)},toString:function(){return this.constructor._table+":"+JSON.stringify(this.toJSON())},copy:function(){var a=this.constructor,b=new a(this),c=a.getKey();return c&&(b[c]=null),b},isModified:function(a){if(a){var b=this.constructor.getFieldType(a);return!e(this[a],this._oldValues[a],b)}for(var a in this.constructor._fields)if(this.isModified(a))return!0;return!1},getModified:function(){var a={};for(var b in this.constructor._fields)this.isModified(b)&&(a[b]=!0);return a},resetModified:function(){return this._oldValues=JSON.parse(JSON.stringify(this)),this},revert:function(){return this.fromJSON(this._oldValues),this.resetModified(),this},fromJSON:function(a){var b=this.constructor;for(var c in b._fields)c in a&&(this[c]=a[c]);return b.coerceValues(this),this},toJSON:function(){var a,b,c,e={},g=this.constructor,h=g._fields;if(this._inToJSON)return null;this._inToJSON=!0,g.coerceValues(this);for(a in h){if(b=this[a],c=h[a].type,b instanceof Array){for(var i=[],j=0,k=b.length;k>j;++j)i[j]=null!==b[j]&&"function"==typeof b[j].toJSON?b[j].toJSON():d(b[j]);b=i}else b=c===JSON?JSON.stringify(b):c===p.FIELD_TYPE_DATE?f(b):null!==b&&"function"==typeof b.toJSON?b.toJSON():d(b);e[a]=b}return delete this._inToJSON,e},hasKeyValues:function(){var a=this.constructor,b=a._keys;if(0===b.length)return!1;a.coerceValues(this);for(var c=0,d=b.length;d>c;++c){var e=b[c];if(null===this[e])return!1}return!0},getKeyValues:function(){var a={},b=this.constructor,c=b._keys;b.coerceValues(this);for(var d=0,e=c.length;e>d;++d){var f=c[d];a[f]=this[f]}return a},isNew:function(){return this._isNew},setNew:function(a){return this._isNew=a===!0,this},validate:function(){this._validationErrors=[];var a=this.constructor;a.coerceValues(this);for(var b in a._fields){var c=a._fields[b];if(c.required){var d=this[b];(!d||d instanceof Array&&0===d.length)&&this._validationErrors.push(b+" is required.")}}return 0===this._validationErrors.length},getValidationErrors:function(){return this._validationErrors},save:function(a,b){return this.isNew()?this.insert(a,b):this.update(a,b)},insert:function(a,b){return this.callAsync(function(){var a=this.constructor;if(!this.validate())throw new Error("Cannot save "+a._table+" with validation errors:\n"+this.getValidationErrors().join("\n"));return this.isNew()&&a.hasField("created")&&!this.isModified("created")&&(this.created=new Date),(this.isNew()||this.isModified())&&a.hasField("updated")&&!this.isModified("updated")&&(this.updated=new Date),this.constructor._adapter.insert(this)},a,b)},update:function(a,b,c){return"function"==typeof a&&(b=a,c=b),this.callAsync(function(){var b=this.constructor;if(!this.validate())throw new Error("Cannot save "+b._table+" with validation errors:\n"+this.getValidationErrors().join("\n"));if(0===b._keys.length)throw new Error("Cannot update without primary keys");return this.isNew()&&b.hasField("created")&&!this.isModified("created")&&(this.created=new Date),(this.isNew()||this.isModified())&&b.hasField("updated")&&!this.isModified("updated")&&(this.updated=new Date),"object"==typeof a&&this.fromJSON(a),b._adapter.update(this)},b,c)},remove:function(a,b){return this.callAsync(function(){return this.constructor._adapter.remove(this)},a,b)}});p.models={},p._fields=p._keys=p._table=null,p._autoIncrement=!1,p.FIELD_TYPE_TEXT="TEXT",p.FIELD_TYPE_NUMERIC="NUMERIC",p.FIELD_TYPE_INTEGER="INTEGER",p.FIELD_TYPE_DATE="DATE",p.FIELD_TYPE_TIME="TIME",p.FIELD_TYPE_TIMESTAMP="TIMESTAMP",p.FIELD_TYPES={TEXT:p.FIELD_TYPE_TEXT,NUMERIC:p.FIELD_TYPE_NUMERIC,INTEGER:p.FIELD_TYPE_INTEGER,DATE:p.FIELD_TYPE_DATE,TIME:p.FIELD_TYPE_TIME,TIMESTAMP:p.FIELD_TYPE_TIMESTAMP},p.TEXT_TYPES={TEXT:p.FIELD_TYPE_TEXT,DATE:p.FIELD_TYPE_DATE,TIME:p.FIELD_TYPE_TIME,TIMESTAMP:p.FIELD_TYPE_TIMESTAMP},p.INTEGER_TYPES={INTEGER:p.FIELD_TYPE_INTEGER},p.TEMPORAL_TYPES={DATE:p.FIELD_TYPE_DATE,TIME:p.FIELD_TYPE_TIME,TIMESTAMP:p.FIELD_TYPE_TIMESTAMP},p.NUMERIC_TYPES={INTEGER:p.FIELD_TYPE_INTEGER,NUMERIC:p.FIELD_TYPE_NUMERIC},p.isFieldType=function(a){return a in p.FIELD_TYPES||this.isObjectType(a)},p.isTemporalType=function(a){return a in this.TEMPORAL_TYPES},p.isTextType=function(a){return a in this.TEXT_TYPES},p.isNumericType=function(a){return a in this.NUMERIC_TYPES},p.isIntegerType=function(a){return a in this.INTEGER_TYPES},p.isObjectType=function(a){return a===JSON||"function"==typeof a},p.coerceValue=function(a,b){var c=b.type;if("undefined"==typeof a||null===a){if(c!==Array)return null;a=[]}var d=this.isTemporalType(c),e=this.isNumericType(c);if((e||d)&&""===a)return null;if(e){if(this.isIntegerType(c)){if(a=parseInt(a,10),isNaN(a))throw new Error(a+" is not a valid integer")}else if(a=parseFloat(a,10),isNaN(a))throw new Error(a+" is not a valid float")}else if(d)a instanceof Date||(a=g(a));else if(c===Array){if(b.elementType){this.convertArray(a,b.elementType);for(var f=0,h=a.length;h>f;++f)a[f]=this.coerceValue(a[f],{type:b.elementType})}}else c===JSON?"string"==typeof a&&(a=JSON.parse(a)):c===this.FIELD_TYPE_TEXT?"string"!=typeof a&&(a+=""):this.isObjectType(c)&&c.isModel&&a.constructor!==c&&(a=c.inflate(a));return a},p.coerceValues=function(a){if(null===a||"undefined"==typeof a)return this;for(var b in this._fields)b in a&&(a[b]=this.coerceValue(a[b],this._fields[b]));return this},p.convertArray=function(a,b){if(!a.modelCollection){a.modelCollection=!0;var c=this;a.push=function(){return Array.prototype.push.apply(this,c.coerceValue(arguments,{type:Array,elementType:b}))},a.unshift=function(){return Array.prototype.unshift.apply(this,c.coerceValue(arguments,{type:Array,elementType:b}))},a.pop=function(){return c.coerceValue(Array.prototype.pop.apply(this,arguments),{type:b})},a.shift=function(){return c.coerceValue(Array.prototype.shift.apply(this,arguments),{type:b})},a.slice=function(){return c.coerceValue(Array.prototype.slice.apply(this,arguments),{type:Array,elementType:b})},a.concat=function(){return c.coerceValue(Array.prototype.concat.apply(this,arguments),{type:Array,elementType:b})},a.splice=function(){for(var a=2,d=arguments.length;d>a;++a)arguments[a]=c.coerceValue(arguments[a],{type:b});return c.coerceValue(Array.prototype.splice.apply(this,arguments),{type:Array,elementType:b})};for(var d=["forEach","every","some","filter","map"],e=0,f=d.length;f>e;++e){var g=d[e];a[g]=function(a){return function(d,e){return Array.prototype[a].call(this,function(){return arguments[0]=c.coerceValue(arguments[0],{type:b}),d.apply(this,arguments)},e)}}(g)}}},p.getAdapter=function(){return this._adapter},p.setAdapter=function(a){return this._adapter=a,this},p.inflate=function(a){var b,c=this.getKey(),d=this.getAdapter();if(c&&a[c]&&(b=d.cache(this._table,a[c]))){if(b.isModified())return b;b.fromJSON(a)}return b||(b=new this(a)),b.resetModified().setNew(!1),c&&b[c]&&d.cache(this._table,b[c],b),b},p.inflateArray=function(a){var b,c,d;if(a.constructor!==Array){if("undefined"==typeof d.length)throw new Error("Unknown array type for collection.");d=[]}else d=a;for(b=0,c=a.length;c>b;++b)d[b]=this.inflate(a[b]);return this.convertArray(d,this),d},p.getTableName=function(){return this._table},p.getFields=function(){return d(this._fields)},p.getField=function(a){return d(this._fields[a])},p.getFieldType=function(a){return this._fields[a].type},p.hasField=function(a){return a in this._fields},p.getKeys=function(){return this._keys.slice(0)},p.getKey=function(){return 1===this._keys.length?this._keys[0]:null},p.isAutoIncrement=function(){return this._autoIncrement},p.addField=function(a,b){switch(b.type||(b={type:b}),"string"==typeof b.type&&(b.type=b.type.toUpperCase()),b.type){case"STRING":case String:b.type=this.FIELD_TYPE_TEXT;break;case Number:b.type=this.FIELD_TYPE_NUMERIC;break;case Date:b.type=this.FIELD_TYPE_TIMESTAMP;break;case"INT":b.type=this.FIELD_TYPE_INTEGER}if(b.key&&this._keys.push(a),b.computed&&(this._autoIncrement=!0),!this.isFieldType(b.type))throw new Error(b.type+" is not a valide field type");b.type.isModel&&this._relations.push(a),this._fields[a]=b},p.extend=function(a,b){var c,e,f;if(b=b||{},"undefined"==typeof a)throw new Error("Must provide a table when exending Model");if(c=o.extend.call(this,b.prototype),delete b.prototype,this._table||this._fields)c._keys=d(this._keys),c._fields=d(this._fields),c._relations=d(this._relations);else{if(!b.fields)throw new Error("Must provide fields when exending Model");c._keys=[],c._fields={},c._relations=[]}c._table=a;for(f in b)switch(f){case"url":case"adapter":c["_"+f]=b[f];break;default:c[f]=b[f]}for(e in b.fields)c.addField(e,b.fields[e]);return p.models[a]=c,c},p.isModel=!0,p.toString=function(){return this._table};for(var q=["countAll","findAll","find","removeAll","updateAll"],r=0,s=q.length;s>r;++r){var t=q[r];p[t]=function(a){return function(){for(var b=Array.prototype.slice.call(arguments),c=this.getAdapter(),d=null,e=null,f=b.length-1;f>-1&&!(b[f]instanceof p)&&"function"==typeof b[f];){if(d){e=d,d=b.pop();break}d=b.pop(),--f}return b.unshift(this),this.callAsync(function(){return c[a].apply(c,b)},d,e)}}(t)}for(var u=["findBy","retrieveByField","retrieveByPK","retrieveByPKs","findByPKs"],v=0,w=u.length;w>v;++v)p[u[v]]=p.find;dabl.Model=p;var x=dabl.Class.extend({_conds:null,init:function(){this._conds=[],0!==arguments.length&&this.and.apply(this,arguments)},_preprocessCondition:function(a,b,c,d){switch(arguments.length){case 0:return null;case 1:return a instanceof y.Statement||a instanceof x&&0!==a._conds.length?[a]:null;case 2:c=b,b=x.EQUAL;case 3:d=x.QUOTE_RIGHT}var e=c instanceof y,f=c instanceof Array;if(f||e){if(!1===e||1!==c.getLimit())switch(b){case x.BETWEEN:break;case x.IN:case x.EQUAL:case"eq":b=x.IN;break;case"ne":case x.NOT_IN:case x.NOT_EQUAL:case x.ALT_NOT_EQUAL:b=x.NOT_IN;break;default:throw new Error(b+" unknown for comparing an array.")}if(f&&0===c.length&&b===x.NOT_IN)return null;if(e){if(!c.getTable())throw new Error("right does not have a table, so it cannot be nested.");d!==x.QUOTE_LEFT&&(d=x.QUOTE_NONE)}}else null===c&&(b===x.NOT_EQUAL||b===x.ALT_NOT_EQUAL||"ne"===b?b=x.IS_NOT_NULL:(b===x.EQUAL||"eq"===b)&&(b=x.IS_NULL)),(b===x.IS_NULL||b===x.IS_NOT_NULL)&&(c=null,d!==x.QUOTE_LEFT&&(d=x.QUOTE_NONE));return[a,b,c,d]},_processCondition:function(a,b,c,d){if(1===arguments.length){if(a instanceof y.Statement)return a;if(a instanceof x)return e=a.getQueryStatement(),e.setString("("+e._qString+")"),e}var e,f,g,h=new y.Statement,i=c instanceof y,j=c instanceof Array;if(!(b in x.SQL.operators))throw new Error('Unsupported SQL operator: "'+b+'"');if("substringof"===b){var k=a;a=c,c=k}if(b=x.SQL.operators[b],(d===x.QUOTE_LEFT||d===x.QUOTE_BOTH)&&(h.addParam(a),a="?"),b===x.CONTAINS?(b=x.LIKE,c="%"+c+"%"):b===x.BEGINS_WITH?(b=x.LIKE,c+="%"):b===x.ENDS_WITH&&(b=x.LIKE,c="%"+c),j||i){if(i)e=c.getQuery(),c="("+e._qString+")",h.addParams(e._params);else if(j){if(g=c.length,2===g&&b===x.BETWEEN)return h.setString(a+" "+b+" ? AND ?"),h.addParams(c),h;if(0===g){if(b===x.IN)return h.setString("(0 = 1)"),h}else if(d===x.QUOTE_RIGHT||d===x.QUOTE_BOTH){h.addParams(c);var l="(";for(f=0;g>f;++f)f>0&&(l+=","),l+="?";c=l+")"}}}else b===x.IS_NULL||b===x.IS_NOT_NULL||d!==x.QUOTE_RIGHT&&d!==x.QUOTE_BOTH||(h.addParam(c),c="?");return h.setString(a+" "+b+(null===c?"":" "+c)),h},prepareInput:function(a){if(a instanceof Array){a=a.slice(0);for(var b=0,c=a.length;c>b;++b)a[b]=this.prepareInput(a[b]);return a}return a===!0||a===!1?a?1:0:null===a||"undefined"==typeof a?"null":parseInt(a,10)===a?a:this.quote(a)},quote:function(a){return"'"+a.replace("'","''")+"'"},_processODataCondition:function(a,b,c,d){if(1===arguments.length){if(a instanceof y.Statement)throw new Error("Unable to use Query.Statement within a Condition to build an OData query");if(a instanceof x)return"("+a.getODataFilter()+")"}if(c instanceof y)throw new Error("Unable to use Query within a Condition to build an OData query");var e,f,g=c instanceof Array;switch((d===x.QUOTE_LEFT||d===x.QUOTE_BOTH)&&(a=this.prepareInput(a)),b){case"startswith":case"endswith":case"substringof":case x.LIKE:case x.CONTAINS:case x.BEGINS_WITH:case x.ENDS_WITH:if(-1!==c.indexOf("%"))throw new Error("Cannot use % in OData queries")}if(b===x.IS_NULL?(b=x.EQUAL,c="null"):b===x.IS_NOT_NULL?(b=x.NOT_EQUAL,c="null"):(d===x.QUOTE_RIGHT||d===x.QUOTE_BOTH)&&(c=this.prepareInput(c)),g){if(f=c.length,2===f&&b===x.BETWEEN)return"("+a+" ge "+c[0]+" and "+a+" le "+c[1]+")";if(0===f&&b===x.IN)return"(0 eq 1)";var h;b===x.IN?(b=" eq ",h=" or "):(b=" ne ",h=" and ");var i="(";for(e=0;f>e;++e)i+=(0!==e?h:"")+a+b+c[e];return i+")"}if(b in x.OData.operators)return b=x.OData.operators[b],a+" "+b+" "+c;if(b in x.OData.functions){var j=x.OData.functions[b],k=j.indexOf("@"),l=j.indexOf("?");return k>l?(j=j.substring(0,k)+c+j.substr(k+1),j=j.substring(0,l)+a+j.substr(l+1)):(j=j.substring(0,l)+a+j.substr(l+1),j=j.substring(0,k)+c+j.substr(k+1)),j}throw new Error("Unexpected arguments: "+arguments.join(", "))},and:function(a){var b;if(a.constructor===Object){for(b in a)this.and(b,a[b]);return this}var c=this._preprocessCondition.apply(this,arguments);return null===c?this:(c.type="AND",this._conds.push(c),this)},addAnd:function(){return this.and.apply(this,arguments)},add:function(){return this.and.apply(this,arguments)},filter:function(){return this.and.apply(this,arguments)},where:function(){return this.and.apply(this,arguments)},or:function(a){var b;if(a.constructor===Object){for(b in a)this.or(b,a[b]);return this}var c=this._preprocessCondition.apply(this,arguments);return null===c?this:(c.type="OR",this._conds.push(c),this)},addOr:function(){return this.or.apply(this,arguments)},orWhere:function(){return this.or.apply(this,arguments)},andNot:function(a,b){return this.and(a,x.NOT_EQUAL,b)},andLike:function(a,b){return this.and(a,x.LIKE,b)},andNotLike:function(a,b){return this.and(a,x.NOT_LIKE,b)},andGreater:function(a,b){return this.and(a,x.GREATER_THAN,b)},andGreaterEqual:function(a,b){return this.and(a,x.GREATER_EQUAL,b)},andLess:function(a,b){return this.and(a,x.LESS_THAN,b)},andLessEqual:function(a,b){return this.and(a,x.LESS_EQUAL,b)},andNull:function(a){return this.and(a,null)},andNotNull:function(a){return this.and(a,x.NOT_EQUAL,null)},andBetween:function(a,b,c){return this.and(a,x.BETWEEN,[b,c])},andBeginsWith:function(a,b){return this.and(a,x.BEGINS_WITH,b)},andEndsWith:function(a,b){return this.and(a,x.ENDS_WITH,b)},andContains:function(a,b){return this.and(a,x.CONTAINS,b)},orNot:function(a,b){return this.or(a,x.NOT_EQUAL,b)},orLike:function(a,b){return this.or(a,x.LIKE,b)},orNotLike:function(a,b){return this.or(a,x.NOT_LIKE,b)},orGreater:function(a,b){return this.or(a,x.GREATER_THAN,b)},orGreaterEqual:function(a,b){return this.or(a,x.GREATER_EQUAL,b)},orLess:function(a,b){return this.or(a,x.LESS_THAN,b)},orLessEqual:function(a,b){return this.or(a,x.LESS_EQUAL,b)},orNull:function(a){return this.or(a,null)},orNotNull:function(a){return this.or(a,x.NOT_EQUAL,null)},orBetween:function(a,b,c){return this.or(a,x.BETWEEN,[b,c])},orBeginsWith:function(a,b){return this.or(a,x.BEGINS_WITH,b)},orEndsWith:function(a,b){return this.or(a,x.ENDS_WITH,b)},orContains:function(a,b){return this.or(a,x.CONTAINS,b)},getQueryStatement:function(a){if(0===this._conds.length)return null;var b,c,d=new y.Statement(a),e="",f=this._conds,g=f.length;for(b=0;g>b;++b)c=this._processCondition.apply(this,f[b]),null!==c&&(e+="\n	",0!==b&&(e+=(1===b&&"OR"===f[0].type?"OR":f[b].type)+" "),e+=c._qString,d.addParams(c._params));return d.setString(e),d},getODataFilter:function(){if(0===this._conds.length)return null;var a,b,c="",d=this._conds,e=d.length;for(a=0;e>a;++a)b=this._processODataCondition.apply(this,d[a]),null!==b&&(0!==a&&(c+=" "+(1===a&&"or"===d[0].type?"or":"OR"===d[a].type?"or":"and")+" "),c+=b);return c},toString:function(){return this.getQueryStatement().toString()},getSimpleJSON:function(){var a={};if(0===this._conds.length)return{};var b,c,d=this._conds,e=d.length;for(b=0;e>b;++b){var c=d[b];if("AND"!==c.type)throw new Error("OR conditions not supported.");if(2===c.length)a[c[0]]=c[1];else{if(c[1]!==x.EQUAL)throw new Error('Cannot export complex condition: "'+this._processCondition.apply(this,c)+'"');a[c[0]]=c[2]}}return a}});x.EQUAL="=",x.NOT_EQUAL="<>",x.ALT_NOT_EQUAL="!=",x.GREATER_THAN=">",x.LESS_THAN="<",x.GREATER_EQUAL=">=",x.LESS_EQUAL="<=",x.LIKE="LIKE",x.BEGINS_WITH="BEGINS_WITH",x.ENDS_WITH="ENDS_WITH",x.CONTAINS="CONTAINS",x.NOT_LIKE="NOT LIKE",x.IN="IN",x.NOT_IN="NOT IN",x.IS_NULL="IS NULL",x.IS_NOT_NULL="IS NOT NULL",x.BETWEEN="BETWEEN",x.BINARY_AND="&",x.BINARY_OR="|",x.SQL={operators:{eq:"=",ne:"<>",gt:">",lt:"<",ge:">=",le:"<=","=":"=","<>":"<>","!=":"<>",">":">","<":"<",">=":">=","<=":"<=","&":"&","|":"|",startswith:"BEGINS_WITH",BEGINS_WITH:"BEGINS_WITH",endswith:"ENDS_WITH",ENDS_WITH:"BEGINS_WITH",substringof:"CONTAINS",CONTAINS:"CONTAINS",LIKE:"LIKE","NOT LIKE":"NOT LIKE",IN:"IN","NOT IN":"NOT IN","IS NULL":"IS NULL","IS NOT NULL":"IS NOT NULL",BETWEEN:"BETWEEN"}},x.OData={operators:{eq:"eq",ne:"ne",gt:"gt",lt:"lt",ge:"ge",le:"le","=":"eq","<>":"ne","!=":"ne",">":"gt","<":"lt",">=":"ge","<=":"le","&":"&","|":"|"},functions:{startswith:"startswith(?, @)",endswith:"endswith(?, @)",substringof:"substringof(@, ?)",BEGINS_WITH:"startswith(?, @)",ENDS_WITH:"endswith(?, @)",CONTAINS:"substringof(@, ?)",LIKE:"tolower(@) eq tolower(?)","NOT LIKE":"tolower(@) ne tolower(?)"}},x.QUOTE_LEFT=1,x.QUOTE_RIGHT=2,x.QUOTE_BOTH=3,x.QUOTE_NONE=4,dabl.Condition=x;var y=x.extend({_action:"SELECT",_columns:null,_table:null,_tableAlias:null,_extraTables:null,_joins:null,_orders:null,_groups:null,_having:null,_limit:null,_offset:0,_distinct:!1,init:function(a,b){this._super(),this._columns=[],this._joins=[],this._orders=[],this._groups=[],a&&(a.constructor===Object?this.and(a):a&&this.setTable(a,b))},setDistinct:function(a){"undefined"==typeof a&&(a=!0),this._distinct=a===!0},setAction:function(a){switch(a){case"SELECT":case"DELETE":case"COUNT":break;default:throw new Error('"'+a+'" is not an allowed Query action.')}return this._action=a,this},getAction:function(){return this._action},addColumn:function(a){return this._columns.push(a),this},setColumns:function(a){return this._columns=a.slice(0),this},select:function(){return this.setColumns.apply(this,arguments)},getColumns:function(){return this._columns},setGroups:function(a){return this._groups=a,this},getGroups:function(){return this._groups},setTable:function(a,b){if(a instanceof y&&!b)throw new Error("The nested query must have an alias.");return b&&this.setAlias(b),this._table=a,this},from:function(){return this.setTable.apply(this,arguments)},getTable:function(){return this._table},setAlias:function(a){return this._tableAlias=a,this},getAlias:function(){return this._tableAlias},addTable:function(a,b){if(a instanceof y){if(!b)throw new Error("The nested query must have an alias.")}else"undefined"==typeof b&&(b=a);if(b===this._tableAlias||b===this._table)throw new Error('The alias "'+b+'" is is already in use');return null===this._extraTables&&(this._extraTables={}),this._extraTables[b]=a,this},addJoin:function(a,b,c){if(a instanceof y.Join)return this._joins.push(a),this;if(null===b){if(c===y.JOIN||c===y.INNER_JOIN)return this.addTable(a),this;b="1 = 1"}return this._joins.push(new y.Join(a,b,c)),this},join:function(a,b,c){return this.addJoin(a,b,c)},innerJoin:function(a,b){return this.addJoin(a,b,y.INNER_JOIN)},leftJoin:function(a,b){return this.addJoin(a,b,y.LEFT_JOIN)},rightJoin:function(a,b){return this.addJoin(a,b,y.RIGHT_JOIN)},outerJoin:function(a,b){return this.addJoin(a,b,y.OUTER_JOIN)},getJoins:function(){return this._joins},setJoins:function(a){return this._joins=a,this},groupBy:function(a){return this._groups.push(a),this},setHaving:function(a){if(null!==a&&!(a instanceof x))throw new Error("setHaving must be given an instance of Condition");return this._having=a,this},getHaving:function(){return this._having},orderBy:function(){return this._orders.push(arguments),this},limit:function(a,b){if(a=parseInt(a),isNaN(a))throw new Error("Not a number");return this._limit=a,arguments.length>1&&this.setOffset(b),this},top:function(){return this.limit.apply(this,arguments)},getLimit:function(){return this._limit},offset:function(a){if(a=parseInt(a),isNaN(a))throw new Error("Not a number.");return this._offset=a,this},skip:function(){return this.offset.apply(this,arguments)},setPage:function(a){if(a=parseInt(a),isNaN(a))throw new Error("Not a number.");if(2>a)return this._offset=null,this;if(!this._limit)throw new Error("Cannot set page without first setting limit.");return this._offset=a*this._limit-this._limit,this},hasAggregates:function(){if(0!==this._groups.length)return!0;for(var a=0,b=this._columns.length;b>a;++a)if(-1!==this._columns[a].indexOf("("))return!0;return!1},needsComplexCount:function(){return this.hasAggregates()||null!==this._having||this._distinct},getQuery:function(a){"undefined"==typeof a&&(a=new SQLAdapter);var b,c,d,e,f,g,h,i,j,k=new y.Statement(a);switch(b="",this._action){default:case y.ACTION_COUNT:case y.ACTION_SELECT:c=this.getColumnsClause(a),k.addParams(c._params),b+="SELECT "+c._qString;break;case y.ACTION_DELETE:b+="DELETE"}if(d=this.getTablesClause(a),k.addParams(d._params),b+="\nFROM "+d._qString,0!==this._joins.length)for(e=0,f=this._joins.length;f>e;++e)g=this._joins[e],h=g.getQueryStatement(a),b+="\n	"+h._qString,k.addParams(h._params);if(i=this.getWhereClause(),null!==i&&(b+="\nWHERE "+i._qString,k.addParams(i._params)),0!==this._groups.length&&(b+="\nGROUP BY "+this._groups.join(", ")),null!==this.getHaving()&&(j=this.getHaving().getQueryStatement(),j&&(b+="\nHAVING "+j._qString,k.addParams(j._params))),this._action!==y.ACTION_COUNT&&0!==this._orders.length)for(b+="\nORDER BY ",e=0,f=this._orders.length;f>e;++e){var l=this._orders[e][0],m=this._orders[e][1];null!==m&&"undefined"!=typeof m&&(l=l+" "+m),0!==e&&(b+=", "),b+=l}return null!==this._limit&&(a?b=a.applyLimit(b,this._offset,this._limit):b+="\nLIMIT "+(this._offset?this._offset+", ":"")+this._limit),this._action===y.ACTION_COUNT&&this.needsComplexCount()&&(b="SELECT count(0)\nFROM ("+b+") a"),k.setString(b),k},getTablesClause:function(a){var b,c,d,e,f,g,h,i,j=this._table;if(!j)throw new Error("No table specified.");switch(b=new y.Statement(a),c=this._tableAlias,j instanceof y?(d=j.getQuery(a),f="("+d._qString+")"):(d=null,f=j),this._action){case y.ACTION_COUNT:case y.ACTION_SELECT:if(null!==d&&b.addParams(d._params),c&&(f=f+" AS "+c),null!==this._extraTables)for(e in this._extraTables)g=this._extraTables[e],g instanceof y?(h=g.getQuery(a),i="("+h._qString+") AS "+e,b.addParams(h._params)):(i=g,e!==g&&(i=i+" AS "+e)),f=f+", "+i;b.setString(f);break;case y.ACTION_DELETE:null!==d&&b.addParams(d._params),c&&(f=f+" AS "+c),b.setString(f)}return b},getColumnsClause:function(a){var b,c,d,e,f,g=this._table,h=new y.Statement(a),i=this._tableAlias,j=this._action;if(j===y.ACTION_DELETE)return h;if(!g)throw new Error("No table specified.");if(j===y.ACTION_COUNT){if(!this.needsComplexCount())return h.setString("count(0)"),h;if(0!==this._groups.length)return h.setString(this._groups.join(", ")),h;if(!this._distinct&&null===this.getHaving()&&0!==this._columns.length){for(e=[],c=0,d=this._columns.length;d>c;++c)b=this._columns[c],-1!==b.indexOf("(")&&e.push(b);if(0!==e.length)return h.setString(e.join(", ")),h}}return f=0!==this._columns.length?this._columns.join(", "):i?i+".*":g+".*",this._distinct&&(f="DISTINCT "+f),h.setString(f),h},getWhereClause:function(a){return this.getQueryStatement(a)},toString:function(){return this._table||this.setTable("{UNSPECIFIED-TABLE}"),this.getQuery().toString()},getCountQuery:function(a){if(!this._table)throw new Error("No table specified.");return this.setAction(y.ACTION_COUNT),this.getQuery(a)},getDeleteQuery:function(a){if(!this._table)throw new Error("No table specified.");return this.setAction(y.ACTION_DELETE),this.getQuery(a)},getSelectQuery:function(a){if(!this._table)throw new Error("No table specified.");return this.setAction(y.ACTION_SELECT),this.getQuery(a)},getODataQuery:function(){if(this._joins&&0!==this._joins.length)throw new Error("JOINS cannot be exported.");if(this._extraTables&&0!==this._extraTables.length)throw new Error("Extra tables cannot be exported.");if(this._having&&0!==this._having.length)throw new Error("Having cannot be exported.");if(this._groups&&0!==this._groups.length)throw new Error("Grouping cannot be exported.");var a={};0!==this._columns.length&&(a.$select=this._columns.join(","));var b=this.getODataFilter();return b&&(a.$filter=b),this._limit&&(a.$top=this._limit,this._offset&&(a.$skip=this._offset)),this._orders&&0!==this._orders.length&&(a.$orderby=this._orders[0][0],this._orders[0][1]===y.DESC&&(a.$orderby+=" desc")),a},getSimpleJSON:function(){if(this._joins&&0!==this._joins.length)throw new Error("JOINS cannot be exported.");if(this._extraTables&&0!==this._extraTables.length)throw new Error("Extra tables cannot be exported.");if(this._having&&0!==this._having.length)throw new Error("Having cannot be exported.");if(this._groups&&0!==this._groups.length)throw new Error("Grouping cannot be exported.");var a=this._super();return this._limit&&(a.limit=this._limit,this._offset&&(a.offset=this._offset,a.page=Math.floor(this._offset/this._limit)+1)),this._orders&&0!==this._orders.length&&(a.order_by=this._orders[0][0],this._orders[0][1]===y.DESC&&(a.dir=y.DESC)),this._action===y.ACTION_COUNT&&(a.count_only=1),a}});y.ACTION_COUNT="COUNT",y.ACTION_DELETE="DELETE",y.ACTION_SELECT="SELECT",y.JOIN="JOIN",y.LEFT_JOIN="LEFT JOIN",y.RIGHT_JOIN="RIGHT JOIN",y.INNER_JOIN="INNER JOIN",y.OUTER_JOIN="OUTER JOIN",y.ASC="ASC",y.DESC="DESC",dabl.Query=y;var z=/^\w+\.\w+$/,A=function(a,b,c){return arguments.length<3&&(c=y.JOIN),a instanceof y||b instanceof x||!z.test(b)||!z.test(a)?(this.setTable(a).setOnClause(b).setJoinType(c),void 0):(this._isLikePropel=!0,this._leftColumn=a,this._rightColumn=b,this._table=b.substring(0,b.indexOf(".")),this._joinType=c,void 0)};A.prototype={_table:null,_alias:null,_onClause:null,_isLikePropel:!1,_leftColumn:null,_rightColumn:null,_joinType:y.JOIN,toString:function(){return this.getTable()||this.setTable("{UNSPECIFIED-TABLE}"),this.getQueryStatement().toString()},setTable:function(a){var b=a.lastIndexOf(" "),c=-1===b?-1:a.toUpperCase().lastIndexOf(" AS ");return c!==b-3&&(c=-1),-1!==b&&(this.setAlias(a.substr(b+1)),a=a.substring(0,-1===c?b:c)),this._table=a,this},setAlias:function(a){return this._alias=a,this
},setOnClause:function(a){return this._isLikePropel=!1,this._onClause=a,this},setJoinType:function(a){return this._joinType=a,this},getQueryStatement:function(a){var b,c,d=this._table,e=this._onClause,f=this._joinType,g=this._alias;return d instanceof y?(b=d.getQuery(a),d="("+b._qString+")",b.setString("")):b=new y.Statement(a),g&&(d+=" AS "+g),this._isLikePropel?e=this._leftColumn+" = "+this._rightColumn:null===e?e="1 = 1":e instanceof x&&(c=e.getQueryStatement(),e=c._qString,b.addParams(c.getParams())),""!==e&&(e="ON ("+e+")"),b.setString(f+" "+d+" "+e),b},getTable:function(){return this._table},getAlias:function(){return this._alias},getOnClause:function(){return this._isLikePropel?this._leftColumn+" = "+this._rightColumn:this._onClause},getJoinType:function(){return this._joinType}},dabl.Query.Join=A;var B=function(a){this._params=[],a&&(this._conn=a)};B.embedParams=function(a,b,c){c&&(b=c.prepareInput(b));var d="?";if(a.split(d).length-1!==b.length)throw new Error("The number of occurances of "+d+" do not match the number of _params.");if(0===b.length)return a;var e,f,g=a.length,h=d.length;for(e=b.length-1;e>=0;--e){if(f=b[e],g=a.lastIndexOf(d,g),-1===g)throw new Error("The number of occurances of "+d+" do not match the number of _params.");a=a.substring(0,g)+f+a.substr(g+h)}return a},B.prototype={_qString:"",_params:null,_conn:null,setConnection:function(a){this._conn=a},getConnection:function(){return this._conn},setString:function(a){this._qString=a},getString:function(){return this._qString},addParams:function(a){this._params=this._params.concat(a)},setParams:function(a){this._params=a.slice(0)},addParam:function(a){this._params.push(a)},getParams:function(){return this._params.slice(0)},toString:function(){return y.Statement.embedParams(this._qString,this._params.slice(0),this._conn)}},dabl.Query.Statement=B;var C=dabl.Class.extend({_cache:null,init:function(){this._cache={}},cache:function(a,b,c){return this._cache[a]||(this._cache[a]={}),arguments.length<3?this._cache[a][b]?this._cache[a][b]:null:(this._cache[a][b]=c,this)},emptyCache:function(a){delete this._cache[a]},formatDate:function(a,b){return a?b&&b===dabl.Model.FIELD_TYPE_TIMESTAMP?this.formatDateTime(a):(a instanceof Date||(a=g(a)),a.getUTCFullYear()+"-"+c(a.getUTCMonth()+1)+"-"+c(a.getUTCDate())):null},formatDateTime:function(a){return a?(a instanceof Date||(a=g(a)),a.getFullYear()+"-"+c(a.getMonth()+1)+"-"+c(a.getDate())+" "+c(a.getHours())+":"+c(a.getMinutes())+":"+c(a.getSeconds())):null},findQuery:function(a){var b=Array.prototype.slice.call(arguments),c=(new y).setTable(a.getTableName()),d=a.getKey();b.shift();var e=b.length;if(0===e)return c;if(1===e){if("object"==typeof b[0]){if(b[0]instanceof y)return b[0].getTable()||b[0].setTable(a.getTableName()),b[0];c.and(b[0])}else if(d){var f=parseInt(b[0],10);isNaN(f)?c.and(d,b[0]):c.and(d,f)}}else{if(2!==e&&3!==e&&4!==e||"string"!=typeof b[0])throw new Error("Unknown arguments for find: ("+b.join(", ")+")");c.and.apply(c,b)}return c},find:function(){throw new Error("find not implemented for this adapter")},findAll:function(){throw new Error("findAll not implemented for this adapter")},countAll:function(){throw new Error("countAll not implemented for this adapter")},removeAll:function(){throw new Error("removeAll not implemented for this adapter")},insert:function(){throw new Error("insert not implemented for this adapter")},update:function(){throw new Error("update not implemented for this adapter")},remove:function(){throw new Error("remove not implemented for this adapter")}});dabl.Adapter=C}({},function(){return this}());