dabl=typeof dabl==="undefined"?{}:dabl;(function(y){var w=false,j=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;function J(l,x,D){var i;for(i in l){x[i]=typeof l[i]==="function"&&typeof D[i]==="function"&&j.test(l[i])?(function(N,O){return function(){var Q=this._super,P;this._super=D[N];P=O.apply(this,arguments);this._super=Q;return P}})(i,l[i]):l[i]}}var G=function(){};function b(i){try{Object.defineProperty(i,"sentinel",{value:"foo"});return"sentinel" in i}catch(l){return false}}G.canDefineProperties=b({});G.extend=function(D,N){if(typeof D==="undefined"){D={}}if(typeof N==="undefined"){N={}}var x,l;w=true;x=new this();w=false;function i(){if(!w&&this.init){this.init.apply(this,arguments)}}for(l in this){if(!(l in N)&&this.hasOwnProperty(l)){i[l]=this[l]}}J(D,x,this.prototype);J(N,i,this);i.prototype=x;i.prototype.constructor=i;return i};G.callAsync=G.prototype.callAsync=function I(D,P,x){var l=y.Deferred(),O=l.promise();try{var i=D.call(this);if(i&&typeof i.then==="function"){O=i}else{l.resolve(i)}}catch(N){l.reject(N)}if(typeof P==="function"||typeof x==="function"){O.then(P,x)}return O};y.Class=G;if(typeof jQuery!=="undefined"&&jQuery.Deferred){y.Deferred=jQuery.Deferred}else{function o(i){return Object.prototype.toString.call(i)==="[object Array]"}function u(l,D){if(o(l)){for(var x=0;x<l.length;x++){D(l[x])}}else{D(l)}}function t(O){var l="pending",P=[],N=[],D=[],i=null,R={done:function(){for(var U=0;U<arguments.length;U++){if(!arguments[U]){continue}if(o(arguments[U])){var S=arguments[U];for(var T=0;T<S.length;T++){if(l==="resolved"){S[T].apply(this,i)}P.push(S[T])}}else{if(l==="resolved"){arguments[U].apply(this,i)}P.push(arguments[U])}}return this},fail:function(){for(var U=0;U<arguments.length;U++){if(!arguments[U]){continue}if(o(arguments[U])){var S=arguments[U];for(var T=0;T<S.length;T++){if(l==="rejected"){S[T].apply(this,i)}N.push(S[T])}}else{if(l==="rejected"){arguments[U].apply(this,i)}N.push(arguments[U])}}return this},always:function(){return this.done.apply(this,arguments).fail.apply(this,arguments)},progress:function(){for(var U=0;U<arguments.length;U++){if(!arguments[U]){continue}if(o(arguments[U])){var S=arguments[U];for(var T=0;T<S.length;T++){if(l==="pending"){D.push(S[T])}}}else{if(l==="pending"){D.push(arguments[U])}}}return this},then:function(){if(arguments.length>1&&arguments[1]){this.fail(arguments[1])}if(arguments.length>0&&arguments[0]){this.done(arguments[0])}if(arguments.length>2&&arguments[2]){this.progress(arguments[2])}return this},promise:function(T){if(T==null){return R}else{for(var S in R){T[S]=R[S]}return T}},state:function(){return l},debug:function(){console.log("[debug]",P,N,l)},isRejected:function(){return l==="rejected"},isResolved:function(){return l==="resolved"},pipe:function(T,S,U){return t(function(V){u(T,function(W){if(typeof W==="function"){Q.done(function(){var X=W.apply(this,arguments);if(X&&typeof X==="function"){X.promise().then(V.resolve,V.reject,V.notify)}else{V.resolve(X)}})}else{Q.done(V.resolve)}});u(S,function(W){if(typeof W==="function"){Q.fail(function(){var X=W.apply(this,arguments);if(X&&typeof X==="function"){X.promise().then(V.resolve,V.reject,V.notify)}else{V.reject(X)}})}else{Q.fail(V.reject)}})}).promise()}},Q={resolveWith:function(U){if(l==="pending"){l="resolved";var S=i=(arguments.length>1)?arguments[1]:[];for(var T=0;T<P.length;T++){P[T].apply(U,S)}}return this},rejectWith:function(U){if(l==="pending"){l="rejected";var S=i=(arguments.length>1)?arguments[1]:[];for(var T=0;T<N.length;T++){N[T].apply(U,S)}}return this},notifyWith:function(U){if(l==="pending"){var S=i=(arguments.length>1)?arguments[1]:[];for(var T=0;T<D.length;T++){D[T].apply(U,S)}}return this},resolve:function(){return this.resolveWith(this,arguments)},reject:function(){return this.rejectWith(this,arguments)},notify:function(){return this.notifyWith(this,arguments)}};var x=R.promise(Q);if(O){O.apply(x,[x])}return x}t.when=function(){if(arguments.length<2){var i=arguments.length?arguments[0]:undefined;if(i&&(typeof i.isResolved==="function"&&typeof i.isRejected==="function")){return i.promise()}else{return t().resolve(i).promise()}}else{return(function(x){var P=t(),N=x.length,l=0,O=new Array(N);for(var D=0;D<x.length;D++){(function(Q){x[Q].done(function(){O[Q]=(arguments.length<2)?arguments[0]:arguments;if(++l===N){P.resolve.apply(P,O)}}).fail(function(){P.reject(arguments)})})(D)}return P.promise()})(arguments)}};y.Deferred=t}var m=G.extend({_oldValues:null,_isNew:true,_validationErrors:null,init:function m(i){this._validationErrors=[];var D={},l=this.constructor;for(var N in l._fields){var x=l._fields[N];if(typeof x.value!=="undefined"){D[N]=A(x.value)}else{if(x.type===Array){D[N]=[]}else{D[N]=null}}}this.fromJSON(D);this.resetModified();if(i){this.fromJSON(i)}},toString:function(){return this.constructor._table+":"+JSON.stringify(this.toJSON())},copy:function(){var i=this.constructor,l=new i(this),x=i.getKey();if(x){l[x]=null}return l},isModified:function(i){if(i){return !n(this[i],this._oldValues[i])}for(var i in this.constructor._fields){if(this.isModified(i)){return true}}return false},getModified:function(){var i={};for(var l in this.constructor._fields){if(this.isModified(l)){i[l]=true}}return i},resetModified:function(){this._oldValues=JSON.parse(JSON.stringify(this));return this},revert:function(){this.fromJSON(this._oldValues);this.resetModified();return this},fromJSON:function(i){var l=this.constructor;for(var x in l._fields){if(!(x in i)){continue}this[x]=i[x]}l.coerceValues(this);return this},toJSON:function(){var O={},S,Q,P=this.constructor,D=P._fields;if(this._inToJSON){return null}this._inToJSON=true;P.coerceValues(this);for(S in D){Q=this[S];if(Q instanceof Array){var R=[];for(var i=0,N=Q.length;i<N;++i){if(Q[i]!==null&&typeof Q[i].toJSON==="function"){R[i]=Q[i].toJSON()}else{R[i]=A(Q[i])}}Q=R}else{if(D[S].type===m.FIELD_TYPE_DATE){Q=s(Q)}else{if(Q!==null&&typeof Q.toJSON==="function"){Q=Q.toJSON()}else{Q=A(Q)}}}O[S]=Q}delete this._inToJSON;return O},hasKeyValues:function(){var N=this.constructor,D=N._keys;if(D.length===0){return false}N.coerceValues(this);for(var l=0,i=D.length;l<i;++l){var O=D[l];if(this[O]===null){return false}}return true},getKeyValues:function(){var N={},O=this.constructor,D=O._keys;O.coerceValues(this);for(var l=0,i=D.length;l<i;++l){var P=D[l];N[P]=this[P]}return N},isNew:function(){return this._isNew},setNew:function(i){this._isNew=(i===true);return this},validate:function(){this._validationErrors=[];var i=this.constructor;i.coerceValues(this);for(var D in i._fields){var x=i._fields[D];if(!x.required){continue}var l=this[D];if(!l||(l instanceof Array&&l.length===0)){this._validationErrors.push(D+" is required.")}}return this._validationErrors.length===0},getValidationErrors:function(){return this._validationErrors},save:function(l,i){if(this.isNew()){return this.insert(l,i)}else{return this.update(l,i)}},insert:function(l,i){return this.callAsync(function(){var x=this.constructor;if(!this.validate()){throw new Error("Cannot save "+x._table+" with validation errors:\n"+this.getValidationErrors().join("\n"))}if(this.isNew()&&x.hasField("created")&&!this.isModified("created")){this.created=new Date()}if((this.isNew()||this.isModified())&&x.hasField("updated")&&!this.isModified("updated")){this.updated=new Date()}return this.constructor._adapter.insert(this)},l,i)},update:function(i,x,l){if(typeof i==="function"){x=i;l=x}return this.callAsync(function(){var D=this.constructor;if(!this.validate()){throw new Error("Cannot save "+D._table+" with validation errors:\n"+this.getValidationErrors().join("\n"))}if(D._keys.length===0){throw new Error("Cannot update without primary keys")}if(this.isNew()&&D.hasField("created")&&!this.isModified("created")){this.created=new Date()}if((this.isNew()||this.isModified())&&D.hasField("updated")&&!this.isModified("updated")){this.updated=new Date()}if(typeof i==="object"){this.fromJSON(i)}return D._adapter.update(this)},x,l)},remove:function(l,i){return this.callAsync(function(){return this.constructor._adapter.remove(this)},l,i)}});m.models={};m._fields=m._keys=m._table=null;m._autoIncrement=false;m.FIELD_TYPE_TEXT="TEXT";m.FIELD_TYPE_NUMERIC="NUMERIC";m.FIELD_TYPE_INTEGER="INTEGER";m.FIELD_TYPE_DATE="DATE";m.FIELD_TYPE_TIME="TIME";m.FIELD_TYPE_TIMESTAMP="TIMESTAMP";m.FIELD_TYPES={TEXT:m.FIELD_TYPE_TEXT,NUMERIC:m.FIELD_TYPE_NUMERIC,INTEGER:m.FIELD_TYPE_INTEGER,DATE:m.FIELD_TYPE_DATE,TIME:m.FIELD_TYPE_TIME,TIMESTAMP:m.FIELD_TYPE_TIMESTAMP};m.TEXT_TYPES={TEXT:m.FIELD_TYPE_TEXT,DATE:m.FIELD_TYPE_DATE,TIME:m.FIELD_TYPE_TIME,TIMESTAMP:m.FIELD_TYPE_TIMESTAMP};m.INTEGER_TYPES={INTEGER:m.FIELD_TYPE_INTEGER};m.TEMPORAL_TYPES={DATE:m.FIELD_TYPE_DATE,TIME:m.FIELD_TYPE_TIME,TIMESTAMP:m.FIELD_TYPE_TIMESTAMP};m.NUMERIC_TYPES={INTEGER:m.FIELD_TYPE_INTEGER,NUMERIC:m.FIELD_TYPE_NUMERIC};m.isFieldType=function(i){return(i in m.FIELD_TYPES||this.isObjectType(i))};m.isTemporalType=function(i){return(i in this.TEMPORAL_TYPES)};m.isTextType=function(i){return(i in this.TEXT_TYPES)};m.isNumericType=function(i){return(i in this.NUMERIC_TYPES)};m.isIntegerType=function(i){return(i in this.INTEGER_TYPES)};m.isObjectType=function(i){return typeof i==="function"};m.coerceValue=function(Q,R){var N=R.type;if(typeof Q==="undefined"||Q===null){if(N===Array){Q=[]}else{return null}}var P=this.isTemporalType(N),O=this.isNumericType(N);if(O||P){if(""===Q){return null}}if(O){if(this.isIntegerType(N)){Q=parseInt(Q,10);if(isNaN(Q)){throw new Error(Q+" is not a valid integer")}}else{Q=parseFloat(Q,10);if(isNaN(Q)){throw new Error(Q+" is not a valid float")}}}else{if(P){if(!(Q instanceof Date)){Q=new Date(Q);if(isNaN(Q.getTime())){throw new Error(Q+" is not a valid date")}}}else{if(N===Array){if(R.elementType){this.convertArray(Q,R.elementType);for(var i=0,D=Q.length;i<D;++i){Q[i]=this.coerceValue(Q[i],{type:R.elementType})}}}else{if(N===this.FIELD_TYPE_TEXT){if(typeof Q!=="string"){Q=Q+""}}else{if(this.isObjectType(N)&&N.isModel&&Q.constructor!==N){Q=N.inflate(Q)}}}}}return Q};m.coerceValues=function(i){if(null===i||typeof i==="undefined"){return this}for(var l in this._fields){if(!(l in i)){continue}i[l]=this.coerceValue(i[l],this._fields[l])}return this};m.convertArray=function(R,N){if(R.modelCollection){return}R.modelCollection=true;var O=this;R.push=function(){return Array.prototype.push.apply(this,O.coerceValue(arguments,{type:Array,elementType:N}))};R.unshift=function(){return Array.prototype.unshift.apply(this,O.coerceValue(arguments,{type:Array,elementType:N}))};R.pop=function(){return O.coerceValue(Array.prototype.pop.apply(this,arguments),{type:N})};R.shift=function(){return O.coerceValue(Array.prototype.shift.apply(this,arguments),{type:N})};R.slice=function(){return O.coerceValue(Array.prototype.slice.apply(this,arguments),{type:Array,elementType:N})};R.concat=function(){return O.coerceValue(Array.prototype.concat.apply(this,arguments),{type:Array,elementType:N})};R.splice=function(){for(var S=2,T=arguments.length;S<T;++S){arguments[S]=O.coerceValue(arguments[S],{type:N})}return O.coerceValue(Array.prototype.splice.apply(this,arguments),{type:Array,elementType:N})};var Q=["forEach","every","some","filter","map"];for(var i=0,D=Q.length;i<D;++i){var P=Q[i];R[P]=(function(l){return function(S,x){return Array.prototype[l].call(this,function(){arguments[0]=O.coerceValue(arguments[0],{type:N});return S.apply(this,arguments)},x)}})(P)}};m.getAdapter=function(){return this._adapter};m.setAdapter=function(i){this._adapter=i;return this};m.inflate=function(x){var D=this.getKey(),l=this.getAdapter(),i;if(D&&x[D]){i=l.cache(this._table,x[D]);if(i){if(i.isModified()){return i}i.fromJSON(x)}}if(!i){i=new this(x)}i.resetModified().setNew(false);if(D&&i[D]){l.cache(this._table,i[D],i)}return i};m.inflateArray=function(N){var D,x,l;if(N.constructor!==Array){if(typeof l.length==="undefined"){throw new Error("Unknown array type for collection.")}l=[]}else{l=N}for(D=0,x=N.length;D<x;++D){l[D]=this.inflate(N[D])}this.convertArray(l,this);return l};m.getTableName=function(){return this._table};m.getFields=function(){return A(this._fields)};m.getField=function(i){return A(this._fields[i])};m.getFieldType=function(i){return this._fields[i].type};m.hasField=function(i){return i in this._fields};m.getKeys=function(){return this._keys.slice(0)};m.getKey=function(){return this._keys.length===1?this._keys[0]:null};m.isAutoIncrement=function(){return this._autoIncrement};m.addField=function(l,i){if(!i.type){i={type:i}}if(typeof i.type==="string"){i.type=i.type.toUpperCase()}switch(i.type){case"STRING":case String:i.type=this.FIELD_TYPE_TEXT;break;case Number:i.type=this.FIELD_TYPE_NUMERIC;break;case Date:i.type=this.FIELD_TYPE_TIMESTAMP;break;case"INT":i.type=this.FIELD_TYPE_INTEGER;break}if(i.key){this._keys.push(l)}if(i.computed){this._autoIncrement=true}if(!this.isFieldType(i.type)){throw new Error(i.type+" is not a valide field type")}if(i.type.isModel){this._relations.push(l)}this._fields[l]=i};m.extend=function(l,i){var x,N,D;if(typeof l==="undefined"){throw new Error("Must provide a table when exending Model")}if(!i.fields){throw new Error("Must provide fields when exending Model")}x=G.extend.call(this,i.prototype);delete i.prototype;if(!this._table&&!this._fields){x._keys=[];x._fields={};x._relations=[]}else{x._keys=A(this._keys);x._fields=A(this._fields);x._relations=A(this._relations)}x._table=l;for(D in i){switch(D){case"url":case"adapter":x["_"+D]=i[D];break;default:x[D]=i[D];break}}for(N in i.fields){x.addField(N,i.fields[N])}m.models[l]=x;return x};m.isModel=true;m.toString=function(){return this._table};var a=["countAll","findAll","find","removeAll","updateAll"];for(var E=0,B=a.length;E<B;++E){var c=a[E];m[c]=(function(i){return function(){var O=Array.prototype.slice.call(arguments),D=this.getAdapter(),P=null,N=null,l=O.length-1;while(l>-1&&!(O[l] instanceof m)&&typeof O[l]==="function"){if(!P){P=O.pop();--l;continue}N=P;P=O.pop();break}O.unshift(this);return this.callAsync(function(){return D[i].apply(D,O)},P,N)}})(c)}var h=["findBy","retrieveByField","retrieveByPK","retrieveByPKs","findByPKs"];for(var k=0,F=h.length;k<F;++k){m[h[k]]=m.find}y.Model=m;function g(i){i=i+"";return i.length===2?i:"0"+i}function A(D){if(D===null){return null}if(D instanceof m){return D.constructor(D)}if(D instanceof Array){return D.slice(0)}if(D instanceof Date){return new Date(D.getTime())}switch(typeof D){case"string":case"boolean":case"number":case"undefined":case"function":return D}var x={};for(var l in D){if(D.hasOwnProperty(l)){x[l]=D[l]}}return x}function n(l,i){if(l instanceof Date&&i instanceof Date){return l.getTime()===i.getTime()}if(typeof l==="object"){return JSON.stringify(l)===JSON.stringify(i)}return l===i}function s(i){if(!(i instanceof Date)){i=new Date(i)}return i.getUTCFullYear()+"-"+g(i.getUTCMonth()+1)+"-"+g(i.getUTCDate())}var K=G.extend({_conds:null,init:function K(D,l,x,i){this._conds=[];if(arguments.length!==0){this.and.apply(this,arguments)}},_preprocessCondition:function(N,x,D,l){switch(arguments.length){case 0:return null;case 1:if(N instanceof q.Statement||(N instanceof K&&N._conds.length!==0)){return[N]}else{return null}case 2:D=x;x=K.EQUAL;case 3:l=K.QUOTE_RIGHT}var O=D instanceof q,i=D instanceof Array;if(i||O){if(false===O||1!==D.getLimit()){switch(x){case K.BETWEEN:break;case K.IN:case K.EQUAL:case"eq":x=K.IN;break;case"ne":case K.NOT_IN:case K.NOT_EQUAL:case K.ALT_NOT_EQUAL:x=K.NOT_IN;break;default:throw new Error(x+" unknown for comparing an array.")}}if(i){if(0===D.length&&x===K.NOT_IN){return null}}if(O){if(!D.getTable()){throw new Error("right does not have a table, so it cannot be nested.")}if(l!==K.QUOTE_LEFT){l=K.QUOTE_NONE}}}else{if(null===D){if(x===K.NOT_EQUAL||x===K.ALT_NOT_EQUAL||x==="ne"){x=K.IS_NOT_NULL}else{if(x===K.EQUAL||x==="eq"){x=K.IS_NULL}}}if(x===K.IS_NULL||x===K.IS_NOT_NULL){D=null;if(l!==K.QUOTE_LEFT){l=K.QUOTE_NONE}}}return[N,x,D,l]},_processCondition:function(N,D,U,l){if(arguments.length===1){if(N instanceof q.Statement){return N}if(N instanceof K){V=N.getQueryStatement();V.setString("("+V._qString+")");return V}}var S=new q.Statement,V,T,R=U instanceof q,P=U instanceof Array,i;if(!(D in K.SQL.operators)){throw new Error('Unsupported SQL operator: "'+D+'"')}if(D==="substringof"){var O=N;N=U;U=O}D=K.SQL.operators[D];if(l===K.QUOTE_LEFT||l===K.QUOTE_BOTH){S.addParam(N);N="?"}if(D===K.CONTAINS){D=K.LIKE;U="%"+U+"%"}else{if(D===K.BEGINS_WITH){D=K.LIKE;U+="%"}else{if(D===K.ENDS_WITH){D=K.LIKE;U="%"+U}}}if(P||R){if(R){V=U.getQuery();U="("+V._qString+")";S.addParams(V._params)}else{if(P){i=U.length;if(2===i&&D===K.BETWEEN){S.setString(N+" "+D+" ? AND ?");S.addParams(U);return S}else{if(0===i){if(D===K.IN){S.setString("(0 = 1)");return S}}else{if(l===K.QUOTE_RIGHT||l===K.QUOTE_BOTH){S.addParams(U);var Q="(";for(T=0;T<i;++T){if(0<T){Q+=","}Q+="?"}U=Q+")"}}}}}}else{if(D!==K.IS_NULL&&D!==K.IS_NOT_NULL&&(l===K.QUOTE_RIGHT||l===K.QUOTE_BOTH)){S.addParam(U);U="?"}}S.setString(N+" "+D+(U===null?"":" "+U));return S},prepareInput:function(D){if(D instanceof Array){D=D.slice(0);for(var l=0,i=D.length;l<i;++l){D[l]=this.prepareInput(D[l])}return D}if(D===true||D===false){return D?1:0}if(D===null||typeof D==="undefined"){return"null"}if(parseInt(D,10)===D){return D}return this.quote(D)},quote:function(i){return"'"+i.replace("'","''")+"'"},_processODataCondition:function(P,N,U,l){if(arguments.length===1){if(P instanceof q.Statement){throw new Error("Unable to use Query.Statement within a Condition to build an OData query")}if(P instanceof K){return"("+P.getODataFilter()+")"}}if(U instanceof q){throw new Error("Unable to use Query within a Condition to build an OData query")}var T,Q=U instanceof Array,i;if(l===K.QUOTE_LEFT||l===K.QUOTE_BOTH){P=this.prepareInput(P)}switch(N){case"startswith":case"endswith":case"substringof":case K.LIKE:case K.CONTAINS:case K.BEGINS_WITH:case K.ENDS_WITH:if(U.indexOf("%")!==-1){throw new Error("Cannot use % in OData queries")}break}if(N===K.IS_NULL){N=K.EQUAL;U="null"}else{if(N===K.IS_NOT_NULL){N=K.NOT_EQUAL;U="null"}else{if(l===K.QUOTE_RIGHT||l===K.QUOTE_BOTH){U=this.prepareInput(U)}}}if(Q){i=U.length;if(2===i&&N===K.BETWEEN){return"("+P+" ge "+U[0]+" and "+P+" le "+U[1]+")"}else{if(0===i&&N===K.IN){return"(0 eq 1)"}else{var V;if(N===K.IN){N=" eq ";V=" or "}else{N=" ne ";V=" and "}var R="(";for(T=0;T<i;++T){R+=(0!==T?V:"")+P+N+U[T]}return R+")"}}}else{if(N in K.OData.operators){N=K.OData.operators[N];return P+" "+N+" "+U}else{if(N in K.OData.functions){var O=K.OData.functions[N];var D=O.indexOf("@");var S=O.indexOf("?");if(D>S){O=O.substring(0,D)+U+O.substr(D+1);O=O.substring(0,S)+P+O.substr(S+1)}else{O=O.substring(0,S)+P+O.substr(S+1);O=O.substring(0,D)+U+O.substr(D+1)}return O}}}throw new Error("Unexpected arguments: "+arguments.join(", "))},and:function(O,l,N,i){var D;if(O.constructor===Object){for(D in O){this.and(D,O[D])}return this}var x=this._preprocessCondition.apply(this,arguments);if(null===x){return this}x.type="AND";this._conds.push(x);return this},addAnd:function(D,l,x,i){return this.and.apply(this,arguments)},add:function(D,l,x,i){return this.and.apply(this,arguments)},filter:function(D,l,x,i){return this.and.apply(this,arguments)},where:function(D,l,x,i){return this.and.apply(this,arguments)},or:function(O,l,N,i){var D;if(O.constructor===Object){for(D in O){this.or(D,O[D])}return this}var x=this._preprocessCondition.apply(this,arguments);if(null===x){return this}x.type="OR";this._conds.push(x);return this},addOr:function(D,l,x,i){return this.or.apply(this,arguments)},orWhere:function(D,l,x,i){return this.or.apply(this,arguments)},andNot:function(i,l){return this.and(i,K.NOT_EQUAL,l)},andLike:function(i,l){return this.and(i,K.LIKE,l)},andNotLike:function(i,l){return this.and(i,K.NOT_LIKE,l)},andGreater:function(i,l){return this.and(i,K.GREATER_THAN,l)},andGreaterEqual:function(i,l){return this.and(i,K.GREATER_EQUAL,l)},andLess:function(i,l){return this.and(i,K.LESS_THAN,l)},andLessEqual:function(i,l){return this.and(i,K.LESS_EQUAL,l)},andNull:function(i){return this.and(i,null)},andNotNull:function(i){return this.and(i,K.NOT_EQUAL,null)},andBetween:function(i,x,l){return this.and(i,K.BETWEEN,[x,l])},andBeginsWith:function(i,l){return this.and(i,K.BEGINS_WITH,l)},andEndsWith:function(i,l){return this.and(i,K.ENDS_WITH,l)},andContains:function(i,l){return this.and(i,K.CONTAINS,l)},orNot:function(i,l){return this.or(i,K.NOT_EQUAL,l)},orLike:function(i,l){return this.or(i,K.LIKE,l)},orNotLike:function(i,l){return this.or(i,K.NOT_LIKE,l)},orGreater:function(i,l){return this.or(i,K.GREATER_THAN,l)},orGreaterEqual:function(i,l){return this.or(i,K.GREATER_EQUAL,l)},orLess:function(i,l){return this.or(i,K.LESS_THAN,l)},orLessEqual:function(i,l){return this.or(i,K.LESS_EQUAL,l)},orNull:function(i){return this.or(i,null)},orNotNull:function(i){return this.or(i,K.NOT_EQUAL,null)},orBetween:function(i,x,l){return this.or(i,K.BETWEEN,[x,l])},orBeginsWith:function(i,l){return this.or(i,K.BEGINS_WITH,l)},orEndsWith:function(i,l){return this.or(i,K.ENDS_WITH,l)},orContains:function(i,l){return this.or(i,K.CONTAINS,l)},getQueryStatement:function(Q){if(0===this._conds.length){return null}var P=new q.Statement(Q),D="",l,O,N=this._conds,i=N.length;for(l=0;l<i;++l){O=this._processCondition.apply(this,N[l]);if(null===O){continue}D+="\n\t";if(0!==l){D+=((1===l&&N[0].type==="OR")?"OR":N[l].type)+" "}D+=O._qString;P.addParams(O._params)}P.setString(D);return P},getODataFilter:function(){if(0===this._conds.length){return null}var O="",l,N,D=this._conds,i=D.length;for(l=0;l<i;++l){N=this._processODataCondition.apply(this,D[l]);if(null===N){continue}if(0!==l){O+=" "+((1===l&&D[0].type==="or")?"or":(D[l].type==="OR"?"or":"and"))+" "}O+=N}return O},toString:function(){return this.getQueryStatement().toString()},getSimpleJSON:function(){var O={};if(0===this._conds.length){return{}}var l,N,D=this._conds,i=D.length;for(l=0;l<i;++l){var N=D[l];if("AND"!==N.type){throw new Error("OR conditions not supported.")}if(N.length===2){O[N[0]]=N[1]}else{if(N[1]===K.EQUAL){O[N[0]]=N[2]}else{throw new Error('Cannot export complex condition: "'+this._processCondition.apply(this,N)+'"')}}}return O}});K.EQUAL="=";K.NOT_EQUAL="<>";K.ALT_NOT_EQUAL="!=";K.GREATER_THAN=">";K.LESS_THAN="<";K.GREATER_EQUAL=">=";K.LESS_EQUAL="<=";K.LIKE="LIKE";K.BEGINS_WITH="BEGINS_WITH";K.ENDS_WITH="ENDS_WITH";K.CONTAINS="CONTAINS";K.NOT_LIKE="NOT LIKE";K.IN="IN";K.NOT_IN="NOT IN";K.IS_NULL="IS NULL";K.IS_NOT_NULL="IS NOT NULL";K.BETWEEN="BETWEEN";K.BINARY_AND="&";K.BINARY_OR="|";K.SQL={operators:{eq:"=",ne:"<>",gt:">",lt:"<",ge:">=",le:"<=","=":"=","<>":"<>","!=":"<>",">":">","<":"<",">=":">=","<=":"<=","&":"&","|":"|",startswith:"BEGINS_WITH",BEGINS_WITH:"BEGINS_WITH",endswith:"ENDS_WITH",ENDS_WITH:"BEGINS_WITH",substringof:"CONTAINS",CONTAINS:"CONTAINS",LIKE:"LIKE","NOT LIKE":"NOT LIKE",IN:"IN","NOT IN":"NOT IN","IS NULL":"IS NULL","IS NOT NULL":"IS NOT NULL",BETWEEN:"BETWEEN"}};K.OData={operators:{eq:"eq",ne:"ne",gt:"gt",lt:"lt",ge:"ge",le:"le","=":"eq","<>":"ne","!=":"ne",">":"gt","<":"lt",">=":"ge","<=":"le","&":"&","|":"|"},functions:{startswith:"startswith(?, @)",endswith:"endswith(?, @)",substringof:"substringof(@, ?)",BEGINS_WITH:"startswith(?, @)",ENDS_WITH:"endswith(?, @)",CONTAINS:"substringof(@, ?)",LIKE:"tolower(@) eq tolower(?)","NOT LIKE":"tolower(@) ne tolower(?)",}};K.QUOTE_LEFT=1;K.QUOTE_RIGHT=2;K.QUOTE_BOTH=3;K.QUOTE_NONE=4;y.Condition=K;var q=K.extend({_action:"SELECT",_columns:null,_table:null,_tableAlias:null,_extraTables:null,_joins:null,_orders:null,_groups:null,_having:null,_limit:null,_offset:0,_distinct:false,init:function q(l,i){this._super();this._columns=[];this._joins=[];this._orders=[];this._groups=[];if(!l){return}if(l.constructor===Object){this.and(l)}else{if(l){this.setTable(l,i)}}},setDistinct:function(i){if(typeof i==="undefined"){i=true}this._distinct=i===true},setAction:function(i){switch(i){case"SELECT":case"DELETE":case"COUNT":break;default:throw new Error('"'+i+'" is not an allowed Query action.');break}this._action=i;return this},getAction:function(){return this._action},addColumn:function(i){this._columns.push(i);return this},setColumns:function(i){this._columns=i.slice(0);return this},select:function(i){return this.setColumns.apply(this,arguments)},getColumns:function(){return this._columns},setGroups:function(i){this._groups=i;return this},getGroups:function(){return this._groups},setTable:function(l,i){if(l instanceof q){if(!i){throw new Error("The nested query must have an alias.")}}if(i){this.setAlias(i)}this._table=l;return this},from:function(l,i){return this.setTable.apply(this,arguments)},getTable:function(){return this._table},setAlias:function(i){this._tableAlias=i;return this},getAlias:function(){return this._tableAlias},addTable:function(i,l){if(i instanceof q){if(!l){throw new Error("The nested query must have an alias.")}}else{if(typeof l==="undefined"){l=i}}if(l===this._tableAlias||l===this._table){throw new Error('The alias "'+l+'" is is already in use')}if(this._extraTables===null){this._extraTables={}}this._extraTables[l]=i;return this},addJoin:function(l,i,x){if(l instanceof q.Join){this._joins.push(l);return this}if(null===i){if(x===q.JOIN||x===q.INNER_JOIN){this.addTable(l);return this}i="1 = 1"}this._joins.push(new q.Join(l,i,x));return this},join:function(l,i,x){return this.addJoin(l,i,x)},innerJoin:function(l,i){return this.addJoin(l,i,q.INNER_JOIN)},leftJoin:function(l,i){return this.addJoin(l,i,q.LEFT_JOIN)},rightJoin:function(l,i){return this.addJoin(l,i,q.RIGHT_JOIN)},outerJoin:function(l,i){return this.addJoin(l,i,q.OUTER_JOIN)},getJoins:function(){return this._joins},setJoins:function(i){this._joins=i;return this},groupBy:function(i){this._groups.push(i);return this},setHaving:function(i){if(null!==i&&!(i instanceof K)){throw new Error("setHaving must be given an instance of Condition")}this._having=i;return this},getHaving:function(){return this._having},orderBy:function(l,i){this._orders.push(arguments);return this},limit:function(i,l){i=parseInt(i);if(isNaN(i)){throw new Error("Not a number")}this._limit=i;if(arguments.length>1){this.setOffset(l)}return this},top:function(i,l){return this.limit.apply(this,arguments)},getLimit:function(){return this._limit},offset:function(i){i=parseInt(i);if(isNaN(i)){throw new Error("Not a number.")}this._offset=i;return this},skip:function(i){return this.offset.apply(this,arguments)},setPage:function(i){i=parseInt(i);if(isNaN(i)){throw new Error("Not a number.")}if(i<2){this._offset=null;return this}if(!this._limit){throw new Error("Cannot set page without first setting limit.")}this._offset=i*this._limit-this._limit;return this},hasAggregates:function(){if(this._groups.length!==0){return true}for(var l=0,i=this._columns.length;l<i;++l){if(this._columns[l].indexOf("(")!==-1){return true}}return false},needsComplexCount:function(){return this.hasAggregates()||null!==this._having||this._distinct},getQuery:function(V){if(typeof V==="undefined"){V=new r}var T=new q.Statement(V),l,R,N,W,Q,i,S,U,P;l="";switch(this._action){default:case q.ACTION_COUNT:case q.ACTION_SELECT:R=this.getColumnsClause(V);T.addParams(R._params);l+="SELECT "+R._qString;break;case q.ACTION_DELETE:l+="DELETE";break}N=this.getTablesClause(V);T.addParams(N._params);l+="\nFROM "+N._qString;if(this._joins.length!==0){for(W=0,Q=this._joins.length;W<Q;++W){i=this._joins[W],S=i.getQueryStatement(V);l+="\n\t"+S._qString;T.addParams(S._params)}}U=this.getWhereClause();if(null!==U){l+="\nWHERE "+U._qString;T.addParams(U._params)}if(this._groups.length!==0){l+="\nGROUP BY "+this._groups.join(", ")}if(null!==this.getHaving()){P=this.getHaving().getQueryStatement();if(P){l+="\nHAVING "+P._qString;T.addParams(P._params)}}if(this._action!==q.ACTION_COUNT&&this._orders.length!==0){l+="\nORDER BY ";for(W=0,Q=this._orders.length;W<Q;++W){var O=this._orders[W][0];var D=this._orders[W][1];if(null!==D&&typeof D!=="undefined"){O=O+" "+D}if(0!==W){l+=", "}l+=O}}if(null!==this._limit){if(V){l=V.applyLimit(l,this._offset,this._limit)}else{l+="\nLIMIT "+(this._offset?this._offset+", ":"")+this._limit}}if(this._action===q.ACTION_COUNT&&this.needsComplexCount()){l="SELECT count(0)\nFROM ("+l+") a"}T.setString(l);return T},getTablesClause:function(P){var S=this._table,N,D,x,Q,i,R,O,l;if(!S){throw new Error("No table specified.")}N=new q.Statement(P);D=this._tableAlias;if(S instanceof q){x=S.getQuery(P),i="("+x._qString+")"}else{x=null;i=S}switch(this._action){case q.ACTION_COUNT:case q.ACTION_SELECT:if(null!==x){N.addParams(x._params)}if(D){i=i+" AS "+D}if(this._extraTables!==null){for(Q in this._extraTables){R=this._extraTables[Q];if(R instanceof q){O=R.getQuery(P),l="("+O._qString+") AS "+Q;N.addParams(O._params)}else{l=R;if(Q!==R){l=l+" AS "+Q}}i=i+", "+l}}N.setString(i);break;case q.ACTION_DELETE:if(null!==x){N.addParams(x._params)}if(D){i=i+" AS "+D}N.setString(i);break;default:break}return N},getColumnsClause:function(Q){var T=this._table,i,P=new q.Statement(Q),N=this._tableAlias,l=this._action,R,O,S,D;if(l===q.ACTION_DELETE){return P}if(!T){throw new Error("No table specified.")}if(l===q.ACTION_COUNT){if(!this.needsComplexCount()){P.setString("count(0)");return P}if(this._groups.length!==0){P.setString(this._groups.join(", "));return P}if(!this._distinct&&null===this.getHaving()&&this._columns.length!==0){S=[];for(R=0,O=this._columns.length;R<O;++R){i=this._columns[R];if(i.indexOf("(")===-1){continue}S.push(i)}if(S.length!==0){P.setString(S.join(", "));return P}}}if(this._columns.length!==0){D=this._columns.join(", ")}else{if(N){D=N+".*"}else{D=T+".*"}}if(this._distinct){D="DISTINCT "+D}P.setString(D);return P},getWhereClause:function(i){return this.getQueryStatement(i)},toString:function(){if(!this._table){this.setTable("{UNSPECIFIED-TABLE}")}return this.getQuery().toString()},getCountQuery:function(i){if(!this._table){throw new Error("No table specified.")}this.setAction(q.ACTION_COUNT);return this.getQuery(i)},getDeleteQuery:function(i){if(!this._table){throw new Error("No table specified.")}this.setAction(q.ACTION_DELETE);return this.getQuery(i)},getSelectQuery:function(i){if(!this._table){throw new Error("No table specified.")}this.setAction(q.ACTION_SELECT);return this.getQuery(i)},getODataQuery:function(){if(this._joins&&this._joins.length!==0){throw new Error("JOINS cannot be exported.")}if(this._extraTables&&this._extraTables.length!==0){throw new Error("Extra tables cannot be exported.")}if(this._having&&this._having.length!==0){throw new Error("Having cannot be exported.")}if(this._groups&&this._groups.length!==0){throw new Error("Grouping cannot be exported.")}var l={};if(this._columns.length!==0){l.$select=this._columns.join(",")}var i=this.getODataFilter();if(i){l.$filter=i}if(this._limit){l.$top=this._limit;if(this._offset){l.$skip=this._offset}}if(this._orders&&this._orders.length!==0){l.$orderby=this._orders[0][0];if(this._orders[0][1]===q.DESC){l.$orderby+=" desc"}}return l},getSimpleJSON:function(){if(this._joins&&this._joins.length!==0){throw new Error("JOINS cannot be exported.")}if(this._extraTables&&this._extraTables.length!==0){throw new Error("Extra tables cannot be exported.")}if(this._having&&this._having.length!==0){throw new Error("Having cannot be exported.")}if(this._groups&&this._groups.length!==0){throw new Error("Grouping cannot be exported.")}var i=this._super();if(this._limit){i.limit=this._limit;if(this._offset){i.offset=this._offset;i.page=Math.floor(this._offset/this._limit)+1}}if(this._orders&&this._orders.length!==0){i.order_by=this._orders[0][0];if(this._orders[0][1]===q.DESC){i.dir=q.DESC}}return i}});q.ACTION_COUNT="COUNT";q.ACTION_DELETE="DELETE";q.ACTION_SELECT="SELECT";q.JOIN="JOIN";q.LEFT_JOIN="LEFT JOIN";q.RIGHT_JOIN="RIGHT JOIN";q.INNER_JOIN="INNER JOIN";q.OUTER_JOIN="OUTER JOIN";q.ASC="ASC";q.DESC="DESC";y.Query=q;var z=/^\w+\.\w+$/;var H=function H(l,i,x){if(arguments.length<3){x=q.JOIN}if(!(l instanceof q)&&!(i instanceof K)&&z.test(i)&&z.test(l)){this._isLikePropel=true;this._leftColumn=l;this._rightColumn=i;this._table=i.substring(0,i.indexOf("."));this._joinType=x;return}this.setTable(l).setOnClause(i).setJoinType(x)};H.prototype={_table:null,_alias:null,_onClause:null,_isLikePropel:false,_leftColumn:null,_rightColumn:null,_joinType:q.JOIN,toString:function(){if(!this.getTable()){this.setTable("{UNSPECIFIED-TABLE}")}return this.getQueryStatement().toString()},setTable:function(l){var x=l.lastIndexOf(" "),i=x===-1?-1:l.toUpperCase().lastIndexOf(" AS ");if(i!==x-3){i=-1}if(x!==-1){this.setAlias(l.substr(x+1));l=l.substring(0,i===-1?x:i)}this._table=l;return this},setAlias:function(i){this._alias=i;return this},setOnClause:function(i){this._isLikePropel=false;this._onClause=i;return this},setJoinType:function(i){this._joinType=i;return this},getQueryStatement:function(O){var N,D=this._table,l=this._onClause,P=this._joinType,x=this._alias,i;if(D instanceof q){N=D.getQuery(O);D="("+N._qString+")";N.setString("")}else{N=new q.Statement(O)}if(x){D+=" AS "+x}if(this._isLikePropel){l=this._leftColumn+" = "+this._rightColumn}else{if(null===l){l="1 = 1"}else{if(l instanceof K){i=l.getQueryStatement();l=i._qString;N.addParams(i.getParams())}}}if(""!==l){l="ON ("+l+")"}N.setString(P+" "+D+" "+l);return N},getTable:function(){return this._table},getAlias:function(){return this._alias},getOnClause:function(){if(this._isLikePropel){return this._leftColumn+" = "+this._rightColumn}return this._onClause},getJoinType:function(){return this._joinType}};y.Query.Join=H;var C=function C(i){this._params=[];if(i){this._conn=i}};C.embedParams=function(O,R,P){if(P){R=P.prepareInput(R)}var Q="?";if(O.split(Q).length-1!==R.length){throw new Error("The number of occurances of "+Q+" do not match the number of _params.")}if(R.length===0){return O}var l=O.length,D=Q.length,i,N;for(i=R.length-1;i>=0;--i){N=R[i];l=O.lastIndexOf(Q,l);if(l===-1){throw new Error("The number of occurances of "+Q+" do not match the number of _params.")}O=O.substring(0,l)+N+O.substr(l+D)}return O};C.prototype={_qString:"",_params:null,_conn:null,setConnection:function(i){this._conn=i},getConnection:function(){return this._conn},setString:function(i){this._qString=i},getString:function(){return this._qString},addParams:function(i){this._params=this._params.concat(i)},setParams:function(i){this._params=i.slice(0)},addParam:function(i){this._params.push(i)},getParams:function(){return this._params.slice(0)},toString:function(){return q.Statement.embedParams(this._qString,this._params.slice(0),this._conn)}};y.Query.Statement=C;var d=G.extend({_cache:null,init:function d(){this._cache={}},cache:function(l,i,x){if(!this._cache[l]){this._cache[l]={}}if(arguments.length<3){if(!this._cache[l][i]){return null}return this._cache[l][i]}this._cache[l][i]=x;return this},emptyCache:function(i){delete this._cache[i]},formatDate:function(l,i){if(i&&i===m.FIELD_TYPE_TIMESTAMP){return this.formatDateTime(l)}if(!(l instanceof Date)){l=new Date(l)}return l.getUTCFullYear()+"-"+g(l.getUTCMonth()+1)+"-"+g(l.getUTCDate())},formatDateTime:function(i){if(!(i instanceof Date)){i=new Date(i)}return i.getFullYear()+"-"+g(i.getMonth()+1)+"-"+g(i.getDate())+" "+g(i.getHours())+":"+g(i.getMinutes())+":"+g(i.getSeconds())},findQuery:function(x){var l=Array.prototype.slice.call(arguments),N=new q().setTable(x.getTableName()),D=x.getKey();l.shift();var i=l.length;if(i===0){return N}if(i===1){if(typeof l[0]==="object"){if(l[0] instanceof q){if(!l[0].getTable()){l[0].setTable(x.getTableName())}return l[0]}else{N.and(l[0])}}else{if(D){var O=parseInt(l[0],10);if(isNaN(O)){N.and(D,l[0])}else{N.and(D,O)}}}}else{if((i===2||i===3||i===4)&&typeof l[0]==="string"){N.and.apply(N,l)}else{throw new Error("Unknown arguments for find: ("+l.join(", ")+")")}}return N},find:function(i){throw new Error("find not implemented for this adapter")},findAll:function(i){throw new Error("findAll not implemented for this adapter")},countAll:function(i,l){throw new Error("countAll not implemented for this adapter")},removeAll:function(i,l){throw new Error("removeAll not implemented for this adapter")},insert:function(i){throw new Error("insert not implemented for this adapter")},update:function(i){throw new Error("update not implemented for this adapter")},remove:function(i){throw new Error("remove not implemented for this adapter")}});y.Adapter=d;function M(i){return p(i,true).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function p(l,i){return encodeURIComponent(l).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace((i?null:/%20/g),"+")}function e(O,Q){this.template=O;this.defaults=Q||{};var D=this.urlParams={},P=O.split(/\W/);for(var N=0,x=P.length;N<x;++N){var R=P[N];if(R&&O.match(new RegExp("[^\\\\]:"+R+"(\\W|$)"))){D[R]=true}}this.template=O.replace(/\\:/g,":")}e.prototype={url:function(O){var x=this,D=this.template,N,l;O=O||{};for(var i in this.urlParams){N=typeof O[i]!=="undefined"||O.hasOwnProperty(i)?O[i]:x.defaults[i];if(typeof N!=="undefined"&&N!==null){l=M(N);D=D.replace(new RegExp(":"+i+"(\\W)","g"),l+"$1")}else{D=D.replace(new RegExp("(/?):"+i+"(\\W)","g"),function(Q,R,P){if(P.charAt(0)==="/"){return P}else{return R+P}})}}return D},urlGet:function(D){var i=this.url(D);D=D||{};i=i.replace(/\/?#$/,"");var x=[];for(var l in D){if(!this.urlParams[l]){x.push(p(l)+"="+p(D[l]))}}x.sort();i=i.replace(/\/*$/,"");return i+(x.length?"?"+x.join("&"):"")}};var f=d.extend({_routes:{},_urlBase:"",init:function v(i){this._super();if(i){this._urlBase=i}},_getRoute:function(i){if(!i){throw new Error("Cannot create RESTful route for empty url.")}if(this._routes[i]){return this._routes[i]}return this._routes[i]=new e(this._urlBase+i)},_getErrorCallback:function(i){return function(x,P,O){var D;try{if(x.responseText){D=JSON.parse(x.responseText)}else{D=null}}catch(N){D=null}var l=O||"Request failed.";if(D){if(D.error){l=D.error}else{if(D.errors){l=D.errors.join("\n")}}}i.reject(l,D,x)}},_isValidResponseObject:function(x,i){var l=i.getKey();if(typeof x!=="object"||x.error||(x.errors&&x.errors.length!==0)||(l&&typeof x[l]==="undefined")){return false}return true},_save:function(S,i){var T,N=S.constructor,Q,R=this._getRoute(N._url),D={},x=N.getKey(),U=this,l=y.Deferred(),O=this._getErrorCallback(l);for(T in N._fields){var P=N._fields[T];Q=S[T];if(N.isTemporalType(P.type)){Q=this.formatDate(Q,P.type)}D[T]=Q}jQuery.ajax({url:R.url(D),type:"POST",data:JSON.stringify(D),contentType:"application/json;charset=utf-8",dataType:"json",headers:{"X-HTTP-Method-Override":i},success:function(W,X,V){if(!U._isValidResponseObject(W,N)){O(V,X,"Invalid response.");return}S.fromJSON(W).resetModified().setNew(false);if(x&&typeof S[x]!=="undefined"){U.cache(N._table,S[x],S)}l.resolve(S)},error:O});return l.promise()},formatDateTime:function(i){if(!(i instanceof Date)){i=new Date(i)}var l=-i.getTimezoneOffset()/60;l=(l>0?"+":"-")+g(Math.abs(l));return i.getFullYear()+"-"+g(i.getMonth()+1)+"-"+g(i.getDate())+" "+g(i.getHours())+":"+g(i.getMinutes())+":"+g(i.getSeconds())+" "+l+"00"},insert:function(i){return this._save(i,"POST")},update:function(i){if(!i.isModified()){var l=y.Deferred();l.resolve(i);return l.promise()}return this._save(i,"PUT")},remove:function(i){var N=i.constructor,x=this._getRoute(N._url),O=N.getKey(),l=this,P=y.Deferred(),D=this._getErrorCallback(P);jQuery.ajax({url:x.url(i.toJSON()),type:"POST",data:{},contentType:"application/json;charset=utf-8",dataType:"json",headers:{"X-HTTP-Method-Override":"DELETE"},success:function(R,S,Q){if(R&&(R.error||(R.errors&&R.errors.length))){D(Q,S,"Invalid response.");return}if(O&&i[O]){l.cache(N._table,i[O],null)}P.resolve(i)},error:D});return P.promise()},find:function(O,l){var Q=this._getRoute(O._url),N={},R=null,i,x=y.Deferred(),P=this._getErrorCallback(x),S=this,D=O.getKey();if(D&&arguments.length===2&&(typeof l==="number"||typeof l==="string")){R=this.cache(O._table,l);if(R){x.resolve(R);return x.promise()}N={};N[D]=l}else{i=this.findQuery.apply(this,arguments);i.limit(1);N=i.getSimpleJSON()}jQuery.get(Q.urlGet(N),function(U,V,T){if(!S._isValidResponseObject(U,O)){P(T,V,"Invalid response.");return}if(U instanceof Array){U=U.shift()}x.resolve(O.inflate(U))}).fail(P);return x.promise()},findAll:function(x){var O=this.findQuery.apply(this,arguments),i=this._getRoute(x._url),N=O.getSimpleJSON(),D=y.Deferred(),l=this._getErrorCallback(D);jQuery.get(i.urlGet(N),function(Q,R,P){if(typeof Q!=="object"||Q.error||(Q.errors&&Q.errors.length)){l(P,R,"Invalid response.");return}if(!(Q instanceof Array)){Q=[Q]}D.resolve(x.inflateArray(Q))}).fail(l);return D.promise()}});y.RESTAdapter=f;var L=f.extend({$http:null,init:function(i,l){this._super(i);this.$http=l},_getErrorCallback:function(i){return function(N,l,O,D){var x="Request failed.";if(N){if(N.error){x=N.error}else{if(N.errors){x=N.errors.join("\n")}}}i.reject(x,N,D)}},_save:function(S,i){var T,N=S.constructor,Q,R=this._getRoute(N._url),D={},x=N.getKey(),U=this,l=y.Deferred(),O=this._getErrorCallback(l);for(T in N._fields){var P=N._fields[T];Q=S[T];if(N.isTemporalType(P.type)){Q=this.formatDate(Q,P.type)}D[T]=Q}this.$http({url:R.url(D),method:"POST",data:D,headers:{"X-HTTP-Method-Override":i}}).success(function(X,V,Y,W){if(!U._isValidResponseObject(X,N)){O.apply(this,arguments);return}S.fromJSON(X).resetModified().setNew(false);if(x&&typeof S[x]!=="undefined"){U.cache(N._table,S[x],S)}l.resolve(S)}).error(O);return l.promise()},remove:function(i){var N=i.constructor,x=this._getRoute(N._url),O=N.getKey(),l=this,P=y.Deferred(),D=this._getErrorCallback(P);this.$http({url:x.url(i.toJSON()),method:"POST",data:{},headers:{"X-HTTP-Method-Override":"DELETE"}}).success(function(S,Q,T,R){if(S&&(S.error||(S.errors&&S.errors.length))){D.apply(this,arguments);return}if(O&&i[O]){l.cache(N._table,i[O],null)}P.resolve(i)}).error(D);return P.promise()},find:function(O,l){var Q=this._getRoute(O._url),N={},R=null,i,x=y.Deferred(),P=this._getErrorCallback(x),S=this,D=O.getKey();if(D&&arguments.length===2&&(typeof l==="number"||typeof l==="string")){R=this.cache(O._table,l);if(R){x.resolve(R);return x.promise()}N={};N[D]=l}else{i=this.findQuery.apply(this,arguments);i.limit(1);N=i.getSimpleJSON()}this.$http.get(Q.urlGet(N)).success(function(V,T,W,U){if(!S._isValidResponseObject(V,O)){P.apply(this,arguments);return}if(V instanceof Array){V=V.shift()}x.resolve(O.inflate(V))}).error(P);return x.promise()},findAll:function(x){var O=this.findQuery.apply(this,arguments),i=this._getRoute(x._url),N=O.getSimpleJSON(),D=y.Deferred(),l=this._getErrorCallback(D);this.$http.get(i.urlGet(N)).success(function(R,P,S,Q){if(typeof R!=="object"||R.error||(R.errors&&R.errors.length)){l.apply(this,arguments);return}if(!(R instanceof Array)){R=[R]}D.resolve(x.inflateArray(R))}).error(l);return D.promise()}});y.AngularRESTAdapter=L;var r=d.extend({_db:null,init:function r(i){this._db=i;this._super()},execute:function(Q,l){if(Q instanceof q){Q=Q.getQuery(this)}if(Q instanceof q.Statement){Q.setConnection(this);return this.execute(Q.getString(),Q.getParams())}var x,S=[],R,N,D,O,P;if(l&&(D=l.length)!==0){for(N=0;N<D;++N){P=l[N];if(P instanceof Date){if(P.getSeconds()===0&&P.getMinutes()===0&&P.getHours()===0){l[N]=this.formatDate(P)}else{l[N]=this.formatDateTime(P)}}}x=this._db.execute(Q,l)}else{x=this._db.execute(Q)}S.rowsAffected=parseInt(this._db.rowsAffected)||0;if(null===x){return S}while(x.isValidRow()){R={};for(N=0,D=x.getFieldCount();N<D;++N){O=x.getFieldName(N);R[O]=x.field(N)}S.push(R);x.next()}x.close();return S},count:function(x,l){x="SELECT COUNT(0) AS rCount FROM ("+x+") AS a";var i=this.execute(x,l);return parseInt(i[0].rCount,10)||0},transaction:function(i){i.apply(this)},lastInsertId:function(){return this._db.lastInsertRowId},quoteIdentifier:function(i){return i},applyLimit:function(x,l,i){if(i>0){x=x+"\nLIMIT "+i+(l>0?" OFFSET "+l:"")}else{if(l>0){x=x+"\nLIMIT -1 OFFSET "+l}}return x},prepareInput:function(D){if(D instanceof Array){D=D.slice(0);for(var l=0,i=D.length;l<i;++l){D[l]=this.prepareInput(D[l])}return D}if(D===true||D===false){return D?1:0}if(D===null||typeof D==="undefined"){return"NULL"}if(parseInt(D,10)===D){return D}if(D instanceof Date){if(D.getSeconds()===0&&D.getMinutes()===0&&D.getHours()===0){D=this.formatDate(D)}else{D=this.formatDateTime(D)}}return this.quote(D)},quote:function(i){return"'"+i.replace("'","''")+"'"},find:function(i){var l=this.findQuery.apply(this,arguments).setLimit(1);return this.select(i,l).shift()||null},findAll:function(i){return this.select(i,this.findQuery.apply(this,arguments))},selectRS:function(i,l){l=l||new q;if(!l.getTable()||i.getTableName()!==l.getTable()){l.setTable(i.getTableName())}return this.execute(l.getSelectQuery(this))},fromResult:function(l,i){return l.inflatArray(i)},countAll:function(l,x){x=x instanceof q?x:new q(x);if(!x.getTable()||l.getTableName()!==x.getTable()){x.setTable(l.getTableName())}var i=this.execute(x.getCountQuery(this));return parseInt(i[0],10)||0},removeAll:function(i,l){if(!l.getTable()||i.getTableName()!==l.getTable()){l.setTable(i.getTableName())}this.emptyCache(i._table);return this.execute(l.getDeleteQuery(this)).rowsAffected},select:function(i,l){l=l instanceof q?l:new q(l);return this.fromResult(i,this.selectRS(i,l))},updateAll:function(N,D,l){var T=this.quoteIdentifier(N.getTableName()),O=[],S=[],Q=new q.Statement(this),R,i,P=l.getWhereClause(this);for(R in D){O.push(this.quoteIdentifier(R)+" = ?");S.push(D[R])}if(O.length===0){return 0}i="UPDATE "+T+" SET "+O.join(", ")+" WHERE "+P.getString();Q.setString(i);Q.setParams(S);Q.addParams(P.getParams());var U=this.execute(Q);this.emptyCache(N._table);return U.rowsAffected||0},insert:function(T){var D=T.constructor,x=D.getKey(),N=[],S=[],P=[],O=new q.Statement(this),i,U,R,V,l;for(U in D._fields){var Q=D._fields[U];R=T[U];if(D.isTemporalType(Q.type)){R=this.formatDate(R,Q.type)}if(R===null){if(!T.isModified(U)){continue}}N.push(U);S.push(R);P.push("?")}i="INSERT INTO "+D.getTableName()+" ("+N.join(",")+") VALUES ("+P.join(",")+") ";O.setString(i);O.setParams(S);V=this.execute(O);if(x&&D.isAutoIncrement()){l=this.lastInsertId();if(null!==l){T[x]=l}}T.resetModified();T.setNew(false);if(x&&T[x]){this.cache(D._table,T[x],T)}return V.rowsAffected},update:function(W){var O={},l=new q,P=W.constructor,D=P.getKeys(),i=W.getModified(),U,R,X,N,S,V;if(!W.isModified()){return 0}if(D.length===0){throw new Error("This table has no primary keys")}for(X in i){var T=P._fields[X];V=W[X];if(P.isTemporalType(T.type)){V=this.formatDate(V,T.type)}O[X]=V}for(U=0,R=D.length;U<R;++U){N=D[U];S=W[N];if(S===null){throw new Error("Cannot remove using NULL primary key.")}l.and(N,S)}var Q=this.updateAll(P,O,l);W.resetModified();return Q},remove:function(D){var O=D.constructor,N=O.getKeys(),R=new q,l,i,Q,P;if(N.length===0){throw new Error("This table has no primary keys")}for(l=0,i=N.length;l<i;++l){Q=N[l];P=D[Q];if(P===null){throw new Error("Cannot remove using NULL primary key.")}R.and(Q,P)}return this.removeAll(O,R)}});r.Migration=G.extend({adapter:null,schema:null,init:function(i){this.adapter=i;this.schema=m.extend("schema_definitions",{adapter:i,fields:{id:{type:m.FIELD_TYPE_INTEGER,computed:true,key:true},table_name:m.FIELD_TYPE_TEXT,column_names:m.FIELD_TYPE_INTEGER,column_types:m.FIELD_TYPE_INTEGER}})},migrate:function(N){if(!N){N={}}var D,P={},x,l,O;if(N.refresh){for(D in m.models){this.adapter.execute("DROP TABLE IF EXISTS "+D)}this.setupSchema(true)}else{this.setupSchema()}if(this.adapter.migrations){P=this.adapter.migrations}if(P[1]&&P[1].constructor===Object){x=this.currentSchemaVersion();l=Infinity;if(N.number!==null&&typeof N.number!=="undefined"){l=N.number}else{if(typeof N==="number"){l=N}}O=x;do{if(O===l){return}else{if(O<l){O+=1;if(P[O]!==null&&typeof P[O]!=="undefined"){P[O].up()}else{break}}else{P[O].down();O-=1}}this.updateSchemaVersion(O)}while(P[O])}else{}if(N&&N.refresh){this.loadFixtures()}},setupSchema:function(i){var l;this.createTable("schema_migrations",{version:m.FIELD_TYPE_TEXT});if(this.adapter.count("SELECT * FROM schema_migrations")===0){l="INSERT INTO schema_migrations (version) VALUES(0)";this.adapter.execute(l)}if(i&&this.adapter.count("SELECT * FROM schema_migrations")===1){l="UPDATE schema_migrations set version = 0";this.adapter.execute(l)}this.createTable("schema_definitions",{id:m.FIELD_TYPE_INTEGER,table_name:m.FIELD_TYPE_TEXT,column_names:m.FIELD_TYPE_INTEGER,column_types:m.FIELD_TYPE_INTEGER})},writeSchema:function(x,Q){if(x==="schema_definitions"||x==="schema_migrations"){return}var O=[],l=[],P,D,N;for(var i in Q){O.push(i);l.push(Q[i])}P=O.join();D=O.join();N=this.schema.findBy("table_name",x);if(N){N.column_names=P;N.column_types=D;N.save()}else{N=new this.schema;N.fromJSON({table_name:x,column_names:P,column_types:D});N.save()}},readSchema:function(D){if(D==="schema_definitions"||D==="schema_migrations"){return null}var P=this.schema.findBy("table_name",D),x=P.column_names.split(","),R=P.column_types.split(","),Q={},N;for(var O=0,l=x.length;O<l;++O){N=x[O];Q[N]=R[O]}return Q},currentSchemaVersion:function(){var i="SELECT version FROM schema_migrations LIMIT 1";return parseInt(this.adapter.execute(i)[0].version,10)},updateSchemaVersion:function(i){var l="UPDATE schema_migrations SET version = "+i;return this.adapter.execute(l)},modifyColumn:function(l,i,x){if(!x){throw new Error("MIGRATION_EXCEPTION: Not a valid column modification")}var P=this.readSchema(l),N={},D,O;for(D in P){O=P[D];switch(x.modification){case"remove":if(D!==i){N[D]=O}break;case"rename":if(D!==i){N[D]=O}else{N[x.newName]=O}break;case"change":if(D!==i){N[D]=O}else{N[D]=x.newType}break;default:throw ("MIGRATION_EXCEPTION: Not a valid column modification")}}this.adapter.transaction(function(){var S=this.adapter.execute("SELECT * FROM "+l);if(S.length!==0){throw new Error("Modify column not quite ready yet...")}this.dropTable(l);this.createTable(l,N);for(var T=0,Q=S.length;T<Q;++T){var R=S[T];switch(x.modification){case"remove":delete R[i];m.insert(l,R);break;case"rename":R[x.newName]=R[i];delete R[i];m.insert(l,R);break;case"change":m.insert(l,R);break;default:throw ("MIGRATION_EXCEPTION: Not a valid column modification")}}})},createTable:function(l,D){if(!l||!D){return}var P="CREATE TABLE IF NOT EXISTS "+l+"\n",N,O,x=0;P+="(";for(N in D){O=D[N];if(0!==x){P+=",\n"}P+=(N+" "+O);if(O===m.FIELD_TYPE_INTEGER&&N==="id"){P+=" PRIMARY KEY AUTOINCREMENT"}++x}P+=")";this.adapter.execute(P);this.writeSchema(l,D)},dropTable:function(i){var x="DROP TABLE IF EXISTS "+i,l;this.adapter.execute(x);l=this.schema.findBy("table_name",i);l.remove()},renameTable:function(l,i){var D="ALTER TABLE "+l+" RENAME TO "+i,x;this.adapter.execute(D);x=this.schema.findBy("table_name",l);x.table_name=i;x.save()},addColumn:function(x,l,i){var N="ALTER TABLE "+x+" ADD COLUMN "+l+" "+i,D;this.adapter.execute(N);D=this.readSchema(x);D[l]=i;this.writeSchema(x,D)},removeColumn:function(l,i){return this.modifyColumn(l,i,{modification:"remove"})},renameColumn:function(l,i,D){var x={modification:"rename",newName:D};return this.modifyColumn(l,i,x)},changeColumn:function(l,i,D){var x={modification:"change",newType:D};return this.modifyColumn(l,i,x)},addIndex:function(l,i,D){var x="CREATE"+(D?" UNIQUE ":" ")+"INDEX IF NOT EXISTS "+l+"_"+i+"_index ON "+l+" ("+i+")";return this.adapter.execute(x)},removeIndex:function(l,i){var x="DROP INDEX IF EXISTS "+l+"_"+i+"_index";return this.adapter.execute(x)},loadFixtures:function(){}});r.TiDebugDB=G.extend({lastInsertRowId:null,rowsAffected:null,lastSQL:null,lastParams:null,execute:function(l,i){if(typeof console!=="undefined"){console.log(l,i)}this.lastSQL=l;this.lastParams=i;if(l.toUpperCase().indexOf("INSERT")===0){if(this.lastInsertRowId===null){this.lastInsertRowId=1}else{++this.lastInsertRowId}this.rowsAffected=1}if(l.toUpperCase().indexOf("DELETE")===0||l.toUpperCase().indexOf("UPDATE")===0){this.rowsAffected=1}return{sql:l,params:i,isValidRow:function(){return false},getRowCount:function(){return 0},getFieldCount:function(){return 0},getFieldName:function(){return""},field:function(){return""},next:function(){},close:function(){}}}});y.SQLAdapter=r})(dabl);