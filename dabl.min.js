dabl=typeof dabl==="undefined"?{}:dabl;(function(A){var e=false,s=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;function h(l,x,D){var i;for(i in l){x[i]=typeof l[i]==="function"&&typeof D[i]==="function"&&s.test(l[i])?(function(O,P){return function(){var R=this._super,Q;this._super=D[O];Q=P.apply(this,arguments);this._super=R;return Q}})(i,l[i]):l[i]}}var a=function(){};function p(i){try{Object.defineProperty(i,"sentinel",{value:"foo"});return"sentinel" in i}catch(l){return false}}a.canDefineProperties=p({});a.extend=function(D,O){if(typeof D==="undefined"){D={}}if(typeof O==="undefined"){O={}}var x,l;e=true;x=new this();e=false;function i(){if(!e&&this.init){this.init.apply(this,arguments)}}for(l in this){if(!(l in O)&&this.hasOwnProperty(l)){i[l]=this[l]}}h(D,x,this.prototype);h(O,i,this);i.prototype=x;i.prototype.constructor=i;return i};a.callAsync=a.prototype.callAsync=function g(D,Q,x){var l=A.Deferred(),P=l.promise();try{var i=D.call(this);if(i&&typeof i.then==="function"){P=i}else{l.resolve(i)}}catch(O){l.reject(O)}if(typeof Q==="function"||typeof x==="function"){P.then(Q,x)}return P};A.Class=a;function f(i){i=i+"";return i.length===2?i:"0"+i}function M(D){if(D===null){return null}if(D instanceof E){return D.constructor(D)}if(D instanceof Array){return D.slice(0)}if(D instanceof Date){return new Date(D.getTime())}switch(typeof D){case"string":case"boolean":case"number":case"undefined":case"function":return D}var x={};for(var l in D){if(D.hasOwnProperty(l)){x[l]=D[l]}}return x}function r(l,i,x){if(x&&x===E.FIELD_TYPE_DATE){l=C(l);i=C(i)}else{if(x&&x===E.FIELD_TYPE_TIMESTAMP){l=J(l);i=J(i)}}if(l instanceof Date&&i instanceof Date){return l.getTime()===i.getTime()}if(typeof l==="object"){return JSON.stringify(l)===JSON.stringify(i)}return l===i}function C(i){if(!(i instanceof Date)){i=J(i)}if(!i){return null}return i.getUTCFullYear()+"-"+f(i.getUTCMonth()+1)+"-"+f(i.getUTCDate())}function J(l){if(l===false||l===""||typeof l==="undefined"){return null}if(l instanceof Date){return l}var i=new Date(l);if(isNaN(i.getTime())){throw new Error(l+" is not a valid date")}return i}if(typeof jQuery!=="undefined"&&jQuery.Deferred){A.Deferred=jQuery.Deferred}else{function o(i){return Object.prototype.toString.call(i)==="[object Array]"}function c(l,D){if(o(l)){for(var x=0;x<l.length;x++){D(l[x])}}else{D(l)}}function j(P){var l="pending",Q=[],O=[],D=[],i=null,S={done:function(){for(var V=0;V<arguments.length;V++){if(!arguments[V]){continue}if(o(arguments[V])){var T=arguments[V];for(var U=0;U<T.length;U++){if(l==="resolved"){T[U].apply(this,i)}Q.push(T[U])}}else{if(l==="resolved"){arguments[V].apply(this,i)}Q.push(arguments[V])}}return this},fail:function(){for(var V=0;V<arguments.length;V++){if(!arguments[V]){continue}if(o(arguments[V])){var T=arguments[V];for(var U=0;U<T.length;U++){if(l==="rejected"){T[U].apply(this,i)}O.push(T[U])}}else{if(l==="rejected"){arguments[V].apply(this,i)}O.push(arguments[V])}}return this},always:function(){return this.done.apply(this,arguments).fail.apply(this,arguments)},progress:function(){for(var V=0;V<arguments.length;V++){if(!arguments[V]){continue}if(o(arguments[V])){var T=arguments[V];for(var U=0;U<T.length;U++){if(l==="pending"){D.push(T[U])}}}else{if(l==="pending"){D.push(arguments[V])}}}return this},then:function(){if(arguments.length>1&&arguments[1]){this.fail(arguments[1])}if(arguments.length>0&&arguments[0]){this.done(arguments[0])}if(arguments.length>2&&arguments[2]){this.progress(arguments[2])}return this},promise:function(U){if(U==null){return S}else{for(var T in S){U[T]=S[T]}return U}},state:function(){return l},debug:function(){console.log("[debug]",Q,O,l)},isRejected:function(){return l==="rejected"},isResolved:function(){return l==="resolved"},pipe:function(U,T,V){return j(function(W){c(U,function(X){if(typeof X==="function"){R.done(function(){var Y=X.apply(this,arguments);if(Y&&typeof Y==="function"){Y.promise().then(W.resolve,W.reject,W.notify)}else{W.resolve(Y)}})}else{R.done(W.resolve)}});c(T,function(X){if(typeof X==="function"){R.fail(function(){var Y=X.apply(this,arguments);if(Y&&typeof Y==="function"){Y.promise().then(W.resolve,W.reject,W.notify)}else{W.reject(Y)}})}else{R.fail(W.reject)}})}).promise()}},R={resolveWith:function(V){if(l==="pending"){l="resolved";var T=i=(arguments.length>1)?arguments[1]:[];for(var U=0;U<Q.length;U++){Q[U].apply(V,T)}}return this},rejectWith:function(V){if(l==="pending"){l="rejected";var T=i=(arguments.length>1)?arguments[1]:[];for(var U=0;U<O.length;U++){O[U].apply(V,T)}}return this},notifyWith:function(V){if(l==="pending"){var T=i=(arguments.length>1)?arguments[1]:[];for(var U=0;U<D.length;U++){D[U].apply(V,T)}}return this},resolve:function(){return this.resolveWith(this,arguments)},reject:function(){return this.rejectWith(this,arguments)},notify:function(){return this.notifyWith(this,arguments)}};var x=S.promise(R);if(P){P.apply(x,[x])}return x}j.when=function(){if(arguments.length<2){var i=arguments.length?arguments[0]:undefined;if(i&&(typeof i.isResolved==="function"&&typeof i.isRejected==="function")){return i.promise()}else{return j().resolve(i).promise()}}else{return(function(x){var Q=j(),O=x.length,l=0,P=new Array(O);for(var D=0;D<x.length;D++){(function(R){x[R].done(function(){P[R]=(arguments.length<2)?arguments[0]:arguments;if(++l===O){Q.resolve.apply(Q,P)}}).fail(function(){Q.reject(arguments)})})(D)}return Q.promise()})(arguments)}};A.Deferred=j}var E=a.extend({_oldValues:null,_isNew:true,_validationErrors:null,init:function E(i){this._validationErrors=[];var D={},l=this.constructor;for(var O in l._fields){var x=l._fields[O];if(typeof x.value!=="undefined"){D[O]=M(x.value)}else{if(x.type===Array){D[O]=[]}else{D[O]=null}}}this.fromJSON(D);this.resetModified();if(i){this.fromJSON(i)}},toString:function(){return this.constructor._table+":"+JSON.stringify(this.toJSON())},copy:function(){var i=this.constructor,l=new i(this),x=i.getKey();if(x){l[x]=null}return l},isModified:function(l){if(l){var i=this.constructor.getFieldType(l);return !r(this[l],this._oldValues[l],i)}for(var l in this.constructor._fields){if(this.isModified(l)){return true}}return false},getModified:function(){var i={};for(var l in this.constructor._fields){if(this.isModified(l)){i[l]=true}}return i},resetModified:function(){this._oldValues=JSON.parse(JSON.stringify(this));return this},revert:function(){this.fromJSON(this._oldValues);this.resetModified();return this},fromJSON:function(i){var l=this.constructor;for(var x in l._fields){if(!(x in i)){continue}this[x]=i[x]}l.coerceValues(this);return this},toJSON:function(){var P={},T,R,Q=this.constructor,D=Q._fields;if(this._inToJSON){return null}this._inToJSON=true;Q.coerceValues(this);for(T in D){R=this[T];if(R instanceof Array){var S=[];for(var i=0,O=R.length;i<O;++i){if(R[i]!==null&&typeof R[i].toJSON==="function"){S[i]=R[i].toJSON()}else{S[i]=M(R[i])}}R=S}else{if(D[T].type===E.FIELD_TYPE_DATE){R=C(R)}else{if(R!==null&&typeof R.toJSON==="function"){R=R.toJSON()}else{R=M(R)}}}P[T]=R}delete this._inToJSON;return P},hasKeyValues:function(){var O=this.constructor,D=O._keys;if(D.length===0){return false}O.coerceValues(this);for(var l=0,i=D.length;l<i;++l){var P=D[l];if(this[P]===null){return false}}return true},getKeyValues:function(){var O={},P=this.constructor,D=P._keys;P.coerceValues(this);for(var l=0,i=D.length;l<i;++l){var Q=D[l];O[Q]=this[Q]}return O},isNew:function(){return this._isNew},setNew:function(i){this._isNew=(i===true);return this},validate:function(){this._validationErrors=[];var i=this.constructor;i.coerceValues(this);for(var D in i._fields){var x=i._fields[D];if(!x.required){continue}var l=this[D];if(!l||(l instanceof Array&&l.length===0)){this._validationErrors.push(D+" is required.")}}return this._validationErrors.length===0},getValidationErrors:function(){return this._validationErrors},save:function(l,i){if(this.isNew()){return this.insert(l,i)}else{return this.update(l,i)}},insert:function(l,i){return this.callAsync(function(){var x=this.constructor;if(!this.validate()){throw new Error("Cannot save "+x._table+" with validation errors:\n"+this.getValidationErrors().join("\n"))}if(this.isNew()&&x.hasField("created")&&!this.isModified("created")){this.created=new Date()}if((this.isNew()||this.isModified())&&x.hasField("updated")&&!this.isModified("updated")){this.updated=new Date()}return this.constructor._adapter.insert(this)},l,i)},update:function(i,x,l){if(typeof i==="function"){x=i;l=x}return this.callAsync(function(){var D=this.constructor;if(!this.validate()){throw new Error("Cannot save "+D._table+" with validation errors:\n"+this.getValidationErrors().join("\n"))}if(D._keys.length===0){throw new Error("Cannot update without primary keys")}if(this.isNew()&&D.hasField("created")&&!this.isModified("created")){this.created=new Date()}if((this.isNew()||this.isModified())&&D.hasField("updated")&&!this.isModified("updated")){this.updated=new Date()}if(typeof i==="object"){this.fromJSON(i)}return D._adapter.update(this)},x,l)},remove:function(l,i){return this.callAsync(function(){return this.constructor._adapter.remove(this)},l,i)}});E.models={};E._fields=E._keys=E._table=null;E._autoIncrement=false;E.FIELD_TYPE_TEXT="TEXT";E.FIELD_TYPE_NUMERIC="NUMERIC";E.FIELD_TYPE_INTEGER="INTEGER";E.FIELD_TYPE_DATE="DATE";E.FIELD_TYPE_TIME="TIME";E.FIELD_TYPE_TIMESTAMP="TIMESTAMP";E.FIELD_TYPES={TEXT:E.FIELD_TYPE_TEXT,NUMERIC:E.FIELD_TYPE_NUMERIC,INTEGER:E.FIELD_TYPE_INTEGER,DATE:E.FIELD_TYPE_DATE,TIME:E.FIELD_TYPE_TIME,TIMESTAMP:E.FIELD_TYPE_TIMESTAMP};E.TEXT_TYPES={TEXT:E.FIELD_TYPE_TEXT,DATE:E.FIELD_TYPE_DATE,TIME:E.FIELD_TYPE_TIME,TIMESTAMP:E.FIELD_TYPE_TIMESTAMP};E.INTEGER_TYPES={INTEGER:E.FIELD_TYPE_INTEGER};E.TEMPORAL_TYPES={DATE:E.FIELD_TYPE_DATE,TIME:E.FIELD_TYPE_TIME,TIMESTAMP:E.FIELD_TYPE_TIMESTAMP};E.NUMERIC_TYPES={INTEGER:E.FIELD_TYPE_INTEGER,NUMERIC:E.FIELD_TYPE_NUMERIC};E.isFieldType=function(i){return(i in E.FIELD_TYPES||this.isObjectType(i))};E.isTemporalType=function(i){return(i in this.TEMPORAL_TYPES)};E.isTextType=function(i){return(i in this.TEXT_TYPES)};E.isNumericType=function(i){return(i in this.NUMERIC_TYPES)};E.isIntegerType=function(i){return(i in this.INTEGER_TYPES)};E.isObjectType=function(i){return typeof i==="function"};E.coerceValue=function(R,S){var O=S.type;if(typeof R==="undefined"||R===null){if(O===Array){R=[]}else{return null}}var Q=this.isTemporalType(O),P=this.isNumericType(O);if(P||Q){if(""===R){return null}}if(P){if(this.isIntegerType(O)){R=parseInt(R,10);if(isNaN(R)){throw new Error(R+" is not a valid integer")}}else{R=parseFloat(R,10);if(isNaN(R)){throw new Error(R+" is not a valid float")}}}else{if(Q){if(!(R instanceof Date)){R=J(R)}}else{if(O===Array){if(S.elementType){this.convertArray(R,S.elementType);for(var i=0,D=R.length;i<D;++i){R[i]=this.coerceValue(R[i],{type:S.elementType})}}}else{if(O===this.FIELD_TYPE_TEXT){if(typeof R!=="string"){R=R+""}}else{if(this.isObjectType(O)&&O.isModel&&R.constructor!==O){R=O.inflate(R)}}}}}return R};E.coerceValues=function(i){if(null===i||typeof i==="undefined"){return this}for(var l in this._fields){if(!(l in i)){continue}i[l]=this.coerceValue(i[l],this._fields[l])}return this};E.convertArray=function(S,O){if(S.modelCollection){return}S.modelCollection=true;var P=this;S.push=function(){return Array.prototype.push.apply(this,P.coerceValue(arguments,{type:Array,elementType:O}))};S.unshift=function(){return Array.prototype.unshift.apply(this,P.coerceValue(arguments,{type:Array,elementType:O}))};S.pop=function(){return P.coerceValue(Array.prototype.pop.apply(this,arguments),{type:O})};S.shift=function(){return P.coerceValue(Array.prototype.shift.apply(this,arguments),{type:O})};S.slice=function(){return P.coerceValue(Array.prototype.slice.apply(this,arguments),{type:Array,elementType:O})};S.concat=function(){return P.coerceValue(Array.prototype.concat.apply(this,arguments),{type:Array,elementType:O})};S.splice=function(){for(var T=2,U=arguments.length;T<U;++T){arguments[T]=P.coerceValue(arguments[T],{type:O})}return P.coerceValue(Array.prototype.splice.apply(this,arguments),{type:Array,elementType:O})};var R=["forEach","every","some","filter","map"];for(var i=0,D=R.length;i<D;++i){var Q=R[i];S[Q]=(function(l){return function(T,x){return Array.prototype[l].call(this,function(){arguments[0]=P.coerceValue(arguments[0],{type:O});return T.apply(this,arguments)},x)}})(Q)}};E.getAdapter=function(){return this._adapter};E.setAdapter=function(i){this._adapter=i;return this};E.inflate=function(x){var D=this.getKey(),l=this.getAdapter(),i;if(D&&x[D]){i=l.cache(this._table,x[D]);if(i){if(i.isModified()){return i}i.fromJSON(x)}}if(!i){i=new this(x)}i.resetModified().setNew(false);if(D&&i[D]){l.cache(this._table,i[D],i)}return i};E.inflateArray=function(O){var D,x,l;if(O.constructor!==Array){if(typeof l.length==="undefined"){throw new Error("Unknown array type for collection.")}l=[]}else{l=O}for(D=0,x=O.length;D<x;++D){l[D]=this.inflate(O[D])}this.convertArray(l,this);return l};E.getTableName=function(){return this._table};E.getFields=function(){return M(this._fields)};E.getField=function(i){return M(this._fields[i])};E.getFieldType=function(i){return this._fields[i].type};E.hasField=function(i){return i in this._fields};E.getKeys=function(){return this._keys.slice(0)};E.getKey=function(){return this._keys.length===1?this._keys[0]:null};E.isAutoIncrement=function(){return this._autoIncrement};E.addField=function(l,i){if(!i.type){i={type:i}}if(typeof i.type==="string"){i.type=i.type.toUpperCase()}switch(i.type){case"STRING":case String:i.type=this.FIELD_TYPE_TEXT;break;case Number:i.type=this.FIELD_TYPE_NUMERIC;break;case Date:i.type=this.FIELD_TYPE_TIMESTAMP;break;case"INT":i.type=this.FIELD_TYPE_INTEGER;break}if(i.key){this._keys.push(l)}if(i.computed){this._autoIncrement=true}if(!this.isFieldType(i.type)){throw new Error(i.type+" is not a valide field type")}if(i.type.isModel){this._relations.push(l)}this._fields[l]=i};E.extend=function(l,i){var x,O,D;i=i||{};if(typeof l==="undefined"){throw new Error("Must provide a table when exending Model")}x=a.extend.call(this,i.prototype);delete i.prototype;if(!this._table&&!this._fields){if(!i.fields){throw new Error("Must provide fields when exending Model")}x._keys=[];x._fields={};x._relations=[]}else{x._keys=M(this._keys);x._fields=M(this._fields);x._relations=M(this._relations)}x._table=l;for(D in i){switch(D){case"url":case"adapter":x["_"+D]=i[D];break;default:x[D]=i[D];break}}for(O in i.fields){x.addField(O,i.fields[O])}E.models[l]=x;return x};E.isModel=true;E.toString=function(){return this._table};var v=["countAll","findAll","find","removeAll","updateAll"];for(var K=0,H=v.length;K<H;++K){var L=v[K];E[L]=(function(i){return function(){var P=Array.prototype.slice.call(arguments),D=this.getAdapter(),Q=null,O=null,l=P.length-1;while(l>-1&&!(P[l] instanceof E)&&typeof P[l]==="function"){if(!Q){Q=P.pop();--l;continue}O=Q;Q=P.pop();break}P.unshift(this);return this.callAsync(function(){return D[i].apply(D,P)},Q,O)}})(L)}var q=["findBy","retrieveByField","retrieveByPK","retrieveByPKs","findByPKs"];for(var B=0,m=q.length;B<m;++B){E[q[B]]=E.find}A.Model=E;var n=a.extend({_conds:null,init:function n(D,l,x,i){this._conds=[];if(arguments.length!==0){this.and.apply(this,arguments)}},_preprocessCondition:function(O,x,D,l){switch(arguments.length){case 0:return null;case 1:if(O instanceof z.Statement||(O instanceof n&&O._conds.length!==0)){return[O]}else{return null}case 2:D=x;x=n.EQUAL;case 3:l=n.QUOTE_RIGHT}var P=D instanceof z,i=D instanceof Array;if(i||P){if(false===P||1!==D.getLimit()){switch(x){case n.BETWEEN:break;case n.IN:case n.EQUAL:case"eq":x=n.IN;break;case"ne":case n.NOT_IN:case n.NOT_EQUAL:case n.ALT_NOT_EQUAL:x=n.NOT_IN;break;default:throw new Error(x+" unknown for comparing an array.")}}if(i){if(0===D.length&&x===n.NOT_IN){return null}}if(P){if(!D.getTable()){throw new Error("right does not have a table, so it cannot be nested.")}if(l!==n.QUOTE_LEFT){l=n.QUOTE_NONE}}}else{if(null===D){if(x===n.NOT_EQUAL||x===n.ALT_NOT_EQUAL||x==="ne"){x=n.IS_NOT_NULL}else{if(x===n.EQUAL||x==="eq"){x=n.IS_NULL}}}if(x===n.IS_NULL||x===n.IS_NOT_NULL){D=null;if(l!==n.QUOTE_LEFT){l=n.QUOTE_NONE}}}return[O,x,D,l]},_processCondition:function(O,D,V,l){if(arguments.length===1){if(O instanceof z.Statement){return O}if(O instanceof n){W=O.getQueryStatement();W.setString("("+W._qString+")");return W}}var T=new z.Statement,W,U,S=V instanceof z,Q=V instanceof Array,i;if(!(D in n.SQL.operators)){throw new Error('Unsupported SQL operator: "'+D+'"')}if(D==="substringof"){var P=O;O=V;V=P}D=n.SQL.operators[D];if(l===n.QUOTE_LEFT||l===n.QUOTE_BOTH){T.addParam(O);O="?"}if(D===n.CONTAINS){D=n.LIKE;V="%"+V+"%"}else{if(D===n.BEGINS_WITH){D=n.LIKE;V+="%"}else{if(D===n.ENDS_WITH){D=n.LIKE;V="%"+V}}}if(Q||S){if(S){W=V.getQuery();V="("+W._qString+")";T.addParams(W._params)}else{if(Q){i=V.length;if(2===i&&D===n.BETWEEN){T.setString(O+" "+D+" ? AND ?");T.addParams(V);return T}else{if(0===i){if(D===n.IN){T.setString("(0 = 1)");return T}}else{if(l===n.QUOTE_RIGHT||l===n.QUOTE_BOTH){T.addParams(V);var R="(";for(U=0;U<i;++U){if(0<U){R+=","}R+="?"}V=R+")"}}}}}}else{if(D!==n.IS_NULL&&D!==n.IS_NOT_NULL&&(l===n.QUOTE_RIGHT||l===n.QUOTE_BOTH)){T.addParam(V);V="?"}}T.setString(O+" "+D+(V===null?"":" "+V));return T},prepareInput:function(D){if(D instanceof Array){D=D.slice(0);for(var l=0,i=D.length;l<i;++l){D[l]=this.prepareInput(D[l])}return D}if(D===true||D===false){return D?1:0}if(D===null||typeof D==="undefined"){return"null"}if(parseInt(D,10)===D){return D}return this.quote(D)},quote:function(i){return"'"+i.replace("'","''")+"'"},_processODataCondition:function(Q,O,V,l){if(arguments.length===1){if(Q instanceof z.Statement){throw new Error("Unable to use Query.Statement within a Condition to build an OData query")}if(Q instanceof n){return"("+Q.getODataFilter()+")"}}if(V instanceof z){throw new Error("Unable to use Query within a Condition to build an OData query")}var U,R=V instanceof Array,i;if(l===n.QUOTE_LEFT||l===n.QUOTE_BOTH){Q=this.prepareInput(Q)}switch(O){case"startswith":case"endswith":case"substringof":case n.LIKE:case n.CONTAINS:case n.BEGINS_WITH:case n.ENDS_WITH:if(V.indexOf("%")!==-1){throw new Error("Cannot use % in OData queries")}break}if(O===n.IS_NULL){O=n.EQUAL;V="null"}else{if(O===n.IS_NOT_NULL){O=n.NOT_EQUAL;V="null"}else{if(l===n.QUOTE_RIGHT||l===n.QUOTE_BOTH){V=this.prepareInput(V)}}}if(R){i=V.length;if(2===i&&O===n.BETWEEN){return"("+Q+" ge "+V[0]+" and "+Q+" le "+V[1]+")"}else{if(0===i&&O===n.IN){return"(0 eq 1)"}else{var W;if(O===n.IN){O=" eq ";W=" or "}else{O=" ne ";W=" and "}var S="(";for(U=0;U<i;++U){S+=(0!==U?W:"")+Q+O+V[U]}return S+")"}}}else{if(O in n.OData.operators){O=n.OData.operators[O];return Q+" "+O+" "+V}else{if(O in n.OData.functions){var P=n.OData.functions[O];var D=P.indexOf("@");var T=P.indexOf("?");if(D>T){P=P.substring(0,D)+V+P.substr(D+1);P=P.substring(0,T)+Q+P.substr(T+1)}else{P=P.substring(0,T)+Q+P.substr(T+1);P=P.substring(0,D)+V+P.substr(D+1)}return P}}}throw new Error("Unexpected arguments: "+arguments.join(", "))},and:function(P,l,O,i){var D;if(P.constructor===Object){for(D in P){this.and(D,P[D])}return this}var x=this._preprocessCondition.apply(this,arguments);if(null===x){return this}x.type="AND";this._conds.push(x);return this},addAnd:function(D,l,x,i){return this.and.apply(this,arguments)},add:function(D,l,x,i){return this.and.apply(this,arguments)},filter:function(D,l,x,i){return this.and.apply(this,arguments)},where:function(D,l,x,i){return this.and.apply(this,arguments)},or:function(P,l,O,i){var D;if(P.constructor===Object){for(D in P){this.or(D,P[D])}return this}var x=this._preprocessCondition.apply(this,arguments);if(null===x){return this}x.type="OR";this._conds.push(x);return this},addOr:function(D,l,x,i){return this.or.apply(this,arguments)},orWhere:function(D,l,x,i){return this.or.apply(this,arguments)},andNot:function(i,l){return this.and(i,n.NOT_EQUAL,l)},andLike:function(i,l){return this.and(i,n.LIKE,l)},andNotLike:function(i,l){return this.and(i,n.NOT_LIKE,l)},andGreater:function(i,l){return this.and(i,n.GREATER_THAN,l)},andGreaterEqual:function(i,l){return this.and(i,n.GREATER_EQUAL,l)},andLess:function(i,l){return this.and(i,n.LESS_THAN,l)},andLessEqual:function(i,l){return this.and(i,n.LESS_EQUAL,l)},andNull:function(i){return this.and(i,null)},andNotNull:function(i){return this.and(i,n.NOT_EQUAL,null)},andBetween:function(i,x,l){return this.and(i,n.BETWEEN,[x,l])},andBeginsWith:function(i,l){return this.and(i,n.BEGINS_WITH,l)},andEndsWith:function(i,l){return this.and(i,n.ENDS_WITH,l)},andContains:function(i,l){return this.and(i,n.CONTAINS,l)},orNot:function(i,l){return this.or(i,n.NOT_EQUAL,l)},orLike:function(i,l){return this.or(i,n.LIKE,l)},orNotLike:function(i,l){return this.or(i,n.NOT_LIKE,l)},orGreater:function(i,l){return this.or(i,n.GREATER_THAN,l)},orGreaterEqual:function(i,l){return this.or(i,n.GREATER_EQUAL,l)},orLess:function(i,l){return this.or(i,n.LESS_THAN,l)},orLessEqual:function(i,l){return this.or(i,n.LESS_EQUAL,l)},orNull:function(i){return this.or(i,null)},orNotNull:function(i){return this.or(i,n.NOT_EQUAL,null)},orBetween:function(i,x,l){return this.or(i,n.BETWEEN,[x,l])},orBeginsWith:function(i,l){return this.or(i,n.BEGINS_WITH,l)},orEndsWith:function(i,l){return this.or(i,n.ENDS_WITH,l)},orContains:function(i,l){return this.or(i,n.CONTAINS,l)},getQueryStatement:function(R){if(0===this._conds.length){return null}var Q=new z.Statement(R),D="",l,P,O=this._conds,i=O.length;for(l=0;l<i;++l){P=this._processCondition.apply(this,O[l]);if(null===P){continue}D+="\n\t";if(0!==l){D+=((1===l&&O[0].type==="OR")?"OR":O[l].type)+" "}D+=P._qString;Q.addParams(P._params)}Q.setString(D);return Q},getODataFilter:function(){if(0===this._conds.length){return null}var P="",l,O,D=this._conds,i=D.length;for(l=0;l<i;++l){O=this._processODataCondition.apply(this,D[l]);if(null===O){continue}if(0!==l){P+=" "+((1===l&&D[0].type==="or")?"or":(D[l].type==="OR"?"or":"and"))+" "}P+=O}return P},toString:function(){return this.getQueryStatement().toString()},getSimpleJSON:function(){var P={};if(0===this._conds.length){return{}}var l,O,D=this._conds,i=D.length;for(l=0;l<i;++l){var O=D[l];if("AND"!==O.type){throw new Error("OR conditions not supported.")}if(O.length===2){P[O[0]]=O[1]}else{if(O[1]===n.EQUAL){P[O[0]]=O[2]}else{throw new Error('Cannot export complex condition: "'+this._processCondition.apply(this,O)+'"')}}}return P}});n.EQUAL="=";n.NOT_EQUAL="<>";n.ALT_NOT_EQUAL="!=";n.GREATER_THAN=">";n.LESS_THAN="<";n.GREATER_EQUAL=">=";n.LESS_EQUAL="<=";n.LIKE="LIKE";n.BEGINS_WITH="BEGINS_WITH";n.ENDS_WITH="ENDS_WITH";n.CONTAINS="CONTAINS";n.NOT_LIKE="NOT LIKE";n.IN="IN";n.NOT_IN="NOT IN";n.IS_NULL="IS NULL";n.IS_NOT_NULL="IS NOT NULL";n.BETWEEN="BETWEEN";n.BINARY_AND="&";n.BINARY_OR="|";n.SQL={operators:{eq:"=",ne:"<>",gt:">",lt:"<",ge:">=",le:"<=","=":"=","<>":"<>","!=":"<>",">":">","<":"<",">=":">=","<=":"<=","&":"&","|":"|",startswith:"BEGINS_WITH",BEGINS_WITH:"BEGINS_WITH",endswith:"ENDS_WITH",ENDS_WITH:"BEGINS_WITH",substringof:"CONTAINS",CONTAINS:"CONTAINS",LIKE:"LIKE","NOT LIKE":"NOT LIKE",IN:"IN","NOT IN":"NOT IN","IS NULL":"IS NULL","IS NOT NULL":"IS NOT NULL",BETWEEN:"BETWEEN"}};n.OData={operators:{eq:"eq",ne:"ne",gt:"gt",lt:"lt",ge:"ge",le:"le","=":"eq","<>":"ne","!=":"ne",">":"gt","<":"lt",">=":"ge","<=":"le","&":"&","|":"|"},functions:{startswith:"startswith(?, @)",endswith:"endswith(?, @)",substringof:"substringof(@, ?)",BEGINS_WITH:"startswith(?, @)",ENDS_WITH:"endswith(?, @)",CONTAINS:"substringof(@, ?)",LIKE:"tolower(@) eq tolower(?)","NOT LIKE":"tolower(@) ne tolower(?)"}};n.QUOTE_LEFT=1;n.QUOTE_RIGHT=2;n.QUOTE_BOTH=3;n.QUOTE_NONE=4;A.Condition=n;var z=n.extend({_action:"SELECT",_columns:null,_table:null,_tableAlias:null,_extraTables:null,_joins:null,_orders:null,_groups:null,_having:null,_limit:null,_offset:0,_distinct:false,init:function z(l,i){this._super();this._columns=[];this._joins=[];this._orders=[];this._groups=[];if(!l){return}if(l.constructor===Object){this.and(l)}else{if(l){this.setTable(l,i)}}},setDistinct:function(i){if(typeof i==="undefined"){i=true}this._distinct=i===true},setAction:function(i){switch(i){case"SELECT":case"DELETE":case"COUNT":break;default:throw new Error('"'+i+'" is not an allowed Query action.');break}this._action=i;return this},getAction:function(){return this._action},addColumn:function(i){this._columns.push(i);return this},setColumns:function(i){this._columns=i.slice(0);return this},select:function(i){return this.setColumns.apply(this,arguments)},getColumns:function(){return this._columns},setGroups:function(i){this._groups=i;return this},getGroups:function(){return this._groups},setTable:function(l,i){if(l instanceof z){if(!i){throw new Error("The nested query must have an alias.")}}if(i){this.setAlias(i)}this._table=l;return this},from:function(l,i){return this.setTable.apply(this,arguments)},getTable:function(){return this._table},setAlias:function(i){this._tableAlias=i;return this},getAlias:function(){return this._tableAlias},addTable:function(i,l){if(i instanceof z){if(!l){throw new Error("The nested query must have an alias.")}}else{if(typeof l==="undefined"){l=i}}if(l===this._tableAlias||l===this._table){throw new Error('The alias "'+l+'" is is already in use')}if(this._extraTables===null){this._extraTables={}}this._extraTables[l]=i;return this},addJoin:function(l,i,x){if(l instanceof z.Join){this._joins.push(l);return this}if(null===i){if(x===z.JOIN||x===z.INNER_JOIN){this.addTable(l);return this}i="1 = 1"}this._joins.push(new z.Join(l,i,x));return this},join:function(l,i,x){return this.addJoin(l,i,x)},innerJoin:function(l,i){return this.addJoin(l,i,z.INNER_JOIN)},leftJoin:function(l,i){return this.addJoin(l,i,z.LEFT_JOIN)},rightJoin:function(l,i){return this.addJoin(l,i,z.RIGHT_JOIN)},outerJoin:function(l,i){return this.addJoin(l,i,z.OUTER_JOIN)},getJoins:function(){return this._joins},setJoins:function(i){this._joins=i;return this},groupBy:function(i){this._groups.push(i);return this},setHaving:function(i){if(null!==i&&!(i instanceof n)){throw new Error("setHaving must be given an instance of Condition")}this._having=i;return this},getHaving:function(){return this._having},orderBy:function(l,i){this._orders.push(arguments);return this},limit:function(i,l){i=parseInt(i);if(isNaN(i)){throw new Error("Not a number")}this._limit=i;if(arguments.length>1){this.setOffset(l)}return this},top:function(i,l){return this.limit.apply(this,arguments)},getLimit:function(){return this._limit},offset:function(i){i=parseInt(i);if(isNaN(i)){throw new Error("Not a number.")}this._offset=i;return this},skip:function(i){return this.offset.apply(this,arguments)},setPage:function(i){i=parseInt(i);if(isNaN(i)){throw new Error("Not a number.")}if(i<2){this._offset=null;return this}if(!this._limit){throw new Error("Cannot set page without first setting limit.")}this._offset=i*this._limit-this._limit;return this},hasAggregates:function(){if(this._groups.length!==0){return true}for(var l=0,i=this._columns.length;l<i;++l){if(this._columns[l].indexOf("(")!==-1){return true}}return false},needsComplexCount:function(){return this.hasAggregates()||null!==this._having||this._distinct},getQuery:function(W){if(typeof W==="undefined"){W=new k}var U=new z.Statement(W),l,S,O,X,R,i,T,V,Q;l="";switch(this._action){default:case z.ACTION_COUNT:case z.ACTION_SELECT:S=this.getColumnsClause(W);U.addParams(S._params);l+="SELECT "+S._qString;break;case z.ACTION_DELETE:l+="DELETE";break}O=this.getTablesClause(W);U.addParams(O._params);l+="\nFROM "+O._qString;if(this._joins.length!==0){for(X=0,R=this._joins.length;X<R;++X){i=this._joins[X],T=i.getQueryStatement(W);l+="\n\t"+T._qString;U.addParams(T._params)}}V=this.getWhereClause();if(null!==V){l+="\nWHERE "+V._qString;U.addParams(V._params)}if(this._groups.length!==0){l+="\nGROUP BY "+this._groups.join(", ")}if(null!==this.getHaving()){Q=this.getHaving().getQueryStatement();if(Q){l+="\nHAVING "+Q._qString;U.addParams(Q._params)}}if(this._action!==z.ACTION_COUNT&&this._orders.length!==0){l+="\nORDER BY ";for(X=0,R=this._orders.length;X<R;++X){var P=this._orders[X][0];var D=this._orders[X][1];if(null!==D&&typeof D!=="undefined"){P=P+" "+D}if(0!==X){l+=", "}l+=P}}if(null!==this._limit){if(W){l=W.applyLimit(l,this._offset,this._limit)}else{l+="\nLIMIT "+(this._offset?this._offset+", ":"")+this._limit}}if(this._action===z.ACTION_COUNT&&this.needsComplexCount()){l="SELECT count(0)\nFROM ("+l+") a"}U.setString(l);return U},getTablesClause:function(Q){var T=this._table,O,D,x,R,i,S,P,l;if(!T){throw new Error("No table specified.")}O=new z.Statement(Q);D=this._tableAlias;if(T instanceof z){x=T.getQuery(Q),i="("+x._qString+")"}else{x=null;i=T}switch(this._action){case z.ACTION_COUNT:case z.ACTION_SELECT:if(null!==x){O.addParams(x._params)}if(D){i=i+" AS "+D}if(this._extraTables!==null){for(R in this._extraTables){S=this._extraTables[R];if(S instanceof z){P=S.getQuery(Q),l="("+P._qString+") AS "+R;O.addParams(P._params)}else{l=S;if(R!==S){l=l+" AS "+R}}i=i+", "+l}}O.setString(i);break;case z.ACTION_DELETE:if(null!==x){O.addParams(x._params)}if(D){i=i+" AS "+D}O.setString(i);break;default:break}return O},getColumnsClause:function(R){var U=this._table,i,Q=new z.Statement(R),O=this._tableAlias,l=this._action,S,P,T,D;if(l===z.ACTION_DELETE){return Q}if(!U){throw new Error("No table specified.")}if(l===z.ACTION_COUNT){if(!this.needsComplexCount()){Q.setString("count(0)");return Q}if(this._groups.length!==0){Q.setString(this._groups.join(", "));return Q}if(!this._distinct&&null===this.getHaving()&&this._columns.length!==0){T=[];for(S=0,P=this._columns.length;S<P;++S){i=this._columns[S];if(i.indexOf("(")===-1){continue}T.push(i)}if(T.length!==0){Q.setString(T.join(", "));return Q}}}if(this._columns.length!==0){D=this._columns.join(", ")}else{if(O){D=O+".*"}else{D=U+".*"}}if(this._distinct){D="DISTINCT "+D}Q.setString(D);return Q},getWhereClause:function(i){return this.getQueryStatement(i)},toString:function(){if(!this._table){this.setTable("{UNSPECIFIED-TABLE}")}return this.getQuery().toString()},getCountQuery:function(i){if(!this._table){throw new Error("No table specified.")}this.setAction(z.ACTION_COUNT);return this.getQuery(i)},getDeleteQuery:function(i){if(!this._table){throw new Error("No table specified.")}this.setAction(z.ACTION_DELETE);return this.getQuery(i)},getSelectQuery:function(i){if(!this._table){throw new Error("No table specified.")}this.setAction(z.ACTION_SELECT);return this.getQuery(i)},getODataQuery:function(){if(this._joins&&this._joins.length!==0){throw new Error("JOINS cannot be exported.")}if(this._extraTables&&this._extraTables.length!==0){throw new Error("Extra tables cannot be exported.")}if(this._having&&this._having.length!==0){throw new Error("Having cannot be exported.")}if(this._groups&&this._groups.length!==0){throw new Error("Grouping cannot be exported.")}var l={};if(this._columns.length!==0){l.$select=this._columns.join(",")}var i=this.getODataFilter();if(i){l.$filter=i}if(this._limit){l.$top=this._limit;if(this._offset){l.$skip=this._offset}}if(this._orders&&this._orders.length!==0){l.$orderby=this._orders[0][0];if(this._orders[0][1]===z.DESC){l.$orderby+=" desc"}}return l},getSimpleJSON:function(){if(this._joins&&this._joins.length!==0){throw new Error("JOINS cannot be exported.")}if(this._extraTables&&this._extraTables.length!==0){throw new Error("Extra tables cannot be exported.")}if(this._having&&this._having.length!==0){throw new Error("Having cannot be exported.")}if(this._groups&&this._groups.length!==0){throw new Error("Grouping cannot be exported.")}var i=this._super();if(this._limit){i.limit=this._limit;if(this._offset){i.offset=this._offset;i.page=Math.floor(this._offset/this._limit)+1}}if(this._orders&&this._orders.length!==0){i.order_by=this._orders[0][0];if(this._orders[0][1]===z.DESC){i.dir=z.DESC}}if(this._action===z.ACTION_COUNT){i.count_only=1}return i}});z.ACTION_COUNT="COUNT";z.ACTION_DELETE="DELETE";z.ACTION_SELECT="SELECT";z.JOIN="JOIN";z.LEFT_JOIN="LEFT JOIN";z.RIGHT_JOIN="RIGHT JOIN";z.INNER_JOIN="INNER JOIN";z.OUTER_JOIN="OUTER JOIN";z.ASC="ASC";z.DESC="DESC";A.Query=z;var I=/^\w+\.\w+$/;var b=function b(l,i,x){if(arguments.length<3){x=z.JOIN}if(!(l instanceof z)&&!(i instanceof n)&&I.test(i)&&I.test(l)){this._isLikePropel=true;this._leftColumn=l;this._rightColumn=i;this._table=i.substring(0,i.indexOf("."));this._joinType=x;return}this.setTable(l).setOnClause(i).setJoinType(x)};b.prototype={_table:null,_alias:null,_onClause:null,_isLikePropel:false,_leftColumn:null,_rightColumn:null,_joinType:z.JOIN,toString:function(){if(!this.getTable()){this.setTable("{UNSPECIFIED-TABLE}")}return this.getQueryStatement().toString()},setTable:function(l){var x=l.lastIndexOf(" "),i=x===-1?-1:l.toUpperCase().lastIndexOf(" AS ");if(i!==x-3){i=-1}if(x!==-1){this.setAlias(l.substr(x+1));l=l.substring(0,i===-1?x:i)}this._table=l;return this},setAlias:function(i){this._alias=i;return this},setOnClause:function(i){this._isLikePropel=false;this._onClause=i;return this},setJoinType:function(i){this._joinType=i;return this},getQueryStatement:function(P){var O,D=this._table,l=this._onClause,Q=this._joinType,x=this._alias,i;if(D instanceof z){O=D.getQuery(P);D="("+O._qString+")";O.setString("")}else{O=new z.Statement(P)}if(x){D+=" AS "+x}if(this._isLikePropel){l=this._leftColumn+" = "+this._rightColumn}else{if(null===l){l="1 = 1"}else{if(l instanceof n){i=l.getQueryStatement();l=i._qString;O.addParams(i.getParams())}}}if(""!==l){l="ON ("+l+")"}O.setString(Q+" "+D+" "+l);return O},getTable:function(){return this._table},getAlias:function(){return this._alias},getOnClause:function(){if(this._isLikePropel){return this._leftColumn+" = "+this._rightColumn}return this._onClause},getJoinType:function(){return this._joinType}};A.Query.Join=b;var F=function F(i){this._params=[];if(i){this._conn=i}};F.embedParams=function(P,S,Q){if(Q){S=Q.prepareInput(S)}var R="?";if(P.split(R).length-1!==S.length){throw new Error("The number of occurances of "+R+" do not match the number of _params.")}if(S.length===0){return P}var l=P.length,D=R.length,i,O;for(i=S.length-1;i>=0;--i){O=S[i];l=P.lastIndexOf(R,l);if(l===-1){throw new Error("The number of occurances of "+R+" do not match the number of _params.")}P=P.substring(0,l)+O+P.substr(l+D)}return P};F.prototype={_qString:"",_params:null,_conn:null,setConnection:function(i){this._conn=i},getConnection:function(){return this._conn},setString:function(i){this._qString=i},getString:function(){return this._qString},addParams:function(i){this._params=this._params.concat(i)},setParams:function(i){this._params=i.slice(0)},addParam:function(i){this._params.push(i)},getParams:function(){return this._params.slice(0)},toString:function(){return z.Statement.embedParams(this._qString,this._params.slice(0),this._conn)}};A.Query.Statement=F;var u=a.extend({_cache:null,init:function u(){this._cache={}},cache:function(l,i,x){if(!this._cache[l]){this._cache[l]={}}if(arguments.length<3){if(!this._cache[l][i]){return null}return this._cache[l][i]}this._cache[l][i]=x;return this},emptyCache:function(i){delete this._cache[i]},formatDate:function(l,i){if(!l){return null}if(i&&i===E.FIELD_TYPE_TIMESTAMP){return this.formatDateTime(l)}if(!(l instanceof Date)){l=J(l)}return l.getUTCFullYear()+"-"+f(l.getUTCMonth()+1)+"-"+f(l.getUTCDate())},formatDateTime:function(i){if(!i){return null}if(!(i instanceof Date)){i=J(i)}return i.getFullYear()+"-"+f(i.getMonth()+1)+"-"+f(i.getDate())+" "+f(i.getHours())+":"+f(i.getMinutes())+":"+f(i.getSeconds())},findQuery:function(x){var l=Array.prototype.slice.call(arguments),O=new z().setTable(x.getTableName()),D=x.getKey();l.shift();var i=l.length;if(i===0){return O}if(i===1){if(typeof l[0]==="object"){if(l[0] instanceof z){if(!l[0].getTable()){l[0].setTable(x.getTableName())}return l[0]}else{O.and(l[0])}}else{if(D){var P=parseInt(l[0],10);if(isNaN(P)){O.and(D,l[0])}else{O.and(D,P)}}}}else{if((i===2||i===3||i===4)&&typeof l[0]==="string"){O.and.apply(O,l)}else{throw new Error("Unknown arguments for find: ("+l.join(", ")+")")}}return O},find:function(i){throw new Error("find not implemented for this adapter")},findAll:function(i){throw new Error("findAll not implemented for this adapter")},countAll:function(i,l){throw new Error("countAll not implemented for this adapter")},removeAll:function(i,l){throw new Error("removeAll not implemented for this adapter")},insert:function(i){throw new Error("insert not implemented for this adapter")},update:function(i){throw new Error("update not implemented for this adapter")},remove:function(i){throw new Error("remove not implemented for this adapter")}});A.Adapter=u;function G(i){return d(i,true).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function d(l,i){return encodeURIComponent(l).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace((i?null:/%20/g),"+")}function w(P,R){this.template=P;this.defaults=R||{};var D=this.urlParams={},Q=P.split(/\W/);for(var O=0,x=Q.length;O<x;++O){var S=Q[O];if(S&&P.match(new RegExp("[^\\\\]:"+S+"(\\W|$)"))){D[S]=true}}this.template=P.replace(/\\:/g,":")}w.prototype={url:function(P){var x=this,D=this.template,O,l;P=P||{};for(var i in this.urlParams){O=typeof P[i]!=="undefined"||P.hasOwnProperty(i)?P[i]:x.defaults[i];if(typeof O!=="undefined"&&O!==null){l=G(O);D=D.replace(new RegExp(":"+i+"(\\W)","g"),l+"$1")}else{D=D.replace(new RegExp("(/?):"+i+"(\\W)","g"),function(R,S,Q){if(Q.charAt(0)==="/"){return Q}else{return S+Q}})}}return D},urlGet:function(D){var i=this.url(D);D=D||{};i=i.replace(/\/?#$/,"");var x=[];for(var l in D){if(!this.urlParams[l]){x.push(d(l)+"="+d(D[l]))}}x.sort();i=i.replace(/\/*$/,"");return i+(x.length?"?"+x.join("&"):"")}};var y=u.extend({_routes:{},_urlBase:"",init:function N(i){this._super();if(i){this._urlBase=i}},_getRoute:function(i){if(!i){throw new Error("Cannot create RESTful route for empty url.")}if(this._routes[i]){return this._routes[i]}return this._routes[i]=new w(this._urlBase+i)},_getErrorCallback:function(i){return function(x,Q,P){var D;try{if(x.responseText){D=JSON.parse(x.responseText)}else{D=null}}catch(O){D=null}var l=P||"Request failed.";if(D){if(D.error){l=D.error}else{if(D.errors){l=D.errors.join("\n")}}}i.reject(l,D,x)}},_isValidResponseObject:function(x,i){var l=i.getKey();if(typeof x!=="object"||x.error||(x.errors&&x.errors.length!==0)||(l&&typeof x[l]==="undefined")){return false}return true},_save:function(T,i){var U,O=T.constructor,R,S=this._getRoute(O._url),D={},x=O.getKey(),V=this,l=A.Deferred(),P=this._getErrorCallback(l);for(U in O._fields){var Q=O._fields[U];R=T[U];if(O.isTemporalType(Q.type)){R=this.formatDate(R,Q.type)}D[U]=R}jQuery.ajax({url:S.url(D),type:"POST",data:JSON.stringify(D),contentType:"application/json;charset=utf-8",dataType:"json",headers:{"X-HTTP-Method-Override":i},success:function(X,Y,W){if(!V._isValidResponseObject(X,O)){P(W,Y,"Invalid response.");return}T.fromJSON(X).resetModified().setNew(false);if(x&&typeof T[x]!=="undefined"){V.cache(O._table,T[x],T)}l.resolve(T)},error:P});return l.promise()},formatDateTime:function(i){if(!i){return null}if(!(i instanceof Date)){i=J(i)}var l=-i.getTimezoneOffset()/60;l=(l>0?"+":"-")+f(Math.abs(l));return i.getFullYear()+"-"+f(i.getMonth()+1)+"-"+f(i.getDate())+" "+f(i.getHours())+":"+f(i.getMinutes())+":"+f(i.getSeconds())+" "+l+"00"},insert:function(i){return this._save(i,"POST")},update:function(i){if(!i.isModified()){var l=A.Deferred();l.resolve(i);return l.promise()}return this._save(i,"PUT")},remove:function(i){var O=i.constructor,x=this._getRoute(O._url),P=O.getKey(),l=this,Q=A.Deferred(),D=this._getErrorCallback(Q);jQuery.ajax({url:x.url(i.toJSON()),type:"POST",data:{},contentType:"application/json;charset=utf-8",dataType:"json",headers:{"X-HTTP-Method-Override":"DELETE"},success:function(S,T,R){if(S&&(S.error||(S.errors&&S.errors.length))){D(R,T,"Invalid response.");return}if(P&&i[P]){l.cache(O._table,i[P],null)}Q.resolve(i)},error:D});return Q.promise()},find:function(P,l){var R=this._getRoute(P._url),O={},S=null,i,x=A.Deferred(),Q=this._getErrorCallback(x),T=this,D=P.getKey();if(D&&arguments.length===2&&(typeof l==="number"||typeof l==="string")){S=this.cache(P._table,l);if(S){x.resolve(S);return x.promise()}O={};O[D]=l}else{i=this.findQuery.apply(this,arguments);i.limit(1);O=i.getSimpleJSON()}jQuery.get(R.urlGet(O),function(V,W,U){if(!T._isValidResponseObject(V,P)){Q(U,W,"Invalid response.");return}if(V instanceof Array){V=V.shift()}x.resolve(P.inflate(V))}).fail(Q);return x.promise()},findAll:function(x){var P=this.findQuery.apply(this,arguments),i=this._getRoute(x._url),O=P.getSimpleJSON(),D=A.Deferred(),l=this._getErrorCallback(D);jQuery.get(i.urlGet(O),function(R,S,Q){if(typeof R!=="object"||R.error||(R.errors&&R.errors.length)){l(Q,S,"Invalid response.");return}if(!(R instanceof Array)){R=[R]}D.resolve(x.inflateArray(R))}).fail(l);return D.promise()},countAll:function(x){var P=this.findQuery.apply(this,arguments).setAction(z.ACTION_COUNT),i=this._getRoute(x._url),O=P.getSimpleJSON(),D=A.Deferred(),l=this._getErrorCallback(D);jQuery.get(i.urlGet(O),function(S,T,R){var Q=parseInt(S.total,10);if(isNaN(Q)||typeof S!=="object"||S.error||(S.errors&&S.errors.length)){l(R,T,"Invalid response.");return}D.resolve(Q)}).fail(l);return D.promise()}});A.RESTAdapter=y;var t=y.extend({$http:null,init:function(i,l){this._super(i);this.$http=l},_getErrorCallback:function(i){return function(O,l,P,D){var x="Request failed.";if(O){if(O.error){x=O.error}else{if(O.errors){x=O.errors.join("\n")}}}i.reject(x,O,D)}},_save:function(T,i){var U,O=T.constructor,R,S=this._getRoute(O._url),D={},x=O.getKey(),V=this,l=A.Deferred(),P=this._getErrorCallback(l);for(U in O._fields){var Q=O._fields[U];R=T[U];if(O.isTemporalType(Q.type)){R=this.formatDate(R,Q.type)}D[U]=R}this.$http({url:S.url(D),method:"POST",data:D,headers:{"X-HTTP-Method-Override":i}}).success(function(Y,W,Z,X){if(!V._isValidResponseObject(Y,O)){P.apply(this,arguments);return}T.fromJSON(Y).resetModified().setNew(false);if(x&&typeof T[x]!=="undefined"){V.cache(O._table,T[x],T)}l.resolve(T)}).error(P);return l.promise()},remove:function(i){var O=i.constructor,x=this._getRoute(O._url),P=O.getKey(),l=this,Q=A.Deferred(),D=this._getErrorCallback(Q);this.$http({url:x.url(i.toJSON()),method:"POST",data:{},headers:{"X-HTTP-Method-Override":"DELETE"}}).success(function(T,R,U,S){if(T&&(T.error||(T.errors&&T.errors.length))){D.apply(this,arguments);return}if(P&&i[P]){l.cache(O._table,i[P],null)}Q.resolve(i)}).error(D);return Q.promise()},find:function(P,l){var R=this._getRoute(P._url),O={},S=null,i,x=A.Deferred(),Q=this._getErrorCallback(x),T=this,D=P.getKey();if(D&&arguments.length===2&&(typeof l==="number"||typeof l==="string")){S=this.cache(P._table,l);if(S){x.resolve(S);return x.promise()}O={};O[D]=l}else{i=this.findQuery.apply(this,arguments);i.limit(1);O=i.getSimpleJSON()}this.$http.get(R.urlGet(O)).success(function(W,U,X,V){if(!T._isValidResponseObject(W,P)){Q.apply(this,arguments);return}if(W instanceof Array){W=W.shift()}x.resolve(P.inflate(W))}).error(Q);return x.promise()},findAll:function(x){var P=this.findQuery.apply(this,arguments),i=this._getRoute(x._url),O=P.getSimpleJSON(),D=A.Deferred(),l=this._getErrorCallback(D);this.$http.get(i.urlGet(O)).success(function(S,Q,T,R){if(typeof S!=="object"||S.error||(S.errors&&S.errors.length)){l.apply(this,arguments);return}if(!(S instanceof Array)){S=[S]}D.resolve(x.inflateArray(S))}).error(l);return D.promise()},countAll:function(x){var P=this.findQuery.apply(this,arguments).setAction(z.ACTION_COUNT),i=this._getRoute(x._url),O=P.getSimpleJSON(),D=A.Deferred(),l=this._getErrorCallback(D);this.$http.get(i.urlGet(O)).success(function(T,Q,U,R){var S=parseInt(T.total,10);if(isNaN(S)||typeof T!=="object"||T.error||(T.errors&&T.errors.length)){l.apply(this,arguments);return}D.resolve(S)}).error(l);return D.promise()}});A.AngularRESTAdapter=t;var k=u.extend({_db:null,init:function k(i){this._db=i;this._super()},execute:function(R,l){if(R instanceof z){R=R.getQuery(this)}if(R instanceof z.Statement){R.setConnection(this);return this.execute(R.getString(),R.getParams())}var x,T=[],S,O,D,P,Q;if(l&&(D=l.length)!==0){for(O=0;O<D;++O){Q=l[O];if(Q instanceof Date){if(Q.getSeconds()===0&&Q.getMinutes()===0&&Q.getHours()===0){l[O]=this.formatDate(Q)}else{l[O]=this.formatDateTime(Q)}}}x=this._db.execute(R,l)}else{x=this._db.execute(R)}T.rowsAffected=parseInt(this._db.rowsAffected)||0;if(null===x){return T}while(x.isValidRow()){S={};for(O=0,D=x.getFieldCount();O<D;++O){P=x.getFieldName(O);S[P]=x.field(O)}T.push(S);x.next()}x.close();return T},count:function(x,l){x="SELECT COUNT(0) AS rCount FROM ("+x+") AS a";var i=this.execute(x,l);return parseInt(i[0].rCount,10)||0},transaction:function(i){i.apply(this)},lastInsertId:function(){return this._db.lastInsertRowId},quoteIdentifier:function(i){return i},applyLimit:function(x,l,i){if(i>0){x=x+"\nLIMIT "+i+(l>0?" OFFSET "+l:"")}else{if(l>0){x=x+"\nLIMIT -1 OFFSET "+l}}return x},prepareInput:function(D){if(D instanceof Array){D=D.slice(0);for(var l=0,i=D.length;l<i;++l){D[l]=this.prepareInput(D[l])}return D}if(D===true||D===false){return D?1:0}if(D===null||typeof D==="undefined"){return"NULL"}if(parseInt(D,10)===D){return D}if(D instanceof Date){if(D.getSeconds()===0&&D.getMinutes()===0&&D.getHours()===0){D=this.formatDate(D)}else{D=this.formatDateTime(D)}}return this.quote(D)},quote:function(i){return"'"+i.replace("'","''")+"'"},find:function(i){var l=this.findQuery.apply(this,arguments).setLimit(1);return this.select(i,l).shift()||null},findAll:function(i){return this.select(i,this.findQuery.apply(this,arguments))},selectRS:function(i,l){l=l||new z;if(!l.getTable()||i.getTableName()!==l.getTable()){l.setTable(i.getTableName())}return this.execute(l.getSelectQuery(this))},fromResult:function(l,i){return l.inflatArray(i)},countAll:function(l,x){x=x instanceof z?x:new z(x);if(!x.getTable()||l.getTableName()!==x.getTable()){x.setTable(l.getTableName())}var i=this.execute(x.getCountQuery(this));return parseInt(i[0],10)||0},removeAll:function(i,l){if(!l.getTable()||i.getTableName()!==l.getTable()){l.setTable(i.getTableName())}this.emptyCache(i._table);return this.execute(l.getDeleteQuery(this)).rowsAffected},select:function(i,l){l=l instanceof z?l:new z(l);return this.fromResult(i,this.selectRS(i,l))},updateAll:function(O,D,l){var U=this.quoteIdentifier(O.getTableName()),P=[],T=[],R=new z.Statement(this),S,i,Q=l.getWhereClause(this);for(S in D){P.push(this.quoteIdentifier(S)+" = ?");T.push(D[S])}if(P.length===0){return 0}i="UPDATE "+U+" SET "+P.join(", ")+" WHERE "+Q.getString();R.setString(i);R.setParams(T);R.addParams(Q.getParams());var V=this.execute(R);this.emptyCache(O._table);return V.rowsAffected||0},insert:function(U){var D=U.constructor,x=D.getKey(),O=[],T=[],Q=[],P=new z.Statement(this),i,V,S,W,l;for(V in D._fields){var R=D._fields[V];S=U[V];if(D.isTemporalType(R.type)){S=this.formatDate(S,R.type)}if(S===null){if(!U.isModified(V)){continue}}O.push(V);T.push(S);Q.push("?")}i="INSERT INTO "+D.getTableName()+" ("+O.join(",")+") VALUES ("+Q.join(",")+") ";P.setString(i);P.setParams(T);W=this.execute(P);if(x&&D.isAutoIncrement()){l=this.lastInsertId();if(null!==l){U[x]=l}}U.resetModified();U.setNew(false);if(x&&U[x]){this.cache(D._table,U[x],U)}return W.rowsAffected},update:function(X){var P={},l=new z,Q=X.constructor,D=Q.getKeys(),i=X.getModified(),V,S,Y,O,T,W;if(!X.isModified()){return 0}if(D.length===0){throw new Error("This table has no primary keys")}for(Y in i){var U=Q._fields[Y];W=X[Y];if(Q.isTemporalType(U.type)){W=this.formatDate(W,U.type)}P[Y]=W}for(V=0,S=D.length;V<S;++V){O=D[V];T=X[O];if(T===null){throw new Error("Cannot remove using NULL primary key.")}l.and(O,T)}var R=this.updateAll(Q,P,l);X.resetModified();return R},remove:function(D){var P=D.constructor,O=P.getKeys(),S=new z,l,i,R,Q;if(O.length===0){throw new Error("This table has no primary keys")}for(l=0,i=O.length;l<i;++l){R=O[l];Q=D[R];if(Q===null){throw new Error("Cannot remove using NULL primary key.")}S.and(R,Q)}return this.removeAll(P,S)}});k.Migration=a.extend({adapter:null,schema:null,init:function(i){this.adapter=i;this.schema=E.extend("schema_definitions",{adapter:i,fields:{id:{type:E.FIELD_TYPE_INTEGER,computed:true,key:true},table_name:E.FIELD_TYPE_TEXT,column_names:E.FIELD_TYPE_INTEGER,column_types:E.FIELD_TYPE_INTEGER}})},migrate:function(O){if(!O){O={}}var D,Q={},x,l,P;if(O.refresh){for(D in E.models){this.adapter.execute("DROP TABLE IF EXISTS "+D)}this.setupSchema(true)}else{this.setupSchema()}if(this.adapter.migrations){Q=this.adapter.migrations}if(Q[1]&&Q[1].constructor===Object){x=this.currentSchemaVersion();l=Infinity;if(O.number!==null&&typeof O.number!=="undefined"){l=O.number}else{if(typeof O==="number"){l=O}}P=x;do{if(P===l){return}else{if(P<l){P+=1;if(Q[P]!==null&&typeof Q[P]!=="undefined"){Q[P].up()}else{break}}else{Q[P].down();P-=1}}this.updateSchemaVersion(P)}while(Q[P])}else{}if(O&&O.refresh){this.loadFixtures()}},setupSchema:function(i){var l;this.createTable("schema_migrations",{version:E.FIELD_TYPE_TEXT});if(this.adapter.count("SELECT * FROM schema_migrations")===0){l="INSERT INTO schema_migrations (version) VALUES(0)";this.adapter.execute(l)}if(i&&this.adapter.count("SELECT * FROM schema_migrations")===1){l="UPDATE schema_migrations set version = 0";this.adapter.execute(l)}this.createTable("schema_definitions",{id:E.FIELD_TYPE_INTEGER,table_name:E.FIELD_TYPE_TEXT,column_names:E.FIELD_TYPE_INTEGER,column_types:E.FIELD_TYPE_INTEGER})},writeSchema:function(x,R){if(x==="schema_definitions"||x==="schema_migrations"){return}var P=[],l=[],Q,D,O;for(var i in R){P.push(i);l.push(R[i])}Q=P.join();D=P.join();O=this.schema.findBy("table_name",x);if(O){O.column_names=Q;O.column_types=D;O.save()}else{O=new this.schema;O.fromJSON({table_name:x,column_names:Q,column_types:D});O.save()}},readSchema:function(D){if(D==="schema_definitions"||D==="schema_migrations"){return null}var Q=this.schema.findBy("table_name",D),x=Q.column_names.split(","),S=Q.column_types.split(","),R={},O;for(var P=0,l=x.length;P<l;++P){O=x[P];R[O]=S[P]}return R},currentSchemaVersion:function(){var i="SELECT version FROM schema_migrations LIMIT 1";return parseInt(this.adapter.execute(i)[0].version,10)},updateSchemaVersion:function(i){var l="UPDATE schema_migrations SET version = "+i;return this.adapter.execute(l)},modifyColumn:function(l,i,x){if(!x){throw new Error("MIGRATION_EXCEPTION: Not a valid column modification")}var Q=this.readSchema(l),O={},D,P;for(D in Q){P=Q[D];switch(x.modification){case"remove":if(D!==i){O[D]=P}break;case"rename":if(D!==i){O[D]=P}else{O[x.newName]=P}break;case"change":if(D!==i){O[D]=P}else{O[D]=x.newType}break;default:throw ("MIGRATION_EXCEPTION: Not a valid column modification")}}this.adapter.transaction(function(){var T=this.adapter.execute("SELECT * FROM "+l);if(T.length!==0){throw new Error("Modify column not quite ready yet...")}this.dropTable(l);this.createTable(l,O);for(var U=0,R=T.length;U<R;++U){var S=T[U];switch(x.modification){case"remove":delete S[i];E.insert(l,S);break;case"rename":S[x.newName]=S[i];delete S[i];E.insert(l,S);break;case"change":E.insert(l,S);break;default:throw ("MIGRATION_EXCEPTION: Not a valid column modification")}}})},createTable:function(l,D){if(!l||!D){return}var Q="CREATE TABLE IF NOT EXISTS "+l+"\n",O,P,x=0;Q+="(";for(O in D){P=D[O];if(0!==x){Q+=",\n"}Q+=(O+" "+P);if(P===E.FIELD_TYPE_INTEGER&&O==="id"){Q+=" PRIMARY KEY AUTOINCREMENT"}++x}Q+=")";this.adapter.execute(Q);this.writeSchema(l,D)},dropTable:function(i){var x="DROP TABLE IF EXISTS "+i,l;this.adapter.execute(x);l=this.schema.findBy("table_name",i);l.remove()},renameTable:function(l,i){var D="ALTER TABLE "+l+" RENAME TO "+i,x;this.adapter.execute(D);x=this.schema.findBy("table_name",l);x.table_name=i;x.save()},addColumn:function(x,l,i){var O="ALTER TABLE "+x+" ADD COLUMN "+l+" "+i,D;this.adapter.execute(O);D=this.readSchema(x);D[l]=i;this.writeSchema(x,D)},removeColumn:function(l,i){return this.modifyColumn(l,i,{modification:"remove"})},renameColumn:function(l,i,D){var x={modification:"rename",newName:D};return this.modifyColumn(l,i,x)},changeColumn:function(l,i,D){var x={modification:"change",newType:D};return this.modifyColumn(l,i,x)},addIndex:function(l,i,D){var x="CREATE"+(D?" UNIQUE ":" ")+"INDEX IF NOT EXISTS "+l+"_"+i+"_index ON "+l+" ("+i+")";return this.adapter.execute(x)},removeIndex:function(l,i){var x="DROP INDEX IF EXISTS "+l+"_"+i+"_index";return this.adapter.execute(x)},loadFixtures:function(){}});k.TiDebugDB=a.extend({lastInsertRowId:null,rowsAffected:null,lastSQL:null,lastParams:null,execute:function(l,i){if(typeof console!=="undefined"){console.log(l,i)}this.lastSQL=l;this.lastParams=i;if(l.toUpperCase().indexOf("INSERT")===0){if(this.lastInsertRowId===null){this.lastInsertRowId=1}else{++this.lastInsertRowId}this.rowsAffected=1}if(l.toUpperCase().indexOf("DELETE")===0||l.toUpperCase().indexOf("UPDATE")===0){this.rowsAffected=1}return{sql:l,params:i,isValidRow:function(){return false},getRowCount:function(){return 0},getFieldCount:function(){return 0},getFieldName:function(){return""},field:function(){return""},next:function(){},close:function(){}}}});A.SQLAdapter=k})(dabl);